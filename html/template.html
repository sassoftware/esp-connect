<!DOCTYPE html>

<html>

<head>

<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">

<title>ESP Symbols Example</title>

<link rel="stylesheet" href="/esp-connect/style/connect.css" />

<script src="https://cdn.plot.ly/plotly-latest.min.js" charset="utf-8"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="/esp-connect/js/ui/main"></script>

<script type="text/javascript">

var _esp = null;
var _conn = null;
var _visuals = null;

function
esp(api)
{
    _esp = api;

    var parms = _esp.getParms();

    if (parms.hasOwnProperty("server") == false)
    {
        alert("you must specify ESP server URL");
        return;
    }

    var server = parms["server"];
    delete parms["server"];

    document.getElementById("bannerTitle").innerHTML = document.title + " (" + server + ")";

    _visuals = _esp.createVisuals(parms);

    _esp.handleLayout();

    _esp.connect(server,{ready:ready},{debug:false});
}

function
ready(connection)
{
    _conn = connection;

    if (_esp.getParm("load",true))
    {
        _esp.showStatus("Loading project...");
        _conn.loadProjectFrom("p","model.xml",{loaded:loaded},{overwrite:true});
    }
    else
    {
        loaded();
    }
}

function
loaded()
{
    _esp.clearStatus();

    _conn.getProjectXml("p",{response:function(c,data){document.getElementById("espModelXml").innerText = data;}});

    var coll = _conn.getEventCollection({window:"p/cq/copy"});

    _visuals.createTable("mytable",coll);

    _esp.size();
}

function
error()
{
    alert("error");
}

</script>
</head>

<body>

    <div id="banner">
        <table style="width:100%" cellspacing="0" cellpadding="0">
            <tr>
                <td id="bannerTitle"></td>
                <td class="icon">
                    <a class="icon" href="javascript:_esp.getDialogs().pushModal('espModel')">&#xf426;</a>
                    <a class="icon" href="javascript:_esp.getDialogs().pushModal('help')">&#xf30b;</a>
                </td>
            </tr>
        </table>
    </div>

    <div id="content"  class="container">
        <div id="mytable" class="component" style="width:60%;height:400px"></div>
    </div>

    <div id="footer">&nbsp;</div>

    <div id="help" class="dialog" style="width:60%">
        <table class="dialogClose" style="width:100%" cellspacing="0" cellpadding="0">
            <tr><td class="icon"><a class="icon dialogTitle" href="javascript:_esp.getDialogs().popModal('help')">&#xf10c;</a></td></tr>
        </table>

        <div class="dialogTop">

            <div  class="dialogHeader">
                <div class="dialogTitle">
                    <table style="width:100%;border:0" cellspacing="0" cellpadding="0">
                        <tr>
                            <td><div class="dialogTitle">ESP Page Template</div></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <div class="dialogContent">
        Explain you page here.
        </div>

        <div class="dialogButtons">
            <table style="width:100%">
                <tr>
                    <td class="dialogButton">
                        <span><button class="close" onclick="javascript:_esp.getDialogs().popModal('help')">Done</button></span>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div id="espModel" class="dialog" style="width:90%;height:90%">

        <table class="dialogClose" style="width:100%" cellspacing="0" cellpadding="0">
            <tr><td class="icon"><a class="icon dialogTitle" href="javascript:_esp.getDialogs().popModal('espModel')">&#xf10c;</a></td></tr>
        </table>

        <div class="dialogTop">

            <div  class="dialogHeader">
                <div class="dialogTitle">
                    <table style="width:100%;border:0" cellspacing="0" cellpadding="0">
                        <tr>
                            <td><div class="dialogTitle">ESP Model</div></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <div class="dialogContent" style="width:95%;height:70%;margin:auto">
            <pre id="espModelXml" class="model"></pre>
        </div>
    </div>

</body>

</html>

!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.esp_connect=t():e.esp_connect=t()}(global,(function(){return(()=>{var e={3307:e=>{"use strict";e.exports={mask:(e,t,r,s,n)=>{for(var i=0;i<n;i++)r[s+i]=e[i]^t[3&i]},unmask:(e,t)=>{const r=e.length;for(var s=0;s<r;s++)e[s]^=t[3&s]}}},4987:(e,t,r)=>{"use strict";try{e.exports=r(9561)(__dirname)}catch(t){e.exports=r(3307)}},5977:(e,t,r)=>{function s(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(t=e.exports=r(3420)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),r){var s="color: "+this.color;e.splice(1,0,s,"color: inherit");var n=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(i=n))})),e.splice(i,0,s)}},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=s,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(s())},3420:(e,t,r)=>{var s;function n(e){function r(){if(r.enabled){var e=r,n=+new Date,i=n-(s||n);e.diff=i,e.prev=s,e.curr=n,s=n;for(var o=new Array(arguments.length),a=0;a<o.length;a++)o[a]=arguments[a];o[0]=t.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var h=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,(function(r,s){if("%%"===r)return r;h++;var n=t.formatters[s];if("function"==typeof n){var i=o[h];r=n.call(e,i),o.splice(h,1),h--}return r})),t.formatArgs.call(e,o);var l=r.log||t.log||console.log.bind(console);l.apply(e,o)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var r,s=0;for(r in e)s=(s<<5)-s+e.charCodeAt(r),s|=0;return t.colors[Math.abs(s)%t.colors.length]}(e),"function"==typeof t.init&&t.init(r),r}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var r=("string"==typeof e?e:"").split(/[\s,]+/),s=r.length,n=0;n<s;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var r,s;for(r=0,s=t.skips.length;r<s;r++)if(t.skips[r].test(e))return!1;for(r=0,s=t.names.length;r<s;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(5273),t.names=[],t.skips=[],t.formatters={}},324:(e,t,r)=>{"undefined"!=typeof process&&"renderer"===process.type?e.exports=r(5977):e.exports=r(2501)},2501:(e,t,r)=>{var s=r(3867),n=r(1669);(t=e.exports=r(3420)).init=function(e){e.inspectOpts={};for(var r=Object.keys(t.inspectOpts),s=0;s<r.length;s++)e.inspectOpts[r[s]]=t.inspectOpts[r[s]]},t.log=function(){return o.write(n.format.apply(n,arguments)+"\n")},t.formatArgs=function(e){var r=this.namespace;if(this.useColors){var s=this.color,n="  [3"+s+";1m"+r+" [0m";e[0]=n+e[0].split("\n").join("\n"+n),e.push("[3"+s+"m+"+t.humanize(this.diff)+"[0m")}else e[0]=(new Date).toUTCString()+" "+r+" "+e[0]},t.save=function(e){null==e?delete process.env.DEBUG:process.env.DEBUG=e},t.load=a,t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):s.isatty(i)},t.colors=[6,2,3,4,5,1],t.inspectOpts=Object.keys(process.env).filter((function(e){return/^debug_/i.test(e)})).reduce((function(e,t){var r=t.substring(6).toLowerCase().replace(/_([a-z])/g,(function(e,t){return t.toUpperCase()})),s=process.env[t];return s=!!/^(yes|on|true|enabled)$/i.test(s)||!/^(no|off|false|disabled)$/i.test(s)&&("null"===s?null:Number(s)),e[r]=s,e}),{});var i=parseInt(process.env.DEBUG_FD,10)||2;1!==i&&2!==i&&n.deprecate((function(){}),"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var o=1===i?process.stdout:2===i?process.stderr:function(e){var t;switch(process.binding("tty_wrap").guessHandleType(e)){case"TTY":(t=new s.WriteStream(e))._type="tty",t._handle&&t._handle.unref&&t._handle.unref();break;case"FILE":(t=new(r(5747).SyncWriteStream)(e,{autoClose:!1}))._type="fs";break;case"PIPE":case"TCP":(t=new(r(1631).Socket)({fd:e,readable:!1,writable:!0})).readable=!1,t.read=null,t._type="pipe",t._handle&&t._handle.unref&&t._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return t.fd=e,t._isStdio=!0,t}(i);function a(){return process.env.DEBUG}t.formatters.o=function(e){return this.inspectOpts.colors=this.useColors,n.inspect(e,this.inspectOpts).split("\n").map((function(e){return e.trim()})).join(" ")},t.formatters.O=function(e){return this.inspectOpts.colors=this.useColors,n.inspect(e,this.inspectOpts)},t.enable(a())},6184:e=>{e.exports=s,s.strict=n,s.loose=i;var t=Object.prototype.toString,r={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function s(e){return n(e)||i(e)}function n(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function i(e){return r[t.call(e)]}},5273:e=>{var t=1e3,r=60*t,s=60*r,n=24*s;function i(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}e.exports=function(e,o){o=o||{};var a,h=typeof e;if("string"===h&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var i=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(i){var o=parseFloat(i[1]);switch((i[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"days":case"day":case"d":return o*n;case"hours":case"hour":case"hrs":case"hr":case"h":return o*s;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===h&&!1===isNaN(e))return o.long?i(a=e,n,"day")||i(a,s,"hour")||i(a,r,"minute")||i(a,t,"second")||a+" ms":function(e){return e>=n?Math.round(e/n)+"d":e>=s?Math.round(e/s)+"h":e>=r?Math.round(e/r)+"m":e>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},9561:(e,t,r)=>{var s=r(5747),n=r(5622),i=r(2087),o=require,a=process.versions.modules,h=process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE||"undefined"!=typeof window&&window.process&&"renderer"===window.process.type?"electron":"node",l=i.arch(),c=i.platform();function u(e){return o(u.path(e))}function p(e,t){try{var r=s.readdirSync(e).filter(t);return r[0]&&n.join(e,r[0])}catch(e){return null}}function d(e){return e===h+"-napi.node"}function f(e){return"node-napi.node"===e}function g(e){var t=e.split("-");return t[0]===h&&t[1]===a+".node"}function m(e){return/\.node$/.test(e)}e.exports=u,u.path=function(e){e=n.resolve(e||".");try{var t=o(n.join(e,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[t+"_PREBUILD"]&&(e=process.env[t+"_PREBUILD"])}catch(e){}var r=p(n.join(e,"build/Release"),m);if(r)return r;var s=p(n.join(e,"build/Debug"),m);if(s)return s;var i=p(n.join(e,"prebuilds/"+c+"-"+l),g);if(i)return i;var u=p(n.join(e,"prebuilds/"+c+"-"+l),d);if(u)return u;var _=p(n.join(e,"prebuilds/"+c+"-"+l),f);if(_)return _;throw new Error("No native build was found for runtime="+h+" abi="+a+" platform="+c+" arch="+l)}},1734:(e,t,r)=>{var s=r(6184).strict;e.exports=function(e){if(s(e)){var t=Buffer.from(e.buffer);return e.byteLength!==e.buffer.byteLength&&(t=t.slice(e.byteOffset,e.byteOffset+e.byteLength)),t}return Buffer.from(e)}},8121:e=>{"use strict";e.exports=e=>{for(var t=e.length,r=0;r<t;)if(e[r]<128)r++;else if(192==(224&e[r])){if(r+1===t||128!=(192&e[r+1])||192==(254&e[r]))return!1;r+=2}else if(224==(240&e[r])){if(r+2>=t||128!=(192&e[r+1])||128!=(192&e[r+2])||224===e[r]&&128==(224&e[r+1])||237===e[r]&&160==(224&e[r+1]))return!1;r+=3}else{if(240!=(248&e[r]))return!1;if(r+3>=t||128!=(192&e[r+1])||128!=(192&e[r+2])||128!=(192&e[r+3])||240===e[r]&&128==(240&e[r+1])||244===e[r]&&e[r+1]>143||e[r]>244)return!1;r+=4}return!0}},6465:(e,t,r)=>{"use strict";try{e.exports=r(9561)(__dirname)}catch(t){e.exports=r(8121)}},9316:(e,t,r)=>{e.exports=r(8328)},8360:e=>{var t={disableWarnings:!1,deprecationWarningMap:{},warn:function(e){!this.disableWarnings&&this.deprecationWarningMap[e]&&(console.warn("DEPRECATION WARNING: "+this.deprecationWarningMap[e]),this.deprecationWarningMap[e]=!1)}};e.exports=t},4149:(e,t,r)=>{var s=r(1289),n=r(1734),i=r(9727);const o=0,a=1,h=2,l=3;function c(e,t,r,n,a,h){i.EventTarget.call(this),(h=h||{}).assembleFragments=!0;var l=this;this._url=e,this._readyState=o,this._protocol=void 0,this._extensions="",this._bufferedAmount=0,this._binaryType="arraybuffer",this._connection=void 0,this._client=new s(h),this._client.on("connect",(function(e){d.call(l,e)})),this._client.on("connectFailed",(function(){f.call(l)})),this._client.connect(e,t,r,n,a)}function u(e,t){var r=new i.Event("close");return r.code=e,r.reason=t,r.wasClean=void 0===e||1e3===e,r}function p(e){var t=new i.Event("message");return t.data=e,t}function d(e){var t=this;this._readyState=a,this._connection=e,this._protocol=e.protocol,this._extensions=e.extensions,this._connection.on("close",(function(e,r){g.call(t,e,r)})),this._connection.on("message",(function(e){m.call(t,e)})),this.dispatchEvent(new i.Event("open"))}function f(){_.call(this),this._readyState=l;try{this.dispatchEvent(new i.Event("error"))}finally{this.dispatchEvent(u(1006,"connection failed"))}}function g(e,t){_.call(this),this._readyState=l,this.dispatchEvent(u(e,t||""))}function m(e){if(e.utf8Data)this.dispatchEvent(p(e.utf8Data));else if(e.binaryData&&"arraybuffer"===this.binaryType){for(var t=e.binaryData,r=new ArrayBuffer(t.length),s=new Uint8Array(r),n=0,i=t.length;n<i;++n)s[n]=t[n];this.dispatchEvent(p(r))}}function _(){this._client.removeAllListeners(),this._connection&&this._connection.removeAllListeners()}e.exports=c,Object.defineProperties(c.prototype,{url:{get:function(){return this._url}},readyState:{get:function(){return this._readyState}},protocol:{get:function(){return this._protocol}},extensions:{get:function(){return this._extensions}},bufferedAmount:{get:function(){return this._bufferedAmount}}}),Object.defineProperties(c.prototype,{binaryType:{get:function(){return this._binaryType},set:function(e){if("arraybuffer"!==e)throw new SyntaxError('just "arraybuffer" type allowed for "binaryType" attribute');this._binaryType=e}}}),[["CONNECTING",o],["OPEN",a],["CLOSING",h],["CLOSED",l]].forEach((function(e){Object.defineProperty(c.prototype,e[0],{get:function(){return e[1]}})})),[["CONNECTING",o],["OPEN",a],["CLOSING",h],["CLOSED",l]].forEach((function(e){Object.defineProperty(c,e[0],{get:function(){return e[1]}})})),c.prototype.send=function(e){if(this._readyState!==a)throw new Error("cannot call send() while not connected");if("string"==typeof e||e instanceof String)this._connection.sendUTF(e);else if(e instanceof Buffer)this._connection.sendBytes(e);else{if(!e.byteLength&&0!==e.byteLength)throw new Error("unknown binary data:",e);e=n(e),this._connection.sendBytes(e)}},c.prototype.close=function(e,t){switch(this._readyState){case o:f.call(this),this._client.on("connect",(function(r){e?r.close(e,t):r.close()}));break;case a:this._readyState=h,e?this._connection.close(e,t):this._connection.close()}}},1289:(e,t,r)=>{var s=r(4831),n=s.extend,i=r(1669),o=r(8614).EventEmitter,a=r(8605),h=r(7211),l=r(8835),c=r(6417),u=r(2496),p=s.bufferAllocUnsafe,d=["(",")","<",">","@",",",";",":","\\",'"',"/","[","]","?","=","{","}"," ",String.fromCharCode(9)],f=["hostname","port","method","path","headers"];function g(e){var t;switch(o.call(this),this.config={maxReceivedFrameSize:1048576,maxReceivedMessageSize:8388608,fragmentOutgoingMessages:!0,fragmentationThreshold:16384,webSocketVersion:13,assembleFragments:!0,disableNagleAlgorithm:!0,closeTimeout:5e3,tlsOptions:{}},e&&(e.tlsOptions?(t=e.tlsOptions,delete e.tlsOptions):t={},n(this.config,e),n(this.config.tlsOptions,t)),this._req=null,this.config.webSocketVersion){case 8:case 13:break;default:throw new Error("Requested webSocketVersion is not supported. Allowed values are 8 and 13.")}}i.inherits(g,o),g.prototype.connect=function(e,t,r,i,o){var c=this;if("string"==typeof t&&(t=t.length>0?[t]:[]),t instanceof Array||(t=[]),this.protocols=t,this.origin=r,this.url="string"==typeof e?l.parse(e):e,!this.url.protocol)throw new Error("You must specify a full WebSocket URL, including protocol.");if(!this.url.host)throw new Error("You must specify a full WebSocket URL, including hostname. Relative URLs are not supported.");this.secure="wss:"===this.url.protocol,this.protocols.forEach((function(e){for(var t=0;t<e.length;t++){var r=e.charCodeAt(t),s=e.charAt(t);if(r<33||r>126||-1!==d.indexOf(s))throw new Error('Protocol list contains invalid character "'+String.fromCharCode(r)+'"')}})),this.url.port||(this.url.port={"ws:":"80","wss:":"443"}[this.url.protocol]);for(var u=p(16),g=0;g<16;g++)u[g]=Math.round(255*Math.random());this.base64nonce=u.toString("base64");var m=this.url.hostname;("ws:"===this.url.protocol&&"80"!==this.url.port||"wss:"===this.url.protocol&&"443"!==this.url.port)&&(m+=":"+this.url.port);var _,v={};function y(e){c._req=null,c.emit("connectFailed",e)}this.secure&&this.config.tlsOptions.hasOwnProperty("headers")&&n(v,this.config.tlsOptions.headers),i&&n(v,i),n(v,{Upgrade:"websocket",Connection:"Upgrade","Sec-WebSocket-Version":this.config.webSocketVersion.toString(10),"Sec-WebSocket-Key":this.base64nonce,Host:v.Host||m}),this.protocols.length>0&&(v["Sec-WebSocket-Protocol"]=this.protocols.join(", ")),this.origin&&(13===this.config.webSocketVersion?v.Origin=this.origin:8===this.config.webSocketVersion&&(v["Sec-WebSocket-Origin"]=this.origin)),_=this.url.pathname?this.url.path:this.url.path?"/"+this.url.path:"/";var b={agent:!1};if(o&&n(b,o),n(b,{hostname:this.url.hostname,port:this.url.port,method:"GET",path:_,headers:v}),this.secure){var w=this.config.tlsOptions;for(var O in w)w.hasOwnProperty(O)&&-1===f.indexOf(O)&&(b[O]=w[O])}var S=this._req=(this.secure?h:a).request(b);S.on("upgrade",(function(e,t,r){c._req=null,S.removeListener("error",y),c.socket=t,c.response=e,c.firstDataChunk=r,c.validateHandshake()})),S.on("error",y),S.on("response",(function(e){if(c._req=null,s.eventEmitterListenerCount(c,"httpResponse")>0)c.emit("httpResponse",e,c),e.socket&&e.socket.end();else{var t=[];for(var r in e.headers)t.push(r+": "+e.headers[r]);c.failHandshake("Server responded with a non-101 status: "+e.statusCode+" "+e.statusMessage+"\nResponse Headers Follow:\n"+t.join("\n")+"\n")}})),S.end()},g.prototype.validateHandshake=function(){var e=this.response.headers;if(this.protocols.length>0){if(this.protocol=e["sec-websocket-protocol"],!this.protocol)return void this.failHandshake("Expected a Sec-WebSocket-Protocol header.");if(-1===this.protocols.indexOf(this.protocol))return void this.failHandshake("Server did not respond with a requested protocol.")}if(e.connection&&"upgrade"===e.connection.toLocaleLowerCase())if(e.upgrade&&"websocket"===e.upgrade.toLocaleLowerCase()){var t=c.createHash("sha1");t.update(this.base64nonce+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var r=t.digest("base64");e["sec-websocket-accept"]?e["sec-websocket-accept"]===r?this.succeedHandshake():this.failHandshake("Sec-WebSocket-Accept header from server didn't match expected value of "+r):this.failHandshake("Expected Sec-WebSocket-Accept header from server")}else this.failHandshake("Expected an Upgrade: websocket header from the server");else this.failHandshake("Expected a Connection: Upgrade header from the server")},g.prototype.failHandshake=function(e){this.socket&&this.socket.writable&&this.socket.end(),this.emit("connectFailed",new Error(e))},g.prototype.succeedHandshake=function(){var e=new u(this.socket,[],this.protocol,!0,this.config);e.webSocketVersion=this.config.webSocketVersion,e._addSocketEventListeners(),this.emit("connect",e),this.firstDataChunk.length>0&&e.handleSocketData(this.firstDataChunk),this.firstDataChunk=null},g.prototype.abort=function(){this._req&&this._req.abort()},e.exports=g},2496:(e,t,r)=>{var s=r(1669),n=r(4831),i=r(8614).EventEmitter,o=r(804),a=r(6911),h=r(6465),l=n.bufferAllocUnsafe,c=n.bufferFromString;const u="open",p="peer_requested_close",d="ending",f="closed";var g="setImmediate"in global?global.setImmediate.bind(global):process.nextTick.bind(process),m=0;function _(e,t,r,s,h){if(this._debug=n.BufferingLogger("websocket:connection",++m),this._debug("constructor"),this._debug.enabled&&function(e,t){if(e._debug.enabled){var r=t.emit;for(var s in t.emit=function(t){e._debug("||| Socket Event  '%s'",t),r.apply(this,arguments)},t)"function"==typeof t[s]&&-1===["emit"].indexOf(s)&&function(r){var s=t[r];t[r]="on"!==r?function(){return e._debug("||| Socket method called:  %s",r),s.apply(this,arguments)}:function(){return e._debug("||| Socket method called:  %s (%s)",r,arguments[0]),s.apply(this,arguments)}}(s)}}(this,e),i.call(this),this._pingListenerCount=0,this.on("newListener",(function(e){"ping"===e&&this._pingListenerCount++})).on("removeListener",(function(e){"ping"===e&&this._pingListenerCount--})),this.config=h,this.socket=e,this.protocol=r,this.extensions=t,this.remoteAddress=e.remoteAddress,this.closeReasonCode=-1,this.closeDescription=null,this.closeEventEmitted=!1,this.maskOutgoingPackets=s,this.maskBytes=l(4),this.frameHeader=l(10),this.bufferList=new a,this.currentFrame=new o(this.maskBytes,this.frameHeader,this.config),this.fragmentationSize=0,this.frameQueue=[],this.connected=!0,this.state=u,this.waitingForCloseResponse=!1,this.receivedEnd=!1,this.closeTimeout=this.config.closeTimeout,this.assembleFragments=this.config.assembleFragments,this.maxReceivedMessageSize=this.config.maxReceivedMessageSize,this.outputBufferFull=!1,this.inputPaused=!1,this.receivedDataHandler=this.processReceivedData.bind(this),this._closeTimerHandler=this.handleCloseTimer.bind(this),this.socket.setNoDelay(this.config.disableNagleAlgorithm),this.socket.setTimeout(0),this.config.keepalive&&!this.config.useNativeKeepalive){if("number"!=typeof this.config.keepaliveInterval)throw new Error("keepaliveInterval must be specified and numeric if keepalive is true.");if(this._keepaliveTimerHandler=this.handleKeepaliveTimer.bind(this),this.setKeepaliveTimer(),this.config.dropConnectionOnKeepaliveTimeout){if("number"!=typeof this.config.keepaliveGracePeriod)throw new Error("keepaliveGracePeriod  must be specified and numeric if dropConnectionOnKeepaliveTimeout is true.");this._gracePeriodTimerHandler=this.handleGracePeriodTimer.bind(this)}}else if(this.config.keepalive&&this.config.useNativeKeepalive){if(!("setKeepAlive"in this.socket))throw new Error("Unable to use native keepalive: unsupported by this version of Node.");this.socket.setKeepAlive(!0,this.config.keepaliveInterval)}this.socket.removeAllListeners("error")}function v(e){return!(e<1e3)&&(e>=1e3&&e<=2999?-1!==[1e3,1001,1002,1003,1007,1008,1009,1010,1011,1012,1013,1014,1015].indexOf(e):e>=3e3&&e<=3999||e>=4e3&&e<=4999||!(e>=5e3)&&void 0)}_.CLOSE_REASON_NORMAL=1e3,_.CLOSE_REASON_GOING_AWAY=1001,_.CLOSE_REASON_PROTOCOL_ERROR=1002,_.CLOSE_REASON_UNPROCESSABLE_INPUT=1003,_.CLOSE_REASON_RESERVED=1004,_.CLOSE_REASON_NOT_PROVIDED=1005,_.CLOSE_REASON_ABNORMAL=1006,_.CLOSE_REASON_INVALID_DATA=1007,_.CLOSE_REASON_POLICY_VIOLATION=1008,_.CLOSE_REASON_MESSAGE_TOO_BIG=1009,_.CLOSE_REASON_EXTENSION_REQUIRED=1010,_.CLOSE_REASON_INTERNAL_SERVER_ERROR=1011,_.CLOSE_REASON_TLS_HANDSHAKE_FAILED=1015,_.CLOSE_DESCRIPTIONS={1e3:"Normal connection closure",1001:"Remote peer is going away",1002:"Protocol error",1003:"Unprocessable input",1004:"Reserved",1005:"Reason not provided",1006:"Abnormal closure, no further detail available",1007:"Invalid data received",1008:"Policy violation",1009:"Message too big",1010:"Extension requested by client is required",1011:"Internal Server Error",1015:"TLS Handshake Failed"},s.inherits(_,i),_.prototype._addSocketEventListeners=function(){this.socket.on("error",this.handleSocketError.bind(this)),this.socket.on("end",this.handleSocketEnd.bind(this)),this.socket.on("close",this.handleSocketClose.bind(this)),this.socket.on("drain",this.handleSocketDrain.bind(this)),this.socket.on("pause",this.handleSocketPause.bind(this)),this.socket.on("resume",this.handleSocketResume.bind(this)),this.socket.on("data",this.handleSocketData.bind(this))},_.prototype.setKeepaliveTimer=function(){this._debug("setKeepaliveTimer"),this.config.keepalive&&!this.config.useNativeKeepalive&&(this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this._keepaliveTimeoutID=setTimeout(this._keepaliveTimerHandler,this.config.keepaliveInterval))},_.prototype.clearKeepaliveTimer=function(){this._keepaliveTimeoutID&&clearTimeout(this._keepaliveTimeoutID)},_.prototype.handleKeepaliveTimer=function(){this._debug("handleKeepaliveTimer"),this._keepaliveTimeoutID=null,this.ping(),this.config.dropConnectionOnKeepaliveTimeout?this.setGracePeriodTimer():this.setKeepaliveTimer()},_.prototype.setGracePeriodTimer=function(){this._debug("setGracePeriodTimer"),this.clearGracePeriodTimer(),this._gracePeriodTimeoutID=setTimeout(this._gracePeriodTimerHandler,this.config.keepaliveGracePeriod)},_.prototype.clearGracePeriodTimer=function(){this._gracePeriodTimeoutID&&clearTimeout(this._gracePeriodTimeoutID)},_.prototype.handleGracePeriodTimer=function(){this._debug("handleGracePeriodTimer"),this._gracePeriodTimeoutID=null,this.drop(_.CLOSE_REASON_ABNORMAL,"Peer not responding.",!0)},_.prototype.handleSocketData=function(e){this._debug("handleSocketData"),this.setKeepaliveTimer(),this.bufferList.write(e),this.processReceivedData()},_.prototype.processReceivedData=function(){if(this._debug("processReceivedData"),this.connected&&!this.inputPaused){var e=this.currentFrame;if(e.addData(this.bufferList)){var t=this;if(e.protocolError)return this._debug("-- protocol error"),void process.nextTick((function(){t.drop(_.CLOSE_REASON_PROTOCOL_ERROR,e.dropReason)}));if(e.frameTooLarge)return this._debug("-- frame too large"),void process.nextTick((function(){t.drop(_.CLOSE_REASON_MESSAGE_TOO_BIG,e.dropReason)}));if(e.rsv1||e.rsv2||e.rsv3)return this._debug("-- illegal rsv flag"),void process.nextTick((function(){t.drop(_.CLOSE_REASON_PROTOCOL_ERROR,"Unsupported usage of rsv bits without negotiated extension.")}));this.assembleFragments||(this._debug("-- emitting frame"),process.nextTick((function(){t.emit("frame",e)}))),process.nextTick((function(){t.processFrame(e)})),this.currentFrame=new o(this.maskBytes,this.frameHeader,this.config),this.bufferList.length>0&&g(this.receivedDataHandler)}else this._debug("-- insufficient data for frame")}},_.prototype.handleSocketError=function(e){this._debug("handleSocketError: %j",e),this.state!==f?(this.closeReasonCode=_.CLOSE_REASON_ABNORMAL,this.closeDescription="Socket Error: "+e.syscall+" "+e.code,this.connected=!1,this.state=f,this.fragmentationSize=0,n.eventEmitterListenerCount(this,"error")>0&&this.emit("error",e),this.socket.destroy(),this._debug.printOutput()):this._debug("  --- Socket 'error' after 'close'")},_.prototype.handleSocketEnd=function(){this._debug("handleSocketEnd: received socket end.  state = %s",this.state),this.receivedEnd=!0,this.state!==f?this.state!==p&&this.state!==d&&(this._debug("  --- UNEXPECTED socket end."),this.socket.end()):this._debug("  --- Socket 'end' after 'close'")},_.prototype.handleSocketClose=function(e){this._debug("handleSocketClose: received socket close"),this.socketHadError=e,this.connected=!1,this.state=f,-1===this.closeReasonCode&&(this.closeReasonCode=_.CLOSE_REASON_ABNORMAL,this.closeDescription="Connection dropped by remote peer."),this.clearCloseTimer(),this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this.closeEventEmitted||(this.closeEventEmitted=!0,this._debug("-- Emitting WebSocketConnection close event"),this.emit("close",this.closeReasonCode,this.closeDescription))},_.prototype.handleSocketDrain=function(){this._debug("handleSocketDrain: socket drain event"),this.outputBufferFull=!1,this.emit("drain")},_.prototype.handleSocketPause=function(){this._debug("handleSocketPause: socket pause event"),this.inputPaused=!0,this.emit("pause")},_.prototype.handleSocketResume=function(){this._debug("handleSocketResume: socket resume event"),this.inputPaused=!1,this.emit("resume"),this.processReceivedData()},_.prototype.pause=function(){this._debug("pause: pause requested"),this.socket.pause()},_.prototype.resume=function(){this._debug("resume: resume requested"),this.socket.resume()},_.prototype.close=function(e,t){if(this.connected){if(this._debug("close: Initating clean WebSocket close sequence."),"number"!=typeof e&&(e=_.CLOSE_REASON_NORMAL),!v(e))throw new Error("Close code "+e+" is not valid.");"string"!=typeof t&&(t=_.CLOSE_DESCRIPTIONS[e]),this.closeReasonCode=e,this.closeDescription=t,this.setCloseTimer(),this.sendCloseFrame(this.closeReasonCode,this.closeDescription),this.state=d,this.connected=!1}},_.prototype.drop=function(e,t,r){this._debug("drop"),"number"!=typeof e&&(e=_.CLOSE_REASON_PROTOCOL_ERROR),"string"!=typeof t&&(t=_.CLOSE_DESCRIPTIONS[e]),this._debug("Forcefully dropping connection. skipCloseFrame: %s, code: %d, description: %s",r,e,t),this.closeReasonCode=e,this.closeDescription=t,this.frameQueue=[],this.fragmentationSize=0,r||this.sendCloseFrame(e,t),this.connected=!1,this.state=f,this.clearCloseTimer(),this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this.closeEventEmitted||(this.closeEventEmitted=!0,this._debug("Emitting WebSocketConnection close event"),this.emit("close",this.closeReasonCode,this.closeDescription)),this._debug("Drop: destroying socket"),this.socket.destroy()},_.prototype.setCloseTimer=function(){this._debug("setCloseTimer"),this.clearCloseTimer(),this._debug("Setting close timer"),this.waitingForCloseResponse=!0,this.closeTimer=setTimeout(this._closeTimerHandler,this.closeTimeout)},_.prototype.clearCloseTimer=function(){this._debug("clearCloseTimer"),this.closeTimer&&(this._debug("Clearing close timer"),clearTimeout(this.closeTimer),this.waitingForCloseResponse=!1,this.closeTimer=null)},_.prototype.handleCloseTimer=function(){this._debug("handleCloseTimer"),this.closeTimer=null,this.waitingForCloseResponse&&(this._debug("Close response not received from client.  Forcing socket end."),this.waitingForCloseResponse=!1,this.state=f,this.socket.end())},_.prototype.processFrame=function(e){if(this._debug("processFrame"),this._debug(" -- frame: %s",e),0!==this.frameQueue.length&&e.opcode>0&&e.opcode<8)this.drop(_.CLOSE_REASON_PROTOCOL_ERROR,"Illegal frame opcode 0x"+e.opcode.toString(16)+" received in middle of fragmented message.");else switch(e.opcode){case 2:this._debug("-- Binary Frame"),this.assembleFragments&&(e.fin?(this._debug("---- Emitting 'message' event"),this.emit("message",{type:"binary",binaryData:e.binaryPayload})):(this.frameQueue.push(e),this.fragmentationSize=e.length));break;case 1:if(this._debug("-- Text Frame"),this.assembleFragments)if(e.fin){if(!h(e.binaryPayload))return void this.drop(_.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this._debug("---- Emitting 'message' event"),this.emit("message",{type:"utf8",utf8Data:e.binaryPayload.toString("utf8")})}else this.frameQueue.push(e),this.fragmentationSize=e.length;break;case 0:if(this._debug("-- Continuation Frame"),this.assembleFragments){if(0===this.frameQueue.length)return void this.drop(_.CLOSE_REASON_PROTOCOL_ERROR,"Unexpected Continuation Frame");if(this.fragmentationSize+=e.length,this.fragmentationSize>this.maxReceivedMessageSize)return void this.drop(_.CLOSE_REASON_MESSAGE_TOO_BIG,"Maximum message size exceeded.");if(this.frameQueue.push(e),e.fin){var t=0,r=l(this.fragmentationSize),s=this.frameQueue[0].opcode;switch(this.frameQueue.forEach((function(e){e.binaryPayload.copy(r,t),t+=e.binaryPayload.length})),this.frameQueue=[],this.fragmentationSize=0,s){case 2:this.emit("message",{type:"binary",binaryData:r});break;case 1:if(!h(r))return void this.drop(_.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this.emit("message",{type:"utf8",utf8Data:r.toString("utf8")});break;default:return void this.drop(_.CLOSE_REASON_PROTOCOL_ERROR,"Unexpected first opcode in fragmentation sequence: 0x"+s.toString(16))}}}break;case 9:if(this._debug("-- Ping Frame"),this._pingListenerCount>0){var n=!1;this.emit("ping",(function(){n=!0}),e.binaryPayload),n||this.pong(e.binaryPayload)}else this.pong(e.binaryPayload);break;case 10:this._debug("-- Pong Frame"),this.emit("pong",e.binaryPayload);break;case 8:if(this._debug("-- Close Frame"),this.waitingForCloseResponse)return this._debug("---- Got close response from peer.  Completing closing handshake."),this.clearCloseTimer(),this.waitingForCloseResponse=!1,this.state=f,void this.socket.end();var i;if(this._debug("---- Closing handshake initiated by peer."),this.state=p,e.invalidCloseFrameLength?(this.closeReasonCode=1005,i=_.CLOSE_REASON_PROTOCOL_ERROR):-1===e.closeStatus||v(e.closeStatus)?(this.closeReasonCode=e.closeStatus,i=_.CLOSE_REASON_NORMAL):(this.closeReasonCode=e.closeStatus,i=_.CLOSE_REASON_PROTOCOL_ERROR),e.binaryPayload.length>1){if(!h(e.binaryPayload))return void this.drop(_.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this.closeDescription=e.binaryPayload.toString("utf8")}else this.closeDescription=_.CLOSE_DESCRIPTIONS[this.closeReasonCode];this._debug("------ Remote peer %s - code: %d - %s - close frame payload length: %d",this.remoteAddress,this.closeReasonCode,this.closeDescription,e.length),this._debug("------ responding to remote peer's close request."),this.sendCloseFrame(i,null),this.connected=!1;break;default:this._debug("-- Unrecognized Opcode %d",e.opcode),this.drop(_.CLOSE_REASON_PROTOCOL_ERROR,"Unrecognized Opcode: 0x"+e.opcode.toString(16))}},_.prototype.send=function(e,t){if(this._debug("send"),Buffer.isBuffer(e))this.sendBytes(e,t);else{if("function"!=typeof e.toString)throw new Error("Data provided must either be a Node Buffer or implement toString()");this.sendUTF(e,t)}},_.prototype.sendUTF=function(e,t){e=c(e.toString(),"utf8"),this._debug("sendUTF: %d bytes",e.length);var r=new o(this.maskBytes,this.frameHeader,this.config);r.opcode=1,r.binaryPayload=e,this.fragmentAndSend(r,t)},_.prototype.sendBytes=function(e,t){if(this._debug("sendBytes"),!Buffer.isBuffer(e))throw new Error("You must pass a Node Buffer object to WebSocketConnection.prototype.sendBytes()");var r=new o(this.maskBytes,this.frameHeader,this.config);r.opcode=2,r.binaryPayload=e,this.fragmentAndSend(r,t)},_.prototype.ping=function(e){this._debug("ping");var t=new o(this.maskBytes,this.frameHeader,this.config);t.opcode=9,t.fin=!0,e&&(Buffer.isBuffer(e)||(e=c(e.toString(),"utf8")),e.length>125&&(this._debug("WebSocket: Data for ping is longer than 125 bytes.  Truncating."),e=e.slice(0,124)),t.binaryPayload=e),this.sendFrame(t)},_.prototype.pong=function(e){this._debug("pong");var t=new o(this.maskBytes,this.frameHeader,this.config);t.opcode=10,Buffer.isBuffer(e)&&e.length>125&&(this._debug("WebSocket: Data for pong is longer than 125 bytes.  Truncating."),e=e.slice(0,124)),t.binaryPayload=e,t.fin=!0,this.sendFrame(t)},_.prototype.fragmentAndSend=function(e,t){if(this._debug("fragmentAndSend"),e.opcode>7)throw new Error("You cannot fragment control frames.");var r=this.config.fragmentationThreshold,s=e.binaryPayload.length;if(!this.config.fragmentOutgoingMessages||e.binaryPayload&&s<=r)return e.fin=!0,void this.sendFrame(e,t);for(var n=Math.ceil(s/r),i=0,a=function(e){e?"function"==typeof t&&(t(e),t=null):++i===n&&"function"==typeof t&&t()},h=1;h<=n;h++){var l=new o(this.maskBytes,this.frameHeader,this.config);l.opcode=1===h?e.opcode:0,l.fin=h===n;var c=h===n?s-r*(h-1):r,u=r*(h-1);l.binaryPayload=e.binaryPayload.slice(u,u+c),this.sendFrame(l,a)}},_.prototype.sendCloseFrame=function(e,t,r){if("number"!=typeof e&&(e=_.CLOSE_REASON_NORMAL),this._debug("sendCloseFrame state: %s, reasonCode: %d, description: %s",this.state,e,t),this.state===u||this.state===p){var s=new o(this.maskBytes,this.frameHeader,this.config);s.fin=!0,s.opcode=8,s.closeStatus=e,"string"==typeof t&&(s.binaryPayload=c(t,"utf8")),this.sendFrame(s,r),this.socket.end()}},_.prototype.sendFrame=function(e,t){this._debug("sendFrame"),e.mask=this.maskOutgoingPackets;var r=this.socket.write(e.toBuffer(),t);return this.outputBufferFull=!r,r},e.exports=_},804:(e,t,r)=>{var s=r(4987),n=r(4831).bufferAllocUnsafe;function i(e,t,r){this.maskBytes=e,this.frameHeader=t,this.config=r,this.maxReceivedFrameSize=r.maxReceivedFrameSize,this.protocolError=!1,this.frameTooLarge=!1,this.invalidCloseFrameLength=!1,this.parseState=1,this.closeStatus=-1}i.prototype.addData=function(e){if(1===this.parseState&&e.length>=2){e.joinInto(this.frameHeader,0,0,2),e.advance(2);var t=this.frameHeader[0],r=this.frameHeader[1];if(this.fin=Boolean(128&t),this.rsv1=Boolean(64&t),this.rsv2=Boolean(32&t),this.rsv3=Boolean(16&t),this.mask=Boolean(128&r),this.opcode=15&t,this.length=127&r,this.opcode>=8){if(this.length>125)return this.protocolError=!0,this.dropReason="Illegal control frame longer than 125 bytes.",!0;if(!this.fin)return this.protocolError=!0,this.dropReason="Control frames must not be fragmented.",!0}126===this.length?this.parseState=2:127===this.length?this.parseState=3:this.parseState=4}if(2===this.parseState)e.length>=2&&(e.joinInto(this.frameHeader,2,0,2),e.advance(2),this.length=this.frameHeader.readUInt16BE(2),this.parseState=4);else if(3===this.parseState&&e.length>=8){e.joinInto(this.frameHeader,2,0,8),e.advance(8);var i=[this.frameHeader.readUInt32BE(2),this.frameHeader.readUInt32BE(6)];if(0!==i[0])return this.protocolError=!0,this.dropReason="Unsupported 64-bit length frame received",!0;this.length=i[1],this.parseState=4}if(4===this.parseState&&(this.mask?e.length>=4&&(e.joinInto(this.maskBytes,0,0,4),e.advance(4),this.parseState=5):this.parseState=5),5===this.parseState){if(this.length>this.maxReceivedFrameSize)return this.frameTooLarge=!0,this.dropReason="Frame size of "+this.length.toString(10)+" bytes exceeds maximum accepted frame size",!0;if(0===this.length)return this.binaryPayload=n(0),this.parseState=6,!0;if(e.length>=this.length)return this.binaryPayload=e.take(this.length),e.advance(this.length),this.mask&&s.unmask(this.binaryPayload,this.maskBytes),8===this.opcode&&(1===this.length&&(this.binaryPayload=n(0),this.invalidCloseFrameLength=!0),this.length>=2&&(this.closeStatus=this.binaryPayload.readUInt16BE(0),this.binaryPayload=this.binaryPayload.slice(2))),this.parseState=6,!0}return!1},i.prototype.throwAwayPayload=function(e){return e.length>=this.length&&(e.advance(this.length),this.parseState=6,!0)},i.prototype.toBuffer=function(e){var t,r,i,o=2,a=0,h=0;this.fin&&(a|=128),this.rsv1&&(a|=64),this.rsv2&&(a|=32),this.rsv3&&(a|=16),this.mask&&(h|=128),a|=15&this.opcode,8===this.opcode?(this.length=2,this.binaryPayload&&(this.length+=this.binaryPayload.length),(r=n(this.length)).writeUInt16BE(this.closeStatus,0),this.length>2&&this.binaryPayload.copy(r,2)):this.binaryPayload?(r=this.binaryPayload,this.length=r.length):this.length=0,this.length<=125?h|=127&this.length:this.length>125&&this.length<=65535?(h|=126,o+=2):this.length>65535&&(h|=127,o+=8);var l=n(this.length+o+(this.mask?4:0));return l[0]=a,l[1]=h,i=2,this.length>125&&this.length<=65535?(l.writeUInt16BE(this.length,i),i+=2):this.length>65535&&(l.writeUInt32BE(0,i),l.writeUInt32BE(this.length,i+4),i+=8),this.mask?(t=e?0:4294967295*Math.random()>>>0,this.maskBytes.writeUInt32BE(t,0),this.maskBytes.copy(l,i),i+=4,r&&s.mask(r,this.maskBytes,l,i,this.length)):r&&r.copy(l,i),l},i.prototype.toString=function(){return"Opcode: "+this.opcode+", fin: "+this.fin+", length: "+this.length+", hasPayload: "+Boolean(this.binaryPayload)+", masked: "+this.mask},e.exports=i},6196:(e,t,r)=>{for(var s=r(6417),n=r(1669),i=r(8835),o=r(8614).EventEmitter,a=r(2496),h=/,\s*/,l=/;\s*/,c=/[\r\n]/g,u=/,\s*/,p=["(",")","<",">","@",",",";",":","\\",'"',"/","[","]","?","=","{","}"," ",String.fromCharCode(9)],d=[String.fromCharCode(127)],f=0;f<31;f++)d.push(String.fromCharCode(f));var g=/([\x00-\x20\x22\x28\x29\x2c\x2f\x3a-\x3f\x40\x5b-\x5e\x7b\x7d\x7f])/,m=/[^\x21\x23-\x2b\x2d-\x3a\x3c-\x5b\x5d-\x7e]/,_=/^"[^"]*"$/,v=/[\x00-\x20\x3b]/g,y=/[;,] */,b={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",406:"Not Acceptable",407:"Proxy Authorization Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Long",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"};function w(e,t,r){o.call(this),this.socket=e,this.httpRequest=t,this.resource=t.url,this.remoteAddress=e.remoteAddress,this.remoteAddresses=[this.remoteAddress],this.serverConfig=r,this._socketIsClosing=!1,this._socketCloseHandler=this._handleSocketCloseBeforeAccept.bind(this),this.socket.on("end",this._socketCloseHandler),this.socket.on("close",this._socketCloseHandler),this._resolved=!1}function O(e){process.nextTick((function(){e.drop(1006,"TCP connection lost before handshake completed.",!0)}))}n.inherits(w,o),w.prototype.readHandshake=function(){var e=this,t=this.httpRequest;if(this.resourceURL=i.parse(this.resource,!0),this.host=t.headers.host,!this.host)throw new Error("Client must provide a Host header.");if(this.key=t.headers["sec-websocket-key"],!this.key)throw new Error("Client must provide a value for Sec-WebSocket-Key.");if(this.webSocketVersion=parseInt(t.headers["sec-websocket-version"],10),!this.webSocketVersion||isNaN(this.webSocketVersion))throw new Error("Client must provide a value for Sec-WebSocket-Version.");switch(this.webSocketVersion){case 8:case 13:break;default:var r=new Error("Unsupported websocket client version: "+this.webSocketVersion+"Only versions 8 and 13 are supported.");throw r.httpCode=426,r.headers={"Sec-WebSocket-Version":"13"},r}13===this.webSocketVersion?this.origin=t.headers.origin:8===this.webSocketVersion&&(this.origin=t.headers["sec-websocket-origin"]);var s=t.headers["sec-websocket-protocol"];if(this.protocolFullCaseMap={},this.requestedProtocols=[],s&&s.split(h).forEach((function(t){var r=t.toLocaleLowerCase();e.requestedProtocols.push(r),e.protocolFullCaseMap[r]=t})),!this.serverConfig.ignoreXForwardedFor&&t.headers["x-forwarded-for"]){var n=this.remoteAddress;this.remoteAddresses=t.headers["x-forwarded-for"].split(u),this.remoteAddresses.push(n),this.remoteAddress=this.remoteAddresses[0]}var o=t.headers["sec-websocket-extensions"];this.requestedExtensions=this.parseExtensions(o);var a=t.headers.cookie;this.cookies=this.parseCookies(a)},w.prototype.parseExtensions=function(e){if(!e||0===e.length)return[];var t=e.toLocaleLowerCase().split(h);return t.forEach((function(e,t,r){var s=e.split(l),n=s[0],i=s.slice(1);i.forEach((function(e,t,r){var s=e.split("="),n={name:s[0],value:s[1]};r.splice(t,1,n)}));var o={name:n,params:i};r.splice(t,1,o)})),t},w.prototype.parseCookies=function(e){if(!e||"string"!=typeof e)return[];var t=[];return e.split(y).forEach((function(e){var r=e.indexOf("=");if(-1!==r){var s=e.substr(0,r).trim(),n=e.substr(++r,e.length).trim();'"'===n[0]&&(n=n.slice(1,-1)),t.push({name:s,value:decodeURIComponent(n)})}else t.push({name:e,value:null})})),t},w.prototype.accept=function(e,t,r){var n;this._verifyResolution(),e?void 0===(n=this.protocolFullCaseMap[e.toLocaleLowerCase()])&&(n=e):n=e,this.protocolFullCaseMap=null;var i=s.createHash("sha1");i.update(this.key+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var o="HTTP/1.1 101 Switching Protocols\r\nUpgrade: websocket\r\nConnection: Upgrade\r\nSec-WebSocket-Accept: "+i.digest("base64")+"\r\n";if(n){for(var h=0;h<n.length;h++){var l=n.charCodeAt(h),u=n.charAt(h);if(l<33||l>126||-1!==p.indexOf(u))throw this.reject(500),new Error('Illegal character "'+String.fromCharCode(u)+'" in subprotocol.')}if(-1===this.requestedProtocols.indexOf(e))throw this.reject(500),new Error("Specified protocol was not requested by the client.");n=n.replace(c,""),o+="Sec-WebSocket-Protocol: "+n+"\r\n"}if(this.requestedProtocols=null,t&&(t=t.replace(c,""),13===this.webSocketVersion?o+="Origin: "+t+"\r\n":8===this.webSocketVersion&&(o+="Sec-WebSocket-Origin: "+t+"\r\n")),r){if(!Array.isArray(r))throw this.reject(500),new Error('Value supplied for "cookies" argument must be an array.');var d={};r.forEach(function(e){if(!e.name||!e.value)throw this.reject(500),new Error('Each cookie to set must at least provide a "name" and "value"');if(e.name=e.name.replace(v,""),e.value=e.value.replace(v,""),d[e.name])throw this.reject(500),new Error("You may not specify the same cookie name twice.");d[e.name]=!0;var t=e.name.match(g);if(t)throw this.reject(500),new Error("Illegal character "+t[0]+" in cookie name");if(t=e.value.match(_)?e.value.slice(1,-1).match(m):e.value.match(m))throw this.reject(500),new Error("Illegal character "+t[0]+" in cookie value");var r=[e.name+"="+e.value];if(e.path){if(t=e.path.match(v))throw this.reject(500),new Error("Illegal character "+t[0]+" in cookie path");r.push("Path="+e.path)}if(e.domain){if("string"!=typeof e.domain)throw this.reject(500),new Error("Domain must be specified and must be a string.");if(t=e.domain.match(v))throw this.reject(500),new Error("Illegal character "+t[0]+" in cookie domain");r.push("Domain="+e.domain.toLowerCase())}if(e.expires){if(!(e.expires instanceof Date))throw this.reject(500),new Error('Value supplied for cookie "expires" must be a vaild date object');r.push("Expires="+e.expires.toGMTString())}if(e.maxage){var s=e.maxage;if("string"==typeof s&&(s=parseInt(s,10)),isNaN(s)||s<=0)throw this.reject(500),new Error('Value supplied for cookie "maxage" must be a non-zero number');s=Math.round(s),r.push("Max-Age="+s.toString(10))}if(e.secure){if("boolean"!=typeof e.secure)throw this.reject(500),new Error('Value supplied for cookie "secure" must be of type boolean');r.push("Secure")}if(e.httponly){if("boolean"!=typeof e.httponly)throw this.reject(500),new Error('Value supplied for cookie "httponly" must be of type boolean');r.push("HttpOnly")}o+="Set-Cookie: "+r.join(";")+"\r\n"}.bind(this))}this._resolved=!0,this.emit("requestResolved",this),o+="\r\n";var f=new a(this.socket,[],e,!1,this.serverConfig);f.webSocketVersion=this.webSocketVersion,f.remoteAddress=this.remoteAddress,f.remoteAddresses=this.remoteAddresses;var y=this;return this._socketIsClosing?O(f):this.socket.write(o,"ascii",(function(e){e?O(f):(y._removeSocketCloseListeners(),f._addSocketEventListeners())})),this.emit("requestAccepted",f),f},w.prototype.reject=function(e,t,r){this._verifyResolution(),this._resolved=!0,this.emit("requestResolved",this),"number"!=typeof e&&(e=403);var s="HTTP/1.1 "+e+" "+b[e]+"\r\nConnection: close\r\n";if(t&&(s+="X-WebSocket-Reject-Reason: "+(t=t.replace(c,""))+"\r\n"),r)for(var n in r){var i=r[n].toString().replace(c,"");s+=n.replace(c,"")+": "+i+"\r\n"}s+="\r\n",this.socket.end(s,"ascii"),this.emit("requestRejected",this)},w.prototype._handleSocketCloseBeforeAccept=function(){this._socketIsClosing=!0,this._removeSocketCloseListeners()},w.prototype._removeSocketCloseListeners=function(){this.socket.removeListener("end",this._socketCloseHandler),this.socket.removeListener("close",this._socketCloseHandler)},w.prototype._verifyResolution=function(){if(this._resolved)throw new Error("WebSocketRequest may only be accepted or rejected one time.")},e.exports=w},2844:(e,t,r)=>{var s=r(4831).extend,n=r(1669),i=r(8614).EventEmitter,o=r(8690);function a(e){i.call(this),this.config={server:null},e&&s(this.config,e),this.handlers=[],this._requestHandler=this.handleRequest.bind(this),this.config.server&&this.attachServer(this.config.server)}n.inherits(a,i),a.prototype.attachServer=function(e){if(!e)throw new Error("You must specify a WebSocketServer instance to attach to.");this.server=e,this.server.on("request",this._requestHandler)},a.prototype.detachServer=function(){if(!this.server)throw new Error("Cannot detach from server: not attached.");this.server.removeListener("request",this._requestHandler),this.server=null},a.prototype.mount=function(e,t,r){if(!e)throw new Error("You must specify a path for this handler.");if(t||(t="____no_protocol____"),!r)throw new Error("You must specify a callback for this handler.");if(!((e=this.pathToRegExp(e))instanceof RegExp))throw new Error("Path must be specified as either a string or a RegExp.");var s=e.toString();if(t=t.toLocaleLowerCase(),-1!==this.findHandlerIndex(s,t))throw new Error("You may only mount one handler per path/protocol combination.");this.handlers.push({path:e,pathString:s,protocol:t,callback:r})},a.prototype.unmount=function(e,t){var r=this.findHandlerIndex(this.pathToRegExp(e).toString(),t);if(-1===r)throw new Error("Unable to find a route matching the specified path and protocol.");this.handlers.splice(r,1)},a.prototype.findHandlerIndex=function(e,t){t=t.toLocaleLowerCase();for(var r=0,s=this.handlers.length;r<s;r++){var n=this.handlers[r];if(n.pathString===e&&n.protocol===t)return r}return-1},a.prototype.pathToRegExp=function(e){return"string"==typeof e&&("*"===e?e=/^.*$/:(e=e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),e=new RegExp("^"+e+"$"))),e},a.prototype.handleRequest=function(e){var t=e.requestedProtocols;0===t.length&&(t=["____no_protocol____"]);for(var r=0;r<t.length;r++)for(var s=t[r].toLocaleLowerCase(),n=0,i=this.handlers.length;n<i;n++){var a=this.handlers[n];if(a.path.test(e.resourceURL.pathname)&&(s===a.protocol||"*"===a.protocol)){var h=new o(e,s);return void a.callback(h)}}e.reject(404,"No handler is available for the given request.")},e.exports=a},8690:(e,t,r)=>{var s=r(1669),n=r(8614).EventEmitter;function i(e,t){n.call(this),this.webSocketRequest=e,this.protocol="____no_protocol____"===t?null:t,this.origin=e.origin,this.resource=e.resource,this.resourceURL=e.resourceURL,this.httpRequest=e.httpRequest,this.remoteAddress=e.remoteAddress,this.webSocketVersion=e.webSocketVersion,this.requestedExtensions=e.requestedExtensions,this.cookies=e.cookies}s.inherits(i,n),i.prototype.accept=function(e,t){var r=this.webSocketRequest.accept(this.protocol,e,t);return this.emit("requestAccepted",r),r},i.prototype.reject=function(e,t,r){this.webSocketRequest.reject(e,t,r),this.emit("requestRejected",this)},e.exports=i},5635:(e,t,r)=>{var s=r(4831).extend,n=r(4831),i=r(1669),o=r(324)("websocket:server"),a=r(8614).EventEmitter,h=r(6196),l=function(e){a.call(this),this._handlers={upgrade:this.handleUpgrade.bind(this),requestAccepted:this.handleRequestAccepted.bind(this),requestResolved:this.handleRequestResolved.bind(this)},this.connections=[],this.pendingRequests=[],e&&this.mount(e)};i.inherits(l,a),l.prototype.mount=function(e){if(this.config={httpServer:null,maxReceivedFrameSize:65536,maxReceivedMessageSize:1048576,fragmentOutgoingMessages:!0,fragmentationThreshold:16384,keepalive:!0,keepaliveInterval:2e4,dropConnectionOnKeepaliveTimeout:!0,keepaliveGracePeriod:1e4,useNativeKeepalive:!1,assembleFragments:!0,autoAcceptConnections:!1,ignoreXForwardedFor:!1,disableNagleAlgorithm:!0,closeTimeout:5e3},s(this.config,e),!this.config.httpServer)throw new Error("You must specify an httpServer on which to mount the WebSocket server.");Array.isArray(this.config.httpServer)||(this.config.httpServer=[this.config.httpServer]);var t=this._handlers.upgrade;this.config.httpServer.forEach((function(e){e.on("upgrade",t)}))},l.prototype.unmount=function(){var e=this._handlers.upgrade;this.config.httpServer.forEach((function(t){t.removeListener("upgrade",e)}))},l.prototype.closeAllConnections=function(){this.connections.forEach((function(e){e.close()})),this.pendingRequests.forEach((function(e){process.nextTick((function(){e.reject(503)}))}))},l.prototype.broadcast=function(e){Buffer.isBuffer(e)?this.broadcastBytes(e):"function"==typeof e.toString&&this.broadcastUTF(e)},l.prototype.broadcastUTF=function(e){this.connections.forEach((function(t){t.sendUTF(e)}))},l.prototype.broadcastBytes=function(e){this.connections.forEach((function(t){t.sendBytes(e)}))},l.prototype.shutDown=function(){this.unmount(),this.closeAllConnections()},l.prototype.handleUpgrade=function(e,t){var r=this,s=new h(t,e,this.config);try{s.readHandshake()}catch(e){return s.reject(e.httpCode?e.httpCode:400,e.message,e.headers),void o("Invalid handshake: %s",e.message)}this.pendingRequests.push(s),s.once("requestAccepted",this._handlers.requestAccepted),s.once("requestResolved",this._handlers.requestResolved),t.once("close",(function(){r._handlers.requestResolved(s)})),!this.config.autoAcceptConnections&&n.eventEmitterListenerCount(this,"request")>0?this.emit("request",s):this.config.autoAcceptConnections?s.accept(s.requestedProtocols[0],s.origin):s.reject(404,"No handler is configured to accept the connection.")},l.prototype.handleRequestAccepted=function(e){var t=this;e.once("close",(function(r,s){t.handleConnectionClose(e,r,s)})),this.connections.push(e),this.emit("connect",e)},l.prototype.handleConnectionClose=function(e,t,r){var s=this.connections.indexOf(e);-1!==s&&this.connections.splice(s,1),this.emit("close",e,t,r)},l.prototype.handleRequestResolved=function(e){var t=this.pendingRequests.indexOf(e);-1!==t&&this.pendingRequests.splice(t,1)},e.exports=l},4831:(e,t,r)=>{var s=t.noop=function(){};function n(e,t,r){this.logFunction=r,this.identifier=e,this.uniqueID=t,this.buffer=[]}t.extend=function(e,t){for(var r in t)e[r]=t[r]},t.eventEmitterListenerCount=r(8614).EventEmitter.listenerCount||function(e,t){return e.listeners(t).length},t.bufferAllocUnsafe=Buffer.allocUnsafe?Buffer.allocUnsafe:function(e){return new Buffer(e)},t.bufferFromString=Buffer.from?Buffer.from:function(e,t){return new Buffer(e,t)},t.BufferingLogger=function(e,t){var i=r(324)(e);if(i.enabled){var o=new n(e,t,i),a=o.log.bind(o);return a.printOutput=o.printOutput.bind(o),a.enabled=i.enabled,a}return i.printOutput=s,i},n.prototype.log=function(){return this.buffer.push([new Date,Array.prototype.slice.call(arguments)]),this},n.prototype.clear=function(){return this.buffer=[],this},n.prototype.printOutput=function(e){e||(e=this.logFunction);var t=this.uniqueID;this.buffer.forEach((function(r){var s=r[0].toLocaleString(),n=r[1].slice(),i=n[0];null!=i&&(i="%s - %s - "+i.toString(),n.splice(0,1,i,s,t),e.apply(global,n))}))}},1086:(e,t,r)=>{e.exports=r(1468).version},8328:(e,t,r)=>{e.exports={server:r(5635),client:r(1289),router:r(2844),frame:r(804),request:r(6196),connection:r(2496),w3cwebsocket:r(4149),deprecation:r(8360),version:r(1086)}},1468:e=>{"use strict";e.exports={version:"1.0.32"}},6911:(e,t,r)=>{var s=r(4293).Buffer,n=r(8614).EventEmitter,i=r(4831).bufferAllocUnsafe;function o(e){if(!(this instanceof o))return new o(e);n.call(this);var t=this;void 0===e&&(e={}),t.encoding=e.encoding;var r={next:null,buffer:null},a={next:null,buffer:null},h=0;t.__defineGetter__("length",(function(){return h}));var l=0;t.write=function(e){return r.buffer?(a.next={next:null,buffer:e},a=a.next):(r.buffer=e,a=r),h+=e.length,t.emit("write",e),!0},t.end=function(e){s.isBuffer(e)&&t.write(e)},t.push=function(){var e=[].concat.apply([],arguments);return e.forEach(t.write),t},t.forEach=function(e){if(!r.buffer)return i(0);if(r.buffer.length-l<=0)return t;for(var s={buffer:r.buffer.slice(l),next:r.next};s&&s.buffer&&!e(s.buffer);)s=s.next;return t},t.join=function(e,s){if(!r.buffer)return i(0);null==e&&(e=0),null==s&&(s=t.length);var n=i(s-e),o=0;return t.forEach((function(t){if(e<o+t.length&&o<s&&t.copy(n,Math.max(0,o-e),Math.max(0,e-o),Math.min(t.length,s-o)),(o+=t.length)>s)return!0})),n},t.joinInto=function(e,s,n,o){if(!r.buffer)return new i(0);null==n&&(n=0),null==o&&(o=t.length);var a=e;if(a.length-s<o-n)throw new Error("Insufficient space available in target Buffer.");var h=0;return t.forEach((function(e){if(n<h+e.length&&h<o&&e.copy(a,Math.max(s,s+h-n),Math.max(0,n-h),Math.min(e.length,o-h)),(h+=e.length)>o)return!0})),a},t.advance=function(e){for(l+=e,h-=e;r.buffer&&l>=r.buffer.length;)l-=r.buffer.length,r=r.next?r.next:{buffer:null,next:null};return null===r.buffer&&(a={next:null,buffer:null}),t.emit("advance",e),t},t.take=function(e,r){if(null==e?e=t.length:"number"!=typeof e&&(r=e,e=t.length),r||(r=t.encoding),r){var s="";return t.forEach((function(t){if(e<=0)return!0;s+=t.toString(r,0,Math.min(e,t.length)),e-=t.length})),s}return t.join(0,e)},t.toString=function(){return t.take("binary")}}e.exports=o,e.exports.BufferList=o,r(1669).inherits(o,n)},2041:(e,t,r)=>{"use strict";const s=r(82);s.createWebSocketStream=r(8135),s.Server=r(7082),s.Receiver=r(4586),s.Sender=r(2530),e.exports=s},5210:(e,t,r)=>{"use strict";const{EMPTY_BUFFER:s}=r(1372);function n(e,t){if(0===e.length)return s;if(1===e.length)return e[0];const r=Buffer.allocUnsafe(t);let n=0;for(let t=0;t<e.length;t++){const s=e[t];r.set(s,n),n+=s.length}return n<t?r.slice(0,n):r}function i(e,t,r,s,n){for(let i=0;i<n;i++)r[s+i]=e[i]^t[3&i]}function o(e,t){const r=e.length;for(let s=0;s<r;s++)e[s]^=t[3&s]}function a(e){return e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}function h(e){if(h.readOnly=!0,Buffer.isBuffer(e))return e;let t;return e instanceof ArrayBuffer?t=Buffer.from(e):ArrayBuffer.isView(e)?t=Buffer.from(e.buffer,e.byteOffset,e.byteLength):(t=Buffer.from(e),h.readOnly=!1),t}try{const t=r(4987),s=t.BufferUtil||t;e.exports={concat:n,mask(e,t,r,n,o){o<48?i(e,t,r,n,o):s.mask(e,t,r,n,o)},toArrayBuffer:a,toBuffer:h,unmask(e,t){e.length<32?o(e,t):s.unmask(e,t)}}}catch(t){e.exports={concat:n,mask:i,toArrayBuffer:a,toBuffer:h,unmask:o}}},1372:e=>{"use strict";e.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}},4901:e=>{"use strict";class t{constructor(e,t){this.target=t,this.type=e}}class r extends t{constructor(e,t){super("message",t),this.data=e}}class s extends t{constructor(e,t,r){super("close",r),this.wasClean=r._closeFrameReceived&&r._closeFrameSent,this.reason=t,this.code=e}}class n extends t{constructor(e){super("open",e)}}class i extends t{constructor(e,t){super("error",t),this.message=e.message,this.error=e}}const o={addEventListener(e,t,o){if("function"!=typeof t)return;function a(e){t.call(this,new r(e,this))}function h(e,r){t.call(this,new s(e,r,this))}function l(e){t.call(this,new i(e,this))}function c(){t.call(this,new n(this))}const u=o&&o.once?"once":"on";"message"===e?(a._listener=t,this[u](e,a)):"close"===e?(h._listener=t,this[u](e,h)):"error"===e?(l._listener=t,this[u](e,l)):"open"===e?(c._listener=t,this[u](e,c)):this[u](e,t)},removeEventListener(e,t){const r=this.listeners(e);for(let s=0;s<r.length;s++)r[s]!==t&&r[s]._listener!==t||this.removeListener(e,r[s])}};e.exports=o},921:e=>{"use strict";const t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function r(e,t,r){void 0===e[t]?e[t]=[r]:e[t].push(r)}e.exports={format:function(e){return Object.keys(e).map((t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map((e=>[t].concat(Object.keys(e).map((t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map((e=>!0===e?t:`${t}=${e}`)).join("; ")}))).join("; "))).join(", ")})).join(", ")},parse:function(e){const s=Object.create(null);if(void 0===e||""===e)return s;let n,i,o=Object.create(null),a=!1,h=!1,l=!1,c=-1,u=-1,p=0;for(;p<e.length;p++){const d=e.charCodeAt(p);if(void 0===n)if(-1===u&&1===t[d])-1===c&&(c=p);else if(32===d||9===d)-1===u&&-1!==c&&(u=p);else{if(59!==d&&44!==d)throw new SyntaxError("Unexpected character at index "+p);{if(-1===c)throw new SyntaxError("Unexpected character at index "+p);-1===u&&(u=p);const t=e.slice(c,u);44===d?(r(s,t,o),o=Object.create(null)):n=t,c=u=-1}}else if(void 0===i)if(-1===u&&1===t[d])-1===c&&(c=p);else if(32===d||9===d)-1===u&&-1!==c&&(u=p);else if(59===d||44===d){if(-1===c)throw new SyntaxError("Unexpected character at index "+p);-1===u&&(u=p),r(o,e.slice(c,u),!0),44===d&&(r(s,n,o),o=Object.create(null),n=void 0),c=u=-1}else{if(61!==d||-1===c||-1!==u)throw new SyntaxError("Unexpected character at index "+p);i=e.slice(c,p),c=u=-1}else if(h){if(1!==t[d])throw new SyntaxError("Unexpected character at index "+p);-1===c?c=p:a||(a=!0),h=!1}else if(l)if(1===t[d])-1===c&&(c=p);else if(34===d&&-1!==c)l=!1,u=p;else{if(92!==d)throw new SyntaxError("Unexpected character at index "+p);h=!0}else if(34===d&&61===e.charCodeAt(p-1))l=!0;else if(-1===u&&1===t[d])-1===c&&(c=p);else if(-1===c||32!==d&&9!==d){if(59!==d&&44!==d)throw new SyntaxError("Unexpected character at index "+p);{if(-1===c)throw new SyntaxError("Unexpected character at index "+p);-1===u&&(u=p);let t=e.slice(c,u);a&&(t=t.replace(/\\/g,""),a=!1),r(o,i,t),44===d&&(r(s,n,o),o=Object.create(null),n=void 0),i=void 0,c=u=-1}}else-1===u&&(u=p)}if(-1===c||l)throw new SyntaxError("Unexpected end of input");-1===u&&(u=p);const d=e.slice(c,u);return void 0===n?r(s,d,o):(void 0===i?r(o,d,!0):r(o,i,a?d.replace(/\\/g,""):d),r(s,n,o)),s}}},7169:e=>{"use strict";const t=Symbol("kDone"),r=Symbol("kRun");e.exports=class{constructor(e){this[t]=()=>{this.pending--,this[r]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[r]()}[r](){if(this.pending!==this.concurrency&&this.jobs.length){const e=this.jobs.shift();this.pending++,e(this[t])}}}},5895:(e,t,r)=>{"use strict";const s=r(8761),n=r(5210),i=r(7169),{kStatusCode:o,NOOP:a}=r(1372),h=Buffer.from([0,0,255,255]),l=Symbol("permessage-deflate"),c=Symbol("total-length"),u=Symbol("callback"),p=Symbol("buffers"),d=Symbol("error");let f;function g(e){this[p].push(e),this[c]+=e.length}function m(e){this[c]+=e.length,this[l]._maxPayload<1||this[c]<=this[l]._maxPayload?this[p].push(e):(this[d]=new RangeError("Max payload size exceeded"),this[d][o]=1009,this.removeListener("data",m),this.reset())}function _(e){this[l]._inflate=null,e[o]=1007,this[u](e)}e.exports=class{constructor(e,t,r){if(this._maxPayload=0|r,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!f){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;f=new i(e)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[u];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,r=e.find((e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits)));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(r.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?r.client_max_window_bits=t.clientMaxWindowBits:!0!==r.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete r.client_max_window_bits,r}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach((e=>{Object.keys(e).forEach((t=>{let r=e[t];if(r.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(r=r[0],"client_max_window_bits"===t){if(!0!==r){const e=+r;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${r}`)}else if("server_max_window_bits"===t){const e=+r;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==r)throw new TypeError(`Invalid value for parameter "${t}": ${r}`)}e[t]=r}))})),e}decompress(e,t,r){f.add((s=>{this._decompress(e,t,((e,t)=>{s(),r(e,t)}))}))}compress(e,t,r){f.add((s=>{this._compress(e,t,((e,t)=>{s(),r(e,t)}))}))}_decompress(e,t,r){const i=this._isServer?"client":"server";if(!this._inflate){const e=i+"_max_window_bits",t="number"!=typeof this.params[e]?s.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=s.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[l]=this,this._inflate[c]=0,this._inflate[p]=[],this._inflate.on("error",_),this._inflate.on("data",m)}this._inflate[u]=r,this._inflate.write(e),t&&this._inflate.write(h),this._inflate.flush((()=>{const e=this._inflate[d];if(e)return this._inflate.close(),this._inflate=null,void r(e);const s=n.concat(this._inflate[p],this._inflate[c]);t&&this.params[i+"_no_context_takeover"]?(this._inflate.close(),this._inflate=null):(this._inflate[c]=0,this._inflate[p]=[]),r(null,s)}))}_compress(e,t,r){const i=this._isServer?"server":"client";if(!this._deflate){const e=i+"_max_window_bits",t="number"!=typeof this.params[e]?s.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=s.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[c]=0,this._deflate[p]=[],this._deflate.on("error",a),this._deflate.on("data",g)}this._deflate[u]=r,this._deflate.write(e),this._deflate.flush(s.Z_SYNC_FLUSH,(()=>{if(!this._deflate)return;let e=n.concat(this._deflate[p],this._deflate[c]);t&&(e=e.slice(0,e.length-4)),this._deflate[u]=null,t&&this.params[i+"_no_context_takeover"]?(this._deflate.close(),this._deflate=null):(this._deflate[c]=0,this._deflate[p]=[]),r(null,e)}))}}},4586:(e,t,r)=>{"use strict";const{Writable:s}=r(2413),n=r(5895),{BINARY_TYPES:i,EMPTY_BUFFER:o,kStatusCode:a,kWebSocket:h}=r(1372),{concat:l,toArrayBuffer:c,unmask:u}=r(5210),{isValidStatusCode:p,isValidUTF8:d}=r(8817);function f(e,t,r,s){const n=new e(r?"Invalid WebSocket frame: "+t:t);return Error.captureStackTrace(n,f),n[a]=s,n}e.exports=class extends s{constructor(e,t,r,s){super(),this._binaryType=e||i[0],this[h]=void 0,this._extensions=t||{},this._isServer=!!r,this._maxPayload=0|s,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=0,this._loop=!1}_write(e,t,r){if(8===this._opcode&&0==this._state)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=t.slice(e),t.slice(0,e)}const t=Buffer.allocUnsafe(e);do{const r=this._buffers[0],s=t.length-e;e>=r.length?t.set(this._buffers.shift(),s):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),s),this._buffers[0]=r.slice(e)),e-=r.length}while(e>0);return t}startLoop(e){let t;this._loop=!0;do{switch(this._state){case 0:t=this.getInfo();break;case 1:t=this.getPayloadLength16();break;case 2:t=this.getPayloadLength64();break;case 3:this.getMask();break;case 4:t=this.getData(e);break;default:return void(this._loop=!1)}}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2)return void(this._loop=!1);const e=this.consume(2);if(0!=(48&e[0]))return this._loop=!1,f(RangeError,"RSV2 and RSV3 must be clear",!0,1002);const t=64==(64&e[0]);if(t&&!this._extensions[n.extensionName])return this._loop=!1,f(RangeError,"RSV1 must be clear",!0,1002);if(this._fin=128==(128&e[0]),this._opcode=15&e[0],this._payloadLength=127&e[1],0===this._opcode){if(t)return this._loop=!1,f(RangeError,"RSV1 must be clear",!0,1002);if(!this._fragmented)return this._loop=!1,f(RangeError,"invalid opcode 0",!0,1002);this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,f(RangeError,"invalid opcode "+this._opcode,!0,1002);this._compressed=t}else{if(!(this._opcode>7&&this._opcode<11))return this._loop=!1,f(RangeError,"invalid opcode "+this._opcode,!0,1002);if(!this._fin)return this._loop=!1,f(RangeError,"FIN must be set",!0,1002);if(t)return this._loop=!1,f(RangeError,"RSV1 must be clear",!0,1002);if(this._payloadLength>125)return this._loop=!1,f(RangeError,"invalid payload length "+this._payloadLength,!0,1002)}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=128==(128&e[1]),this._isServer){if(!this._masked)return this._loop=!1,f(RangeError,"MASK must be set",!0,1002)}else if(this._masked)return this._loop=!1,f(RangeError,"MASK must be clear",!0,1002);if(126===this._payloadLength)this._state=1;else{if(127!==this._payloadLength)return this.haveLength();this._state=2}}getPayloadLength16(){if(!(this._bufferedBytes<2))return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength();this._loop=!1}getPayloadLength64(){if(this._bufferedBytes<8)return void(this._loop=!1);const e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,f(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009)):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,f(RangeError,"Max payload size exceeded",!1,1009);this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=o;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&u(t,this._mask)}return this._opcode>7?this.controlMessage(t):this._compressed?(this._state=5,void this.decompress(t,e)):(t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage())}decompress(e,t){this._extensions[n.extensionName].decompress(e,this._fin,((e,r)=>{if(e)return t(e);if(r.length){if(this._messageLength+=r.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(f(RangeError,"Max payload size exceeded",!1,1009));this._fragments.push(r)}const s=this.dataMessage();if(s)return t(s);this.startLoop(t)}))}dataMessage(){if(this._fin){const e=this._messageLength,t=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let r;r="nodebuffer"===this._binaryType?l(t,e):"arraybuffer"===this._binaryType?c(l(t,e)):t,this.emit("message",r)}else{const r=l(t,e);if(!d(r))return this._loop=!1,f(Error,"invalid UTF-8 sequence",!0,1007);this.emit("message",r.toString())}}this._state=0}controlMessage(e){if(8===this._opcode)if(this._loop=!1,0===e.length)this.emit("conclude",1005,""),this.end();else{if(1===e.length)return f(RangeError,"invalid payload length 1",!0,1002);{const t=e.readUInt16BE(0);if(!p(t))return f(RangeError,"invalid status code "+t,!0,1002);const r=e.slice(2);if(!d(r))return f(Error,"invalid UTF-8 sequence",!0,1007);this.emit("conclude",t,r.toString()),this.end()}}else 9===this._opcode?this.emit("ping",e):this.emit("pong",e);this._state=0}}},2530:(e,t,r)=>{"use strict";const{randomFillSync:s}=r(6417),n=r(5895),{EMPTY_BUFFER:i}=r(1372),{isValidStatusCode:o}=r(8817),{mask:a,toBuffer:h}=r(5210),l=Buffer.alloc(4);class c{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){const r=t.mask&&t.readOnly;let n=t.mask?6:2,i=e.length;e.length>=65536?(n+=8,i=127):e.length>125&&(n+=2,i=126);const o=Buffer.allocUnsafe(r?e.length+n:n);return o[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(o[0]|=64),o[1]=i,126===i?o.writeUInt16BE(e.length,2):127===i&&(o.writeUInt32BE(0,2),o.writeUInt32BE(e.length,6)),t.mask?(s(l,0,4),o[1]|=128,o[n-4]=l[0],o[n-3]=l[1],o[n-2]=l[2],o[n-1]=l[3],r?(a(e,l,o,n,e.length),[o]):(a(e,l,e,0,e.length),[o,e])):[o,e]}close(e,t,r,s){let n;if(void 0===e)n=i;else{if("number"!=typeof e||!o(e))throw new TypeError("First argument must be a valid error code number");if(void 0===t||""===t)n=Buffer.allocUnsafe(2),n.writeUInt16BE(e,0);else{const r=Buffer.byteLength(t);if(r>123)throw new RangeError("The message must not be greater than 123 bytes");n=Buffer.allocUnsafe(2+r),n.writeUInt16BE(e,0),n.write(t,2)}}this._deflating?this.enqueue([this.doClose,n,r,s]):this.doClose(n,r,s)}doClose(e,t,r){this.sendFrame(c.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),r)}ping(e,t,r){const s=h(e);if(s.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPing,s,t,h.readOnly,r]):this.doPing(s,t,h.readOnly,r)}doPing(e,t,r,s){this.sendFrame(c.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:r}),s)}pong(e,t,r){const s=h(e);if(s.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPong,s,t,h.readOnly,r]):this.doPong(s,t,h.readOnly,r)}doPong(e,t,r,s){this.sendFrame(c.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:r}),s)}send(e,t,r){const s=h(e),i=this._extensions[n.extensionName];let o=t.binary?2:1,a=t.compress;if(this._firstFragment?(this._firstFragment=!1,a&&i&&(a=s.length>=i._threshold),this._compress=a):(a=!1,o=0),t.fin&&(this._firstFragment=!0),i){const e={fin:t.fin,rsv1:a,opcode:o,mask:t.mask,readOnly:h.readOnly};this._deflating?this.enqueue([this.dispatch,s,this._compress,e,r]):this.dispatch(s,this._compress,e,r)}else this.sendFrame(c.frame(s,{fin:t.fin,rsv1:!1,opcode:o,mask:t.mask,readOnly:h.readOnly}),r)}dispatch(e,t,r,s){if(!t)return void this.sendFrame(c.frame(e,r),s);const i=this._extensions[n.extensionName];this._bufferedBytes+=e.length,this._deflating=!0,i.compress(e,r.fin,((t,n)=>{if(this._socket.destroyed){const e=new Error("The socket was closed while data was being compressed");"function"==typeof s&&s(e);for(let t=0;t<this._queue.length;t++){const r=this._queue[t][4];"function"==typeof r&&r(e)}}else this._bufferedBytes-=e.length,this._deflating=!1,r.readOnly=!1,this.sendFrame(c.frame(n,r),s),this.dequeue()}))}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[1].length,Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}e.exports=c},8135:(e,t,r)=>{"use strict";const{Duplex:s}=r(2413);function n(e){e.emit("close")}function i(){!this.destroyed&&this._writableState.finished&&this.destroy()}function o(e){this.removeListener("error",o),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}e.exports=function(e,t){let r=!0;function a(){r&&e._socket.resume()}e.readyState===e.CONNECTING?e.once("open",(function(){e._receiver.removeAllListeners("drain"),e._receiver.on("drain",a)})):(e._receiver.removeAllListeners("drain"),e._receiver.on("drain",a));const h=new s({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",(function(t){h.push(t)||(r=!1,e._socket.pause())})),e.once("error",(function(e){h.destroyed||h.destroy(e)})),e.once("close",(function(){h.destroyed||h.push(null)})),h._destroy=function(t,r){if(e.readyState===e.CLOSED)return r(t),void process.nextTick(n,h);let s=!1;e.once("error",(function(e){s=!0,r(e)})),e.once("close",(function(){s||r(t),process.nextTick(n,h)})),e.terminate()},h._final=function(t){e.readyState!==e.CONNECTING?null!==e._socket&&(e._socket._writableState.finished?(t(),h._readableState.endEmitted&&h.destroy()):(e._socket.once("finish",(function(){t()})),e.close())):e.once("open",(function(){h._final(t)}))},h._read=function(){e.readyState!==e.OPEN||r||(r=!0,e._receiver._writableState.needDrain||e._socket.resume())},h._write=function(t,r,s){e.readyState!==e.CONNECTING?e.send(t,s):e.once("open",(function(){h._write(t,r,s)}))},h.on("end",i),h.on("error",o),h}},8817:(e,t,r)=>{"use strict";try{const e=r(6465);t.isValidUTF8="object"==typeof e?e.Validation.isValidUTF8:e}catch(e){t.isValidUTF8=()=>!0}t.isValidStatusCode=e=>e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},7082:(e,t,r)=>{"use strict";const s=r(8614),{createHash:n}=r(6417),{createServer:i,STATUS_CODES:o}=r(8605),a=r(5895),h=r(82),{format:l,parse:c}=r(921),{GUID:u,kWebSocket:p}=r(1372),d=/^[+/0-9A-Za-z]{22}==$/;function f(e){e.emit("close")}function g(){this.destroy()}function m(e,t,r,s){e.writable&&(r=r||o[t],s={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...s},e.write(`HTTP/1.1 ${t} ${o[t]}\r\n`+Object.keys(s).map((e=>`${e}: ${s[e]}`)).join("\r\n")+"\r\n\r\n"+r)),e.removeListener("error",g),e.destroy()}e.exports=class extends s{constructor(e,t){if(super(),null==(e={maxPayload:104857600,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,...e}).port&&!e.server&&!e.noServer)throw new TypeError('One of the "port", "server", or "noServer" options must be specified');null!=e.port?(this._server=i(((e,t)=>{const r=o[426];t.writeHead(426,{"Content-Length":r.length,"Content-Type":"text/plain"}),t.end(r)})),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server&&(this._removeListeners=function(e,t){for(const r of Object.keys(t))e.on(r,t[r]);return function(){for(const r of Object.keys(t))e.removeListener(r,t[r])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(e,t,r)=>{this.handleUpgrade(e,t,r,(t=>{this.emit("connection",t,e)}))}})),!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(e&&this.once("close",e),this.clients)for(const e of this.clients)e.terminate();const t=this._server;t&&(this._removeListeners(),this._removeListeners=this._server=null,null!=this.options.port)?t.close((()=>this.emit("close"))):process.nextTick(f,this)}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,s){t.on("error",g);const n=void 0!==e.headers["sec-websocket-key"]&&e.headers["sec-websocket-key"].trim(),i=+e.headers["sec-websocket-version"],o={};if("GET"!==e.method||"websocket"!==e.headers.upgrade.toLowerCase()||!n||!d.test(n)||8!==i&&13!==i||!this.shouldHandle(e))return m(t,400);if(this.options.perMessageDeflate){const r=new a(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const t=c(e.headers["sec-websocket-extensions"]);t[a.extensionName]&&(r.accept(t[a.extensionName]),o[a.extensionName]=r)}catch(e){return m(t,400)}}if(this.options.verifyClient){const a={origin:e.headers[8===i?"sec-websocket-origin":"origin"],secure:!(!e.connection.authorized&&!e.connection.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(a,((i,a,h,l)=>{if(!i)return m(t,a||401,h,l);this.completeUpgrade(n,o,e,t,r,s)}));if(!this.options.verifyClient(a))return m(t,401)}this.completeUpgrade(n,o,e,t,r,s)}completeUpgrade(e,t,r,s,i,o){if(!s.readable||!s.writable)return s.destroy();if(s[p])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");const c=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade","Sec-WebSocket-Accept: "+n("sha1").update(e+u).digest("base64")],d=new h(null);let f=r.headers["sec-websocket-protocol"];if(f&&(f=f.trim().split(/ *, */),f=this.options.handleProtocols?this.options.handleProtocols(f,r):f[0],f&&(c.push("Sec-WebSocket-Protocol: "+f),d.protocol=f)),t[a.extensionName]){const e=t[a.extensionName].params,r=l({[a.extensionName]:[e]});c.push("Sec-WebSocket-Extensions: "+r),d._extensions=t}this.emit("headers",c,r),s.write(c.concat("\r\n").join("\r\n")),s.removeListener("error",g),d.setSocket(s,i,this.options.maxPayload),this.clients&&(this.clients.add(d),d.on("close",(()=>this.clients.delete(d)))),o(d)}}},82:(e,t,r)=>{"use strict";const s=r(8614),n=r(7211),i=r(8605),o=r(1631),a=r(4016),{randomBytes:h,createHash:l}=r(6417),{URL:c}=r(8835),u=r(5895),p=r(4586),d=r(2530),{BINARY_TYPES:f,EMPTY_BUFFER:g,GUID:m,kStatusCode:_,kWebSocket:v,NOOP:y}=r(1372),{addEventListener:b,removeEventListener:w}=r(4901),{format:O,parse:S}=r(921),{toBuffer:E}=r(5210),x=["CONNECTING","OPEN","CLOSING","CLOSED"],N=[8,13];class A extends s{constructor(e,t,r){super(),this.readyState=A.CONNECTING,this.protocol="",this._binaryType=f[0],this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._closeCode=1006,this._extensions={},this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,Array.isArray(t)?t=t.join(", "):"object"==typeof t&&null!==t&&(r=t,t=void 0),T(this,e,t,r)):this._isServer=!0}get CONNECTING(){return A.CONNECTING}get CLOSING(){return A.CLOSING}get CLOSED(){return A.CLOSED}get OPEN(){return A.OPEN}get binaryType(){return this._binaryType}set binaryType(e){f.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}setSocket(e,t,r){const s=new p(this._binaryType,this._extensions,this._isServer,r);this._sender=new d(e,this._extensions),this._receiver=s,this._socket=e,s[v]=this,e[v]=this,s.on("conclude",D),s.on("drain",j),s.on("error",L),s.on("message",F),s.on("ping",U),s.on("pong",B),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",M),e.on("data",q),e.on("end",H),e.on("error",V),this.readyState=A.OPEN,this.emit("open")}emitClose(){if(!this._socket)return this.readyState=A.CLOSED,void this.emit("close",this._closeCode,this._closeMessage);this._extensions[u.extensionName]&&this._extensions[u.extensionName].cleanup(),this._receiver.removeAllListeners(),this.readyState=A.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==A.CLOSED){if(this.readyState===A.CONNECTING){const e="WebSocket was closed before the connection was established";return R(this,this._req,e)}this.readyState!==A.CLOSING?(this.readyState=A.CLOSING,this._sender.close(e,t,!this._isServer,(e=>{e||(this._closeFrameSent=!0,this._closeFrameReceived&&this._socket.end())})),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),3e4)):this._closeFrameSent&&this._closeFrameReceived&&this._socket.end()}}ping(e,t,r){if(this.readyState===A.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===A.OPEN?(void 0===t&&(t=!this._isServer),this._sender.ping(e||g,t,r)):k(this,e,r)}pong(e,t,r){if(this.readyState===A.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===A.OPEN?(void 0===t&&(t=!this._isServer),this._sender.pong(e||g,t,r)):k(this,e,r)}send(e,t,r){if(this.readyState===A.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(r=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==A.OPEN)return void k(this,e,r);const s={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[u.extensionName]||(s.compress=!1),this._sender.send(e||g,s,r)}terminate(){if(this.readyState!==A.CLOSED){if(this.readyState===A.CONNECTING){const e="WebSocket was closed before the connection was established";return R(this,this._req,e)}this._socket&&(this.readyState=A.CLOSING,this._socket.destroy())}}}function T(e,t,r,s){const o={protocolVersion:N[1],maxPayload:104857600,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...s,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,host:void 0,path:void 0,port:void 0};if(!N.includes(o.protocolVersion))throw new RangeError(`Unsupported protocol version: ${o.protocolVersion} (supported versions: ${N.join(", ")})`);let a;t instanceof c?(a=t,e.url=t.href):(a=new c(t),e.url=t);const p="ws+unix:"===a.protocol;if(!(a.host||p&&a.pathname))throw new Error("Invalid URL: "+e.url);const d="wss:"===a.protocol||"https:"===a.protocol,f=d?443:80,g=h(16).toString("base64"),_=d?n.get:i.get;let v;if(o.createConnection=d?P:C,o.defaultPort=o.defaultPort||f,o.port=a.port||f,o.host=a.hostname.startsWith("[")?a.hostname.slice(1,-1):a.hostname,o.headers={"Sec-WebSocket-Version":o.protocolVersion,"Sec-WebSocket-Key":g,Connection:"Upgrade",Upgrade:"websocket",...o.headers},o.path=a.pathname+a.search,o.timeout=o.handshakeTimeout,o.perMessageDeflate&&(v=new u(!0!==o.perMessageDeflate?o.perMessageDeflate:{},!1,o.maxPayload),o.headers["Sec-WebSocket-Extensions"]=O({[u.extensionName]:v.offer()})),r&&(o.headers["Sec-WebSocket-Protocol"]=r),o.origin&&(o.protocolVersion<13?o.headers["Sec-WebSocket-Origin"]=o.origin:o.headers.Origin=o.origin),(a.username||a.password)&&(o.auth=`${a.username}:${a.password}`),p){const e=o.path.split(":");o.socketPath=e[0],o.path=e[1]}let y=e._req=_(o);o.timeout&&y.on("timeout",(()=>{R(e,y,"Opening handshake has timed out")})),y.on("error",(t=>{e._req.aborted||(y=e._req=null,e.readyState=A.CLOSING,e.emit("error",t),e.emitClose())})),y.on("response",(n=>{const i=n.headers.location,a=n.statusCode;if(i&&o.followRedirects&&a>=300&&a<400){if(++e._redirects>o.maxRedirects)return void R(e,y,"Maximum redirects exceeded");y.abort();const n=new c(i,t);T(e,n,r,s)}else e.emit("unexpected-response",y,n)||R(e,y,"Unexpected server response: "+n.statusCode)})),y.on("upgrade",((t,s,n)=>{if(e.emit("upgrade",t),e.readyState!==A.CONNECTING)return;y=e._req=null;const i=l("sha1").update(g+m).digest("base64");if(t.headers["sec-websocket-accept"]!==i)return void R(e,s,"Invalid Sec-WebSocket-Accept header");const a=t.headers["sec-websocket-protocol"],h=(r||"").split(/, */);let c;if(!r&&a?c="Server sent a subprotocol but none was requested":r&&!a?c="Server sent no subprotocol":a&&!h.includes(a)&&(c="Server sent an invalid subprotocol"),c)R(e,s,c);else{if(a&&(e.protocol=a),v)try{const r=S(t.headers["sec-websocket-extensions"]);r[u.extensionName]&&(v.accept(r[u.extensionName]),e._extensions[u.extensionName]=v)}catch(t){return void R(e,s,"Invalid Sec-WebSocket-Extensions header")}e.setSocket(s,n,o.maxPayload)}}))}function C(e){return e.path=e.socketPath,o.connect(e)}function P(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=e.host),a.connect(e)}function R(e,t,r){e.readyState=A.CLOSING;const s=new Error(r);Error.captureStackTrace(s,R),t.setHeader?(t.abort(),t.once("abort",e.emitClose.bind(e)),e.emit("error",s)):(t.destroy(s),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function k(e,t,r){if(t){const r=E(t).length;e._socket?e._sender._bufferedBytes+=r:e._bufferedAmount+=r}r&&r(new Error(`WebSocket is not open: readyState ${e.readyState} (${x[e.readyState]})`))}function D(e,t){const r=this[v];r._socket.removeListener("data",q),r._socket.resume(),r._closeFrameReceived=!0,r._closeMessage=t,r._closeCode=e,1005===e?r.close():r.close(e,t)}function j(){this[v]._socket.resume()}function L(e){const t=this[v];t._socket.removeListener("data",q),t.readyState=A.CLOSING,t._closeCode=e[_],t.emit("error",e),t._socket.destroy()}function I(){this[v].emitClose()}function F(e){this[v].emit("message",e)}function U(e){const t=this[v];t.pong(e,!t._isServer,y),t.emit("ping",e)}function B(e){this[v].emit("pong",e)}function M(){const e=this[v];this.removeListener("close",M),this.removeListener("end",H),e.readyState=A.CLOSING,e._socket.read(),e._receiver.end(),this.removeListener("data",q),this[v]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",I),e._receiver.on("finish",I))}function q(e){this[v]._receiver.write(e)||this.pause()}function H(){const e=this[v];e.readyState=A.CLOSING,e._receiver.end(),this.end()}function V(){const e=this[v];this.removeListener("error",V),this.on("error",y),e&&(e.readyState=A.CLOSING,this.destroy())}x.forEach(((e,t)=>{A[e]=t})),["open","error","close","message"].forEach((e=>{Object.defineProperty(A.prototype,"on"+e,{get(){const t=this.listeners(e);for(let e=0;e<t.length;e++)if(t[e]._listener)return t[e]._listener},set(t){const r=this.listeners(e);for(let t=0;t<r.length;t++)r[t]._listener&&this.removeListener(e,r[t]);this.addEventListener(e,t)}})})),A.prototype.addEventListener=b,A.prototype.removeEventListener=w,e.exports=A},3668:(e,t,r)=>{function s(e){this.options=e||{locator:{}}}function n(){this.cdata=!1}function i(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function o(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function a(e,t,r){return"string"==typeof e?e.substr(t,r):e.length>=t+r||t?new java.lang.String(e,t,r)+"":e}function h(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}s.prototype.parseFromString=function(e,t){var r=this.options,s=new c,i=r.domBuilder||new n,a=r.errorHandler,h=r.locator,u=r.xmlns||{},p=/\/x?html?$/.test(t),d=p?l.entityMap:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return h&&i.setDocumentLocator(h),s.errorHandler=function(e,t,r){if(!e){if(t instanceof n)return t;e=t}var s={},i=e instanceof Function;function a(t){var n=e[t];!n&&i&&(n=2==e.length?function(r){e(t,r)}:e),s[t]=n&&function(e){n("[xmldom "+t+"]\t"+e+o(r))}||function(){}}return r=r||{},a("warning"),a("error"),a("fatalError"),s}(a,i,h),s.domBuilder=r.domBuilder||i,p&&(u[""]="http://www.w3.org/1999/xhtml"),u.xml=u.xml||"http://www.w3.org/XML/1998/namespace",e?s.parse(e,u,d):s.errorHandler.error("invalid doc source"),i.doc},n.prototype={startDocument:function(){this.doc=(new u).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,r,s){var n=this.doc,o=n.createElementNS(e,r||t),a=s.length;h(this,o),this.currentElement=o,this.locator&&i(this.locator,o);for(var l=0;l<a;l++){e=s.getURI(l);var c=s.getValue(l),u=(r=s.getQName(l),n.createAttributeNS(e,r));this.locator&&i(s.getLocator(l),u),u.value=u.nodeValue=c,o.setAttributeNode(u)}},endElement:function(e,t,r){var s=this.currentElement;s.tagName,this.currentElement=s.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var r=this.doc.createProcessingInstruction(e,t);this.locator&&i(this.locator,r),h(this,r)},ignorableWhitespace:function(e,t,r){},characters:function(e,t,r){if(e=a.apply(this,arguments)){if(this.cdata)var s=this.doc.createCDATASection(e);else s=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(s):/^\s*$/.test(e)&&this.doc.appendChild(s),this.locator&&i(this.locator,s)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,r){e=a.apply(this,arguments);var s=this.doc.createComment(e);this.locator&&i(this.locator,s),h(this,s)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,r){var s=this.doc.implementation;if(s&&s.createDocumentType){var n=s.createDocumentType(e,t,r);this.locator&&i(this.locator,n),h(this,n)}},warning:function(e){console.warn("[xmldom warning]\t"+e,o(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,o(this.locator))},fatalError:function(e){throw console.error("[xmldom fatalError]\t"+e,o(this.locator)),e}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,(function(e){n.prototype[e]=function(){return null}}));var l=r(624),c=r(1186).G,u=t.DOMImplementation=r(1676).DOMImplementation;t.XMLSerializer=r(1676).XMLSerializer,t.DOMParser=s},1676:(e,t)=>{function r(e,t){for(var r in e)t[r]=e[r]}function s(e,t){var s=e.prototype;if(!(s instanceof t)){function n(){}n.prototype=t.prototype,r(s,n=new n),e.prototype=s=n}s.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),s.constructor=e)}var n={},i=n.ELEMENT_NODE=1,o=n.ATTRIBUTE_NODE=2,a=n.TEXT_NODE=3,h=n.CDATA_SECTION_NODE=4,l=n.ENTITY_REFERENCE_NODE=5,c=n.ENTITY_NODE=6,u=n.PROCESSING_INSTRUCTION_NODE=7,p=n.COMMENT_NODE=8,d=n.DOCUMENT_NODE=9,f=n.DOCUMENT_TYPE_NODE=10,g=n.DOCUMENT_FRAGMENT_NODE=11,m=n.NOTATION_NODE=12,_={},v={},y=(_.INDEX_SIZE_ERR=(v[1]="Index size error",1),_.DOMSTRING_SIZE_ERR=(v[2]="DOMString size error",2),_.HIERARCHY_REQUEST_ERR=(v[3]="Hierarchy request error",3)),b=(_.WRONG_DOCUMENT_ERR=(v[4]="Wrong document",4),_.INVALID_CHARACTER_ERR=(v[5]="Invalid character",5),_.NO_DATA_ALLOWED_ERR=(v[6]="No data allowed",6),_.NO_MODIFICATION_ALLOWED_ERR=(v[7]="No modification allowed",7),_.NOT_FOUND_ERR=(v[8]="Not found",8)),w=(_.NOT_SUPPORTED_ERR=(v[9]="Not supported",9),_.INUSE_ATTRIBUTE_ERR=(v[10]="Attribute in use",10));function O(e,t){if(t instanceof Error)var r=t;else r=this,Error.call(this,v[e]),this.message=v[e],Error.captureStackTrace&&Error.captureStackTrace(this,O);return r.code=e,t&&(this.message=this.message+": "+t),r}function S(){}function E(e,t){this._node=e,this._refresh=t,x(this)}function x(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var s=e._refresh(e._node);se(e,"length",s.length),r(s,e),e._inc=t}}function N(){}function A(e,t){for(var r=e.length;r--;)if(e[r]===t)return r}function T(e,t,r,s){if(s?t[A(t,s)]=r:t[t.length++]=r,e){r.ownerElement=e;var n=e.ownerDocument;n&&(s&&L(n,e,s),function(e,t,r){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&(t._nsMap[r.prefix?r.localName:""]=r.value)}(n,e,r))}}function C(e,t,r){var s=A(t,r);if(!(s>=0))throw O(b,new Error(e.tagName+"@"+r));for(var n=t.length-1;s<n;)t[s]=t[++s];if(t.length=n,e){var i=e.ownerDocument;i&&(L(i,e,r),r.ownerElement=null)}}function P(e){if(this._features={},e)for(var t in e)this._features=e[t]}function R(){}function k(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function D(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(D(e,t))return!0}while(e=e.nextSibling)}function j(){}function L(e,t,r,s){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&delete t._nsMap[r.prefix?r.localName:""]}function I(e,t,r){if(e&&e._inc){e._inc++;var s=t.childNodes;if(r)s[s.length++]=r;else{for(var n=t.firstChild,i=0;n;)s[i++]=n,n=n.nextSibling;s.length=i}}}function F(e,t){var r=t.previousSibling,s=t.nextSibling;return r?r.nextSibling=s:e.firstChild=s,s?s.previousSibling=r:e.lastChild=r,I(e.ownerDocument,e),t}function U(e,t,r){var s=t.parentNode;if(s&&s.removeChild(t),t.nodeType===g){var n=t.firstChild;if(null==n)return t;var i=t.lastChild}else n=i=t;var o=r?r.previousSibling:e.lastChild;n.previousSibling=o,i.nextSibling=r,o?o.nextSibling=n:e.firstChild=n,null==r?e.lastChild=i:r.previousSibling=i;do{n.parentNode=e}while(n!==i&&(n=n.nextSibling));return I(e.ownerDocument||e,e),t.nodeType==g&&(t.firstChild=t.lastChild=null),t}function B(){this._nsMap={}}function M(){}function q(){}function H(){}function V(){}function W(){}function G(){}function z(){}function X(){}function K(){}function Y(){}function J(){}function $(){}function Q(e,t){var r=[],s=9==this.nodeType&&this.documentElement||this,n=s.prefix,i=s.namespaceURI;if(i&&null==n&&null==(n=s.lookupPrefix(i)))var o=[{namespace:i,prefix:null}];return ee(this,r,e,t,o),r.join("")}function Z(e,t,r){var s=e.prefix||"",n=e.namespaceURI;if(!s&&!n)return!1;if("xml"===s&&"http://www.w3.org/XML/1998/namespace"===n||"http://www.w3.org/2000/xmlns/"==n)return!1;for(var i=r.length;i--;){var o=r[i];if(o.prefix==s)return o.namespace!=n}return!0}function ee(e,t,r,s,n){if(s){if(!(e=s(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case i:n||(n=[]),n.length;var c=e.attributes,m=c.length,_=e.firstChild,v=e.tagName;r="http://www.w3.org/1999/xhtml"===e.namespaceURI||r,t.push("<",v);for(var y=0;y<m;y++)"xmlns"==(b=c.item(y)).prefix?n.push({prefix:b.localName,namespace:b.value}):"xmlns"==b.nodeName&&n.push({prefix:"",namespace:b.value});for(y=0;y<m;y++){var b;if(Z(b=c.item(y),0,n)){var w=b.prefix||"",O=b.namespaceURI,S=w?" xmlns:"+w:" xmlns";t.push(S,'="',O,'"'),n.push({prefix:w,namespace:O})}ee(b,t,r,s,n)}if(Z(e,0,n)&&(w=e.prefix||"",O=e.namespaceURI,S=w?" xmlns:"+w:" xmlns",t.push(S,'="',O,'"'),n.push({prefix:w,namespace:O})),_||r&&!/^(?:meta|link|img|br|hr|input)$/i.test(v)){if(t.push(">"),r&&/^script$/i.test(v))for(;_;)_.data?t.push(_.data):ee(_,t,r,s,n),_=_.nextSibling;else for(;_;)ee(_,t,r,s,n),_=_.nextSibling;t.push("</",v,">")}else t.push("/>");return;case d:case g:for(_=e.firstChild;_;)ee(_,t,r,s,n),_=_.nextSibling;return;case o:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,k),'"');case a:return t.push(e.data.replace(/[<&]/g,k));case h:return t.push("<![CDATA[",e.data,"]]>");case p:return t.push("\x3c!--",e.data,"--\x3e");case f:var E=e.publicId,x=e.systemId;if(t.push("<!DOCTYPE ",e.name),E)t.push(' PUBLIC "',E),x&&"."!=x&&t.push('" "',x),t.push('">');else if(x&&"."!=x)t.push(' SYSTEM "',x,'">');else{var N=e.internalSubset;N&&t.push(" [",N,"]"),t.push(">")}return;case u:return t.push("<?",e.target," ",e.data,"?>");case l:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function te(e,t,r){var s;switch(t.nodeType){case i:(s=t.cloneNode(!1)).ownerDocument=e;case g:break;case o:r=!0}if(s||(s=t.cloneNode(!1)),s.ownerDocument=e,s.parentNode=null,r)for(var n=t.firstChild;n;)s.appendChild(te(e,n,r)),n=n.nextSibling;return s}function re(e,t,r){var s=new t.constructor;for(var n in t){var a=t[n];"object"!=typeof a&&a!=s[n]&&(s[n]=a)}switch(t.childNodes&&(s.childNodes=new S),s.ownerDocument=e,s.nodeType){case i:var h=t.attributes,l=s.attributes=new N,c=h.length;l._ownerElement=s;for(var u=0;u<c;u++)s.setAttributeNode(re(e,h.item(u),!0));break;case o:r=!0}if(r)for(var p=t.firstChild;p;)s.appendChild(re(e,p,r)),p=p.nextSibling;return s}function se(e,t,r){e[t]=r}_.INVALID_STATE_ERR=(v[11]="Invalid state",11),_.SYNTAX_ERR=(v[12]="Syntax error",12),_.INVALID_MODIFICATION_ERR=(v[13]="Invalid modification",13),_.NAMESPACE_ERR=(v[14]="Invalid namespace",14),_.INVALID_ACCESS_ERR=(v[15]="Invalid access",15),O.prototype=Error.prototype,r(_,O),S.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var r=[],s=0;s<this.length;s++)ee(this[s],r,e,t);return r.join("")}},E.prototype.item=function(e){return x(this),this[e]},s(E,S),N.prototype={length:0,item:S.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var r=this[t];if(r.nodeName==e)return r}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new O(w);var r=this.getNamedItem(e.nodeName);return T(this._ownerElement,this,e,r),r},setNamedItemNS:function(e){var t,r=e.ownerElement;if(r&&r!=this._ownerElement)throw new O(w);return t=this.getNamedItemNS(e.namespaceURI,e.localName),T(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return C(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var r=this.getNamedItemNS(e,t);return C(this._ownerElement,this,r),r},getNamedItemNS:function(e,t){for(var r=this.length;r--;){var s=this[r];if(s.localName==t&&s.namespaceURI==e)return s}return null}},P.prototype={hasFeature:function(e,t){var r=this._features[e.toLowerCase()];return!(!r||t&&!(t in r))},createDocument:function(e,t,r){var s=new j;if(s.implementation=this,s.childNodes=new S,s.doctype=r,r&&s.appendChild(r),t){var n=s.createElementNS(e,t);s.appendChild(n)}return s},createDocumentType:function(e,t,r){var s=new G;return s.name=e,s.nodeName=e,s.publicId=t,s.systemId=r,s}},R.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return U(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return F(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return re(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==a&&e.nodeType==a?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var r=t._nsMap;if(r)for(var s in r)if(r[s]==e)return s;t=t.nodeType==o?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var r=t._nsMap;if(r&&e in r)return r[e];t=t.nodeType==o?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},r(n,R),r(n,R.prototype),j.prototype={nodeName:"#document",nodeType:d,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==g){for(var r=e.firstChild;r;){var s=r.nextSibling;this.insertBefore(r,t),r=s}return e}return null==this.documentElement&&e.nodeType==i&&(this.documentElement=e),U(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),F(this,e)},importNode:function(e,t){return te(this,e,t)},getElementById:function(e){var t=null;return D(this.documentElement,(function(r){if(r.nodeType==i&&r.getAttribute("id")==e)return t=r,!0})),t},getElementsByClassName:function(e){const t=new RegExp(`(^|\\s)${e}(\\s|$)`);return new E(this,(e=>{var r=[];return D(e.documentElement,(s=>{s!==e&&s.nodeType==i&&t.test(s.getAttribute("class"))&&r.push(s)})),r}))},createElement:function(e){var t=new B;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new S,(t.attributes=new N)._ownerElement=t,t},createDocumentFragment:function(){var e=new Y;return e.ownerDocument=this,e.childNodes=new S,e},createTextNode:function(e){var t=new H;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new V;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new W;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var r=new J;return r.ownerDocument=this,r.tagName=r.target=e,r.nodeValue=r.data=t,r},createAttribute:function(e){var t=new M;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new K;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var r=new B,s=t.split(":"),n=r.attributes=new N;return r.childNodes=new S,r.ownerDocument=this,r.nodeName=t,r.tagName=t,r.namespaceURI=e,2==s.length?(r.prefix=s[0],r.localName=s[1]):r.localName=t,n._ownerElement=r,r},createAttributeNS:function(e,t){var r=new M,s=t.split(":");return r.ownerDocument=this,r.nodeName=t,r.name=t,r.namespaceURI=e,r.specified=!0,2==s.length?(r.prefix=s[0],r.localName=s[1]):r.localName=t,r}},s(j,R),B.prototype={nodeType:i,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var r=this.ownerDocument.createAttribute(e);r.value=r.nodeValue=""+t,this.setAttributeNode(r)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===g?this.insertBefore(e,null):function(e,t){var r=t.parentNode;if(r){var s=e.lastChild;r.removeChild(t),s=e.lastChild}return s=e.lastChild,t.parentNode=e,t.previousSibling=s,t.nextSibling=null,s?s.nextSibling=t:e.firstChild=t,e.lastChild=t,I(e.ownerDocument,e,t),t}(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var r=this.getAttributeNodeNS(e,t);r&&this.removeAttributeNode(r)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var r=this.getAttributeNodeNS(e,t);return r&&r.value||""},setAttributeNS:function(e,t,r){var s=this.ownerDocument.createAttributeNS(e,t);s.value=s.nodeValue=""+r,this.setAttributeNode(s)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new E(this,(function(t){var r=[];return D(t,(function(s){s===t||s.nodeType!=i||"*"!==e&&s.tagName!=e||r.push(s)})),r}))},getElementsByTagNameNS:function(e,t){return new E(this,(function(r){var s=[];return D(r,(function(n){n===r||n.nodeType!==i||"*"!==e&&n.namespaceURI!==e||"*"!==t&&n.localName!=t||s.push(n)})),s}))}},j.prototype.getElementsByTagName=B.prototype.getElementsByTagName,j.prototype.getElementsByTagNameNS=B.prototype.getElementsByTagNameNS,s(B,R),M.prototype.nodeType=o,s(M,R),q.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(v[y])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,r){r=this.data.substring(0,e)+r+this.data.substring(e+t),this.nodeValue=this.data=r,this.length=r.length}},s(q,R),H.prototype={nodeName:"#text",nodeType:a,splitText:function(e){var t=this.data,r=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var s=this.ownerDocument.createTextNode(r);return this.parentNode&&this.parentNode.insertBefore(s,this.nextSibling),s}},s(H,q),V.prototype={nodeName:"#comment",nodeType:p},s(V,q),W.prototype={nodeName:"#cdata-section",nodeType:h},s(W,q),G.prototype.nodeType=f,s(G,R),z.prototype.nodeType=m,s(z,R),X.prototype.nodeType=c,s(X,R),K.prototype.nodeType=l,s(K,R),Y.prototype.nodeName="#document-fragment",Y.prototype.nodeType=g,s(Y,R),J.prototype.nodeType=u,s(J,R),$.prototype.serializeToString=function(e,t,r){return Q.call(e,t,r)},R.prototype.toString=Q;try{if(Object.defineProperty){function ne(e){switch(e.nodeType){case i:case g:var t=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&t.push(ne(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}}Object.defineProperty(E.prototype,"length",{get:function(){return x(this),this.$$length}}),Object.defineProperty(R.prototype,"textContent",{get:function(){return ne(this)},set:function(e){switch(this.nodeType){case i:case g:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),se=function(e,t,r){e["$$"+t]=r}}}catch(e){}t.DOMImplementation=P,t.XMLSerializer=$},624:(e,t)=>{t.entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",auml:"ä",Aring:"Å",aring:"å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",ouml:"ö",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",times:"×",divide:"÷",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",euro:"€",trade:"™",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦"}},1186:(e,t)=>{var r=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,s=new RegExp("[\\-\\.0-9"+r.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),n=new RegExp("^"+r.source+s.source+"*(?::"+r.source+s.source+"*)?$");function i(){}function o(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function a(e,t,r,s,n,i){for(var o,a=++t,h=0;;){var l=e.charAt(a);switch(l){case"=":if(1===h)o=e.slice(t,a),h=3;else{if(2!==h)throw new Error("attribute equal must after attrName");h=3}break;case"'":case'"':if(3===h||1===h){if(1===h&&(i.warning('attribute value must after "="'),o=e.slice(t,a)),t=a+1,!((a=e.indexOf(l,t))>0))throw new Error("attribute value no end '"+l+"' match");c=e.slice(t,a).replace(/&#?\w+;/g,n),r.add(o,c,t-1),h=5}else{if(4!=h)throw new Error('attribute value must after "="');c=e.slice(t,a).replace(/&#?\w+;/g,n),r.add(o,c,t),i.warning('attribute "'+o+'" missed start quot('+l+")!!"),t=a+1,h=5}break;case"/":switch(h){case 0:r.setTagName(e.slice(t,a));case 5:case 6:case 7:h=7,r.closed=!0;case 4:case 1:case 2:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return i.error("unexpected end of input"),0==h&&r.setTagName(e.slice(t,a)),a;case">":switch(h){case 0:r.setTagName(e.slice(t,a));case 5:case 6:case 7:break;case 4:case 1:"/"===(c=e.slice(t,a)).slice(-1)&&(r.closed=!0,c=c.slice(0,-1));case 2:2===h&&(c=o),4==h?(i.warning('attribute "'+c+'" missed quot(")!!'),r.add(o,c.replace(/&#?\w+;/g,n),t)):("http://www.w3.org/1999/xhtml"===s[""]&&c.match(/^(?:disabled|checked|selected)$/i)||i.warning('attribute "'+c+'" missed value!! "'+c+'" instead!!'),r.add(c,c,t));break;case 3:throw new Error("attribute value missed!!")}return a;case"":l=" ";default:if(l<=" ")switch(h){case 0:r.setTagName(e.slice(t,a)),h=6;break;case 1:o=e.slice(t,a),h=2;break;case 4:var c=e.slice(t,a).replace(/&#?\w+;/g,n);i.warning('attribute "'+c+'" missed quot(")!!'),r.add(o,c,t);case 5:h=6}else switch(h){case 2:r.tagName,"http://www.w3.org/1999/xhtml"===s[""]&&o.match(/^(?:disabled|checked|selected)$/i)||i.warning('attribute "'+o+'" missed value!! "'+o+'" instead2!!'),r.add(o,o,t),t=a,h=1;break;case 5:i.warning('attribute space is required"'+o+'"!!');case 6:h=1,t=a;break;case 3:h=4,t=a;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}a++}}function h(e,t,r){for(var s=e.tagName,n=null,i=e.length;i--;){var o=e[i],a=o.qName,h=o.value;if((d=a.indexOf(":"))>0)var l=o.prefix=a.slice(0,d),c=a.slice(d+1),p="xmlns"===l&&c;else c=a,l=null,p="xmlns"===a&&"";o.localName=c,!1!==p&&(null==n&&(n={},u(r,r={})),r[p]=n[p]=h,o.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(p,h))}for(i=e.length;i--;)(l=(o=e[i]).prefix)&&("xml"===l&&(o.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==l&&(o.uri=r[l||""]));var d;(d=s.indexOf(":"))>0?(l=e.prefix=s.slice(0,d),c=e.localName=s.slice(d+1)):(l=null,c=e.localName=s);var f=e.uri=r[l||""];if(t.startElement(f,c,s,e),!e.closed)return e.currentNSMap=r,e.localNSMap=n,!0;if(t.endElement(f,c,s),n)for(l in n)t.endPrefixMapping(l)}function l(e,t,r,s,n){if(/^(?:script|textarea)$/i.test(r)){var i=e.indexOf("</"+r+">",t),o=e.substring(t+1,i);if(/[&<]/.test(o))return/^script$/i.test(r)?(n.characters(o,0,o.length),i):(o=o.replace(/&#?\w+;/g,s),n.characters(o,0,o.length),i)}return t+1}function c(e,t,r,s){var n=s[r];return null==n&&((n=e.lastIndexOf("</"+r+">"))<t&&(n=e.lastIndexOf("</"+r)),s[r]=n),n<t}function u(e,t){for(var r in e)t[r]=e[r]}function p(e,t,r,s){switch(e.charAt(t+2)){case"-":return"-"===e.charAt(t+3)?(n=e.indexOf("--\x3e",t+4))>t?(r.comment(e,t+4,n-t-4),n+3):(s.error("Unclosed comment"),-1):-1;default:if("CDATA["==e.substr(t+3,6)){var n=e.indexOf("]]>",t+9);return r.startCDATA(),r.characters(e,t+9,n-t-9),r.endCDATA(),n+3}var i=function(e,t){var r,s=[],n=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(n.lastIndex=t,n.exec(e);r=n.exec(e);)if(s.push(r),r[1])return s}(e,t),o=i.length;if(o>1&&/!doctype/i.test(i[0][0])){var a=i[1][0],h=o>3&&/^public$/i.test(i[2][0])&&i[3][0],l=o>4&&i[4][0],c=i[o-1];return r.startDTD(a,h&&h.replace(/^(['"])(.*?)\1$/,"$2"),l&&l.replace(/^(['"])(.*?)\1$/,"$2")),r.endDTD(),c.index+c[0].length}}return-1}function d(e,t,r){var s=e.indexOf("?>",t);if(s){var n=e.substring(t,s).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return n?(n[0].length,r.processingInstruction(n[1],n[2]),s+2):-1}return-1}function f(e){}i.prototype={parse:function(e,t,r){var s=this.domBuilder;s.startDocument(),u(t,t={}),function(e,t,r,s,n){function i(e){var t=e.slice(1,-1);return t in r?r[t]:"#"===t.charAt(0)?function(e){if(e>65535){var t=55296+((e-=65536)>>10),r=56320+(1023&e);return String.fromCharCode(t,r)}return String.fromCharCode(e)}(parseInt(t.substr(1).replace("x","0x"))):(n.error("entity not found:"+e),e)}function u(t){if(t>O){var r=e.substring(O,t).replace(/&#?\w+;/g,i);y&&g(O),s.characters(r,0,t-O),O=t}}function g(t,r){for(;t>=_&&(r=v.exec(e));)m=r.index,_=m+r[0].length,y.lineNumber++;y.columnNumber=t-m+1}for(var m=0,_=0,v=/.*(?:\r\n?|\n)|.*$/g,y=s.locator,b=[{currentNSMap:t}],w={},O=0;;){try{var S=e.indexOf("<",O);if(S<0){if(!e.substr(O).match(/^\s*$/)){var E=s.doc,x=E.createTextNode(e.substr(O));E.appendChild(x),s.currentElement=x}return}switch(S>O&&u(S),e.charAt(S+1)){case"/":var N=e.indexOf(">",S+3),A=e.substring(S+2,N),T=b.pop();N<0?(A=e.substring(S+2).replace(/[\s<].*/,""),n.error("end tag name: "+A+" is not complete:"+T.tagName),N=S+1+A.length):A.match(/\s</)&&(A=A.replace(/[\s<].*/,""),n.error("end tag name: "+A+" maybe not complete"),N=S+1+A.length);var C=T.localNSMap,P=T.tagName==A;if(P||T.tagName&&T.tagName.toLowerCase()==A.toLowerCase()){if(s.endElement(T.uri,T.localName,A),C)for(var R in C)s.endPrefixMapping(R);P||n.fatalError("end tag name: "+A+" is not match the current start tagName:"+T.tagName)}else b.push(T);N++;break;case"?":y&&g(S),N=d(e,S,s);break;case"!":y&&g(S),N=p(e,S,s,n);break;default:y&&g(S);var k=new f,D=b[b.length-1].currentNSMap,j=(N=a(e,S,k,D,i,n),k.length);if(!k.closed&&c(e,N,k.tagName,w)&&(k.closed=!0,r.nbsp||n.warning("unclosed xml attribute")),y&&j){for(var L=o(y,{}),I=0;I<j;I++){var F=k[I];g(F.offset),F.locator=o(y,{})}s.locator=L,h(k,s,D)&&b.push(k),s.locator=y}else h(k,s,D)&&b.push(k);"http://www.w3.org/1999/xhtml"!==k.uri||k.closed?N++:N=l(e,N,k.tagName,i,s)}}catch(e){n.error("element parse error: "+e),N=-1}N>O?O=N:u(Math.max(S,O)+1)}}(e,t,r,s,this.errorHandler),s.endDocument()}},f.prototype={setTagName:function(e){if(!n.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,t,r){if(!n.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:t,offset:r}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},t.G=i},9992:(e,t)=>{!function(e){"use strict";var t=function(e,t){for(var r=0;r<t.length;r+=1)e(t[r],r,t)},r=function(e,r,s){var n=r;return t((function(t,r){n=e(n,t,r)}),s),n},s=function(e,r){var s=new Array(r.length);return t((function(t,r){s[r]=e(t)}),r),s};function n(e){return e.toString()}var i=function(e,t){return t.join(e)},o=function(e,t,r){return e+r+t},a=Array.prototype.concat;function h(e,t){for(var r=Object(e),s=1;s<arguments.length;s++){var n=arguments[s];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])}return r}function l(){this.init()}function c(e){this.expression=e}function u(e,t,r){t in e||(e[t]=r)}function p(){}function d(e){arguments.length>0&&this.init(e)}function f(e){arguments.length>0&&this.init(e)}function g(e,t){arguments.length>0&&this.init(e,t)}function m(e,t){arguments.length>0&&this.init(e,t)}function _(e,t){arguments.length>0&&this.init(e,t)}function v(e,t){arguments.length>0&&this.init(e,t)}function y(e,t){arguments.length>0&&this.init(e,t)}function b(e,t){arguments.length>0&&this.init(e,t)}function w(e,t){arguments.length>0&&this.init(e,t)}function O(e,t){arguments.length>0&&this.init(e,t)}function S(e,t){arguments.length>0&&this.init(e,t)}function E(e,t){arguments.length>0&&this.init(e,t)}function x(e,t){arguments.length>0&&this.init(e,t)}function N(e,t){arguments.length>0&&this.init(e,t)}function A(e,t){arguments.length>0&&this.init(e,t)}function T(e,t){arguments.length>0&&this.init(e,t)}function C(e,t){arguments.length>0&&this.init(e,t)}function P(e,t,r){arguments.length>0&&this.init(e,t,r)}function R(e){for(;e&&e.parentNode;)e=e.parentNode;return e}function k(e,t,r){return P.applyPredicates(e.predicates,t,P.applyStep(e,t,r))}function D(e,t,r){return function(e){for(var t=[],r=0;r<e.length;r+=32767){var s=e.slice(r,r+32767);t=a.apply(t,s)}return t}(s(k.bind(null,r,e),t))}function j(e,t){arguments.length>0&&this.init(e,t)}function L(e,t,r){arguments.length>0&&this.init(e,t,r)}function I(e,t){arguments.length>0&&this.init(e,t)}function F(e){arguments.length>0&&this.init(e)}function U(e,t){arguments.length>0&&this.init(e,t)}l.prototype=new Object,l.prototype.constructor=l,l.superclass=Object.prototype,l.prototype.init=function(){this.reduceActions=[],this.reduceActions[3]=function(e){return new m(e[0],e[2])},this.reduceActions[5]=function(e){return new _(e[0],e[2])},this.reduceActions[7]=function(e){return new v(e[0],e[2])},this.reduceActions[8]=function(e){return new y(e[0],e[2])},this.reduceActions[10]=function(e){return new b(e[0],e[2])},this.reduceActions[11]=function(e){return new w(e[0],e[2])},this.reduceActions[12]=function(e){return new O(e[0],e[2])},this.reduceActions[13]=function(e){return new S(e[0],e[2])},this.reduceActions[15]=function(e){return new E(e[0],e[2])},this.reduceActions[16]=function(e){return new x(e[0],e[2])},this.reduceActions[18]=function(e){return new N(e[0],e[2])},this.reduceActions[19]=function(e){return new A(e[0],e[2])},this.reduceActions[20]=function(e){return new T(e[0],e[2])},this.reduceActions[22]=function(e){return new f(e[1])},this.reduceActions[24]=function(e){return new C(e[0],e[2])},this.reduceActions[25]=function(e){return new P(void 0,void 0,e[0])},this.reduceActions[27]=function(e){return e[0].locationPath=e[2],e[0]},this.reduceActions[28]=function(e){return e[0].locationPath=e[2],e[0].locationPath.steps.unshift(new L(L.DESCENDANTORSELF,I.nodeTest,[])),e[0]},this.reduceActions[29]=function(e){return new P(e[0],[],void 0)},this.reduceActions[30]=function(e){return $.instance_of(e[0],P)?(null==e[0].filterPredicates&&(e[0].filterPredicates=[]),e[0].filterPredicates.push(e[1]),e[0]):new P(e[0],[e[1]],void 0)},this.reduceActions[32]=function(e){return e[1]},this.reduceActions[33]=function(e){return new M(e[0])},this.reduceActions[34]=function(e){return new q(e[0])},this.reduceActions[36]=function(e){return new U(e[0],[])},this.reduceActions[37]=function(e){return new U(e[0],e[2])},this.reduceActions[38]=function(e){return[e[0]]},this.reduceActions[39]=function(e){return e[2].unshift(e[0]),e[2]},this.reduceActions[43]=function(e){return new j(!0,[])},this.reduceActions[44]=function(e){return e[1].absolute=!0,e[1]},this.reduceActions[46]=function(e){return new j(!1,[e[0]])},this.reduceActions[47]=function(e){return e[0].steps.push(e[2]),e[0]},this.reduceActions[49]=function(e){return new L(e[0],e[1],[])},this.reduceActions[50]=function(e){return new L(L.CHILD,e[0],[])},this.reduceActions[51]=function(e){return new L(e[0],e[1],e[2])},this.reduceActions[52]=function(e){return new L(L.CHILD,e[0],e[1])},this.reduceActions[54]=function(e){return[e[0]]},this.reduceActions[55]=function(e){return e[1].unshift(e[0]),e[1]},this.reduceActions[56]=function(e){return"ancestor"==e[0]?L.ANCESTOR:"ancestor-or-self"==e[0]?L.ANCESTORORSELF:"attribute"==e[0]?L.ATTRIBUTE:"child"==e[0]?L.CHILD:"descendant"==e[0]?L.DESCENDANT:"descendant-or-self"==e[0]?L.DESCENDANTORSELF:"following"==e[0]?L.FOLLOWING:"following-sibling"==e[0]?L.FOLLOWINGSIBLING:"namespace"==e[0]?L.NAMESPACE:"parent"==e[0]?L.PARENT:"preceding"==e[0]?L.PRECEDING:"preceding-sibling"==e[0]?L.PRECEDINGSIBLING:"self"==e[0]?L.SELF:-1},this.reduceActions[57]=function(e){return L.ATTRIBUTE},this.reduceActions[59]=function(e){return"comment"==e[0]?I.commentTest:"text"==e[0]?I.textTest:"processing-instruction"==e[0]?I.anyPiTest:"node"==e[0]?I.nodeTest:new I(-1,void 0)},this.reduceActions[60]=function(e){return new I.PITest(e[2])},this.reduceActions[61]=function(e){return e[1]},this.reduceActions[63]=function(e){return e[1].absolute=!0,e[1].steps.unshift(new L(L.DESCENDANTORSELF,I.nodeTest,[])),e[1]},this.reduceActions[64]=function(e){return e[0].steps.push(new L(L.DESCENDANTORSELF,I.nodeTest,[])),e[0].steps.push(e[2]),e[0]},this.reduceActions[65]=function(e){return new L(L.SELF,I.nodeTest,[])},this.reduceActions[66]=function(e){return new L(L.PARENT,I.nodeTest,[])},this.reduceActions[67]=function(e){return new F(e[1])},this.reduceActions[68]=function(e){return I.nameTestAny},this.reduceActions[69]=function(e){return new I.NameTestPrefixAny(e[0].split(":")[0])},this.reduceActions[70]=function(e){return new I.NameTestQName(e[0])}},l.actionTable=[" s s        sssssssss    s ss  s  ss","                 s                  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                rrrrr               "," s s        sssssssss    s ss  s  ss","rs  rrrrrrrr s  sssssrrrrrr  rrs rs "," s s        sssssssss    s ss  s  ss","                            s       ","                            s       ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","  s                                 ","                            s       "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr  r  ","a                                   ","r       s                    rr  r  ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrs  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  srrrrrrrr         rrrrrrs rr sr  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                sssss               ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  srrrrrrrr         rrrrrrs rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","              s                     ","                             s      ","                rrrrr               "," s s        sssssssss    s sss s  ss","r  srrrrrrrr         rrrrrrs rr  r  "," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss      ss  s  ss"," s s        sssssssss    s ss  s  ss"," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr rr  "," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             rr     ","                             s      ","                             rs     ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","                                 r  ","                                 s  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  "," s s        sssssssss    s ss  s  ss","r  rrrrrrrrr         rrrrrrr rr rr  ","                             r      "],l.actionTableNumber=[" 1 0        /.-,+*)('    & %$  #  \"!","                 J                  ","a  aaaaaaaaa         aaaaaaa aa  a  ","                YYYYY               "," 1 0        /.-,+*)('    & %$  #  \"!","K1  KKKKKKKK .  +*)('KKKKKK  KK# K\" "," 1 0        /.-,+*)('    & %$  #  \"!","                            N       ","                            O       ","e  eeeeeeeee         eeeeeee ee ee  ","f  fffffffff         fffffff ff ff  ","d  ddddddddd         ddddddd dd dd  ","B  BBBBBBBBB         BBBBBBB BB BB  ","A  AAAAAAAAA         AAAAAAA AA AA  ","  P                                 ","                            Q       "," 1           .  +*)('          #  \" ","b  bbbbbbbbb         bbbbbbb bb  b  ","                                    ","!       S                    !!  !  ",'"      T"                    ""  "  ',"$   V  $$            U       $$  $  ","&   &ZY&&            &XW     &&  &  ",")   )))))            )))\\[   ))  )  ",".   ....._^]         .....   ..  .  ","1   11111111         11111   11  1  ","5   55555555         55555`  55  5  ","7   77777777         777777  77  7  ","9   99999999         999999  99  9  ",":  c::::::::         ::::::b :: a:  ","I  fIIIIIIII         IIIIIIe II  I  ","=  =========         ======= == ==  ","?  ?????????         ??????? ?? ??  ","C  CCCCCCCCC         CCCCCCC CC CC  ","J   JJJJJJJJ         JJJJJJ  JJ  J  ","M   MMMMMMMM         MMMMMM  MM  M  ","N  NNNNNNNNN         NNNNNNN NN  N  ","P  PPPPPPPPP         PPPPPPP PP  P  ","                +*)('               ","R  RRRRRRRRR         RRRRRRR RR aR  ","U  UUUUUUUUU         UUUUUUU UU  U  ","Z  ZZZZZZZZZ         ZZZZZZZ ZZ ZZ  ","c  ccccccccc         ccccccc cc cc  ","                             j      ","L  fLLLLLLLL         LLLLLLe LL  L  ","6   66666666         66666   66  6  ","              k                     ","                             l      ","                XXXXX               "," 1 0        /.-,+*)('    & %$m #  \"!","_  f________         ______e __  _  "," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('      %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ",">  >>>>>>>>>         >>>>>>> >> >>  "," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ","Q  QQQQQQQQQ         QQQQQQQ QQ aQ  ","V  VVVVVVVVV         VVVVVVV VV aV  ","T  TTTTTTTTT         TTTTTTT TT  T  ","@  @@@@@@@@@         @@@@@@@ @@ @@  ","                                   ","[  [[[[[[[[[         [[[[[[[ [[ [[  ","D  DDDDDDDDD         DDDDDDD DD DD  ","                             HH     ","                                   ","                             F     ","#      T#                    ##  #  ","%   V  %%            U       %%  %  ","'   'ZY''            'XW     ''  '  ","(   (ZY((            (XW     ((  (  ","+   +++++            +++\\[   ++  +  ","*   *****            ***\\[   **  *  ","-   -----            ---\\[   --  -  ",",   ,,,,,            ,,,\\[   ,,  ,  ","0   00000_^]         00000   00  0  ","/   /////_^]         /////   //  /  ","2   22222222         22222   22  2  ","3   33333333         33333   33  3  ","4   44444444         44444   44  4  ","8   88888888         888888  88  8  ","                                 ^  ","                                   ",";  f;;;;;;;;         ;;;;;;e ;;  ;  ","<  f<<<<<<<<         <<<<<<e <<  <  ","O  OOOOOOOOO         OOOOOOO OO  O  ","`  `````````         ``````` ``  `  ","S  SSSSSSSSS         SSSSSSS SS  S  ","W  WWWWWWWWW         WWWWWWW WW  W  ","\\  \\\\\\\\\\\\\\\\\\         \\\\\\\\\\\\\\ \\\\ \\\\  ","E  EEEEEEEEE         EEEEEEE EE EE  "," 1 0        /.-,+*)('    & %$  #  \"!","]  ]]]]]]]]]         ]]]]]]] ]] ]]  ","                             G      "],l.gotoTable=["3456789:;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","L456789:;<=>?@ AB  CDEFGH IJ ","            M        EFGH IJ ","       N;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","            S        EFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","              e              ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                        h  J ","              i          j   ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ ABpqCDEFGH IJ ","                             ","  r6789:;<=>?@ AB  CDEFGH IJ ","   s789:;<=>?@ AB  CDEFGH IJ ","    t89:;<=>?@ AB  CDEFGH IJ ","    u89:;<=>?@ AB  CDEFGH IJ ","     v9:;<=>?@ AB  CDEFGH IJ ","     w9:;<=>?@ AB  CDEFGH IJ ","     x9:;<=>?@ AB  CDEFGH IJ ","     y9:;<=>?@ AB  CDEFGH IJ ","      z:;<=>?@ AB  CDEFGH IJ ","      {:;<=>?@ AB  CDEFGH IJ ","       |;<=>?@ AB  CDEFGH IJ ","       };<=>?@ AB  CDEFGH IJ ","       ~;<=>?@ AB  CDEFGH IJ ","         =>?@ AB  CDEFGH IJ ","456789:;<=>?@ AB  CDEFGH IJ","                    EFGH IJ ","                    EFGH IJ ","                             ","                      GH IJ ","                      GH IJ ","              i             ","              i             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ ABqCDEFGH IJ ","                             ","                             "],l.productions=[[1,1,2],[2,1,3],[3,1,4],[3,3,3,-9,4],[4,1,5],[4,3,4,-8,5],[5,1,6],[5,3,5,-22,6],[5,3,5,-5,6],[6,1,7],[6,3,6,-23,7],[6,3,6,-24,7],[6,3,6,-6,7],[6,3,6,-7,7],[7,1,8],[7,3,7,-25,8],[7,3,7,-26,8],[8,1,9],[8,3,8,-12,9],[8,3,8,-11,9],[8,3,8,-10,9],[9,1,10],[9,2,-26,9],[10,1,11],[10,3,10,-27,11],[11,1,12],[11,1,13],[11,3,13,-28,14],[11,3,13,-4,14],[13,1,15],[13,2,13,16],[15,1,17],[15,3,-29,2,-30],[15,1,-15],[15,1,-16],[15,1,18],[18,3,-13,-29,-30],[18,4,-13,-29,19,-30],[19,1,20],[19,3,20,-31,19],[20,1,2],[12,1,14],[12,1,21],[21,1,-28],[21,2,-28,14],[21,1,22],[14,1,23],[14,3,14,-28,23],[14,1,24],[23,2,25,26],[23,1,26],[23,3,25,26,27],[23,2,26,27],[23,1,28],[27,1,16],[27,2,16,27],[25,2,-14,-3],[25,1,-32],[26,1,29],[26,3,-20,-29,-30],[26,4,-21,-29,-15,-30],[16,3,-33,30,-34],[30,1,2],[22,2,-4,14],[24,3,14,-4,23],[28,1,-35],[28,1,-2],[17,2,-36,-18],[29,1,-17],[29,1,-19],[29,1,-18]],l.DOUBLEDOT=2,l.DOUBLECOLON=3,l.DOUBLESLASH=4,l.NOTEQUAL=5,l.LESSTHANOREQUAL=6,l.GREATERTHANOREQUAL=7,l.AND=8,l.OR=9,l.MOD=10,l.DIV=11,l.MULTIPLYOPERATOR=12,l.FUNCTIONNAME=13,l.AXISNAME=14,l.LITERAL=15,l.NUMBER=16,l.ASTERISKNAMETEST=17,l.QNAME=18,l.NCNAMECOLONASTERISK=19,l.NODETYPE=20,l.PROCESSINGINSTRUCTIONWITHLITERAL=21,l.EQUALS=22,l.LESSTHAN=23,l.GREATERTHAN=24,l.PLUS=25,l.MINUS=26,l.BAR=27,l.SLASH=28,l.LEFTPARENTHESIS=29,l.RIGHTPARENTHESIS=30,l.COMMA=31,l.AT=32,l.LEFTBRACKET=33,l.RIGHTBRACKET=34,l.DOT=35,l.DOLLAR=36,l.prototype.tokenize=function(e){for(var t=[],r=[],s=e+"\0",n=0,i=s.charAt(n++);;){for(;" "==i||"\t"==i||"\r"==i||"\n"==i;)i=s.charAt(n++);if("\0"==i||n>=s.length)break;if("("!=i)if(")"!=i)if("["!=i)if("]"!=i)if("@"!=i)if(","!=i)if("|"!=i)if("+"!=i)if("-"!=i)if("="!=i)if("$"!=i)if("."!=i)if("'"!=i&&'"'!=i)if(i>="0"&&i<="9"){for(u=i,i=s.charAt(n++);i>="0"&&i<="9";)u+=i,i=s.charAt(n++);if("."==i&&s.charAt(n)>="0"&&s.charAt(n)<="9")for(u+=i,u+=s.charAt(n++),i=s.charAt(n++);i>="0"&&i<="9";)u+=i,i=s.charAt(n++);t.push(l.NUMBER),r.push(u)}else if("*"!=i)if(":"!=i||":"!=s.charAt(n))if("/"!=i)if("!"!=i||"="!=s.charAt(n))if("<"!=i)if(">"!=i){if("_"!=i&&!$.isLetter(i.charCodeAt(0)))throw new Error("Unexpected character "+i);var o=i;for(i=s.charAt(n++);$.isNCNameChar(i.charCodeAt(0));)o+=i,i=s.charAt(n++);if(t.length>0&&(a=t[t.length-1])!=l.AT&&a!=l.DOUBLECOLON&&a!=l.LEFTPARENTHESIS&&a!=l.LEFTBRACKET&&a!=l.AND&&a!=l.OR&&a!=l.MOD&&a!=l.DIV&&a!=l.MULTIPLYOPERATOR&&a!=l.SLASH&&a!=l.DOUBLESLASH&&a!=l.BAR&&a!=l.PLUS&&a!=l.MINUS&&a!=l.EQUALS&&a!=l.NOTEQUAL&&a!=l.LESSTHAN&&a!=l.LESSTHANOREQUAL&&a!=l.GREATERTHAN&&a!=l.GREATERTHANOREQUAL){if("and"==o){t.push(l.AND),r.push(o);continue}if("or"==o){t.push(l.OR),r.push(o);continue}if("mod"==o){t.push(l.MOD),r.push(o);continue}if("div"==o){t.push(l.DIV),r.push(o);continue}}if(":"==i){if("*"==s.charAt(n)){t.push(l.NCNAMECOLONASTERISK),r.push(o+":*"),n++,i=s.charAt(n++);continue}if("_"==s.charAt(n)||$.isLetter(s.charCodeAt(n))){for(o+=":",i=s.charAt(n++);$.isNCNameChar(i.charCodeAt(0));)o+=i,i=s.charAt(n++);if("("==i){t.push(l.FUNCTIONNAME),r.push(o);continue}t.push(l.QNAME),r.push(o);continue}if(":"==s.charAt(n)){t.push(l.AXISNAME),r.push(o);continue}}if("("==i){if("comment"==o||"text"==o||"node"==o){t.push(l.NODETYPE),r.push(o);continue}if("processing-instruction"==o){")"==s.charAt(n)?t.push(l.NODETYPE):t.push(l.PROCESSINGINSTRUCTIONWITHLITERAL),r.push(o);continue}t.push(l.FUNCTIONNAME),r.push(o);continue}t.push(l.QNAME),r.push(o)}else{if("="==s.charAt(n)){t.push(l.GREATERTHANOREQUAL),r.push(">="),n++,i=s.charAt(n++);continue}t.push(l.GREATERTHAN),r.push(">"),i=s.charAt(n++)}else{if("="==s.charAt(n)){t.push(l.LESSTHANOREQUAL),r.push("<="),n++,i=s.charAt(n++);continue}t.push(l.LESSTHAN),r.push("<"),i=s.charAt(n++)}else t.push(l.NOTEQUAL),r.push("!="),n++,i=s.charAt(n++);else{if("/"==(i=s.charAt(n++))){t.push(l.DOUBLESLASH),r.push("//"),i=s.charAt(n++);continue}t.push(l.SLASH),r.push("/")}else t.push(l.DOUBLECOLON),r.push("::"),n++,i=s.charAt(n++);else{var a;if(t.length>0&&(a=t[t.length-1])!=l.AT&&a!=l.DOUBLECOLON&&a!=l.LEFTPARENTHESIS&&a!=l.LEFTBRACKET&&a!=l.AND&&a!=l.OR&&a!=l.MOD&&a!=l.DIV&&a!=l.MULTIPLYOPERATOR&&a!=l.SLASH&&a!=l.DOUBLESLASH&&a!=l.BAR&&a!=l.PLUS&&a!=l.MINUS&&a!=l.EQUALS&&a!=l.NOTEQUAL&&a!=l.LESSTHAN&&a!=l.LESSTHANOREQUAL&&a!=l.GREATERTHAN&&a!=l.GREATERTHANOREQUAL){t.push(l.MULTIPLYOPERATOR),r.push(i),i=s.charAt(n++);continue}t.push(l.ASTERISKNAMETEST),r.push(i),i=s.charAt(n++)}else{for(var h=i,c="";n<s.length&&(i=s.charAt(n))!==h;)c+=i,n+=1;if(i!==h)throw Q.fromMessage("Unterminated string literal: "+h+c);n+=1,t.push(l.LITERAL),r.push(c),i=s.charAt(n++)}else{if("."==(i=s.charAt(n++))){t.push(l.DOUBLEDOT),r.push(".."),i=s.charAt(n++);continue}if(i>="0"&&i<="9"){var u="."+i;for(i=s.charAt(n++);i>="0"&&i<="9";)u+=i,i=s.charAt(n++);t.push(l.NUMBER),r.push(u);continue}t.push(l.DOT),r.push(".")}else t.push(l.DOLLAR),r.push(i),i=s.charAt(n++);else t.push(l.EQUALS),r.push(i),i=s.charAt(n++);else t.push(l.MINUS),r.push(i),i=s.charAt(n++);else t.push(l.PLUS),r.push(i),i=s.charAt(n++);else t.push(l.BAR),r.push(i),i=s.charAt(n++);else t.push(l.COMMA),r.push(i),i=s.charAt(n++);else t.push(l.AT),r.push(i),i=s.charAt(n++);else t.push(l.RIGHTBRACKET),r.push(i),i=s.charAt(n++);else t.push(l.LEFTBRACKET),r.push(i),i=s.charAt(n++);else t.push(l.RIGHTPARENTHESIS),r.push(i),i=s.charAt(n++);else t.push(l.LEFTPARENTHESIS),r.push(i),i=s.charAt(n++)}return t.push(1),r.push("[EOF]"),[t,r]},l.SHIFT="s",l.REDUCE="r",l.ACCEPT="a",l.prototype.parse=function(e){var t,r,s=this.tokenize(e);if(null!=s){t=s[0],r=s[1];var n,i,o=0,a=[],h=[],u=[];for(a.push(0),h.push(1),u.push("_S"),n=t[o],i=r[o++];;)switch(e=a[a.length-1],l.actionTable[e].charAt(n-1)){case l.SHIFT:h.push(-n),u.push(i),a.push(l.actionTableNumber[e].charCodeAt(n-1)-32),n=t[o],i=r[o++];break;case l.REDUCE:for(var p=l.productions[l.actionTableNumber[e].charCodeAt(n-1)-32][1],d=[],f=0;f<p;f++)h.pop(),d.unshift(u.pop()),a.pop();var g=a[a.length-1];h.push(l.productions[l.actionTableNumber[e].charCodeAt(n-1)-32][0]),null==this.reduceActions[l.actionTableNumber[e].charCodeAt(n-1)-32]?u.push(d[0]):u.push(this.reduceActions[l.actionTableNumber[e].charCodeAt(n-1)-32](d)),a.push(l.gotoTable[g].charCodeAt(l.productions[l.actionTableNumber[e].charCodeAt(n-1)-32][0]-2)-33);break;case l.ACCEPT:return new c(u.pop());default:throw new Error("XPath parse error")}}},c.prototype=new Object,c.prototype.constructor=c,c.superclass=Object.prototype,c.prototype.toString=function(){return this.expression.toString()},c.prototype.evaluate=function(e){return e.contextNode=e.expressionContextNode,e.contextSize=1,e.contextPosition=1,e.isHtml&&(u(e,"caseInsensitive",!0),u(e,"allowAnyNamespaceForNoPrefix",!0)),u(e,"caseInsensitive",!1),this.expression.evaluate(e)},c.XML_NAMESPACE_URI="http://www.w3.org/XML/1998/namespace",c.XMLNS_NAMESPACE_URI="http://www.w3.org/2000/xmlns/",p.prototype=new Object,p.prototype.constructor=p,p.superclass=Object.prototype,p.prototype.init=function(){},p.prototype.toString=function(){return"<Expression>"},p.prototype.evaluate=function(e){throw new Error("Could not evaluate expression.")},d.prototype=new p,d.prototype.constructor=d,d.superclass=p.prototype,d.prototype.init=function(e){this.rhs=e},f.prototype=new d,f.prototype.constructor=f,f.superclass=d.prototype,f.prototype.init=function(e){f.superclass.init.call(this,e)},f.prototype.evaluate=function(e){return this.rhs.evaluate(e).number().negate()},f.prototype.toString=function(){return"-"+this.rhs.toString()},g.prototype=new p,g.prototype.constructor=g,g.superclass=p.prototype,g.prototype.init=function(e,t){this.lhs=e,this.rhs=t},m.prototype=new g,m.prototype.constructor=m,m.superclass=g.prototype,m.prototype.init=function(e,t){m.superclass.init.call(this,e,t)},m.prototype.toString=function(){return"("+this.lhs.toString()+" or "+this.rhs.toString()+")"},m.prototype.evaluate=function(e){var t=this.lhs.evaluate(e).bool();return t.booleanValue()?t:this.rhs.evaluate(e).bool()},_.prototype=new g,_.prototype.constructor=_,_.superclass=g.prototype,_.prototype.init=function(e,t){_.superclass.init.call(this,e,t)},_.prototype.toString=function(){return"("+this.lhs.toString()+" and "+this.rhs.toString()+")"},_.prototype.evaluate=function(e){var t=this.lhs.evaluate(e).bool();return t.booleanValue()?this.rhs.evaluate(e).bool():t},v.prototype=new g,v.prototype.constructor=v,v.superclass=g.prototype,v.prototype.init=function(e,t){v.superclass.init.call(this,e,t)},v.prototype.toString=function(){return"("+this.lhs.toString()+" = "+this.rhs.toString()+")"},v.prototype.evaluate=function(e){return this.lhs.evaluate(e).equals(this.rhs.evaluate(e))},y.prototype=new g,y.prototype.constructor=y,y.superclass=g.prototype,y.prototype.init=function(e,t){y.superclass.init.call(this,e,t)},y.prototype.toString=function(){return"("+this.lhs.toString()+" != "+this.rhs.toString()+")"},y.prototype.evaluate=function(e){return this.lhs.evaluate(e).notequal(this.rhs.evaluate(e))},b.prototype=new g,b.prototype.constructor=b,b.superclass=g.prototype,b.prototype.init=function(e,t){b.superclass.init.call(this,e,t)},b.prototype.evaluate=function(e){return this.lhs.evaluate(e).lessthan(this.rhs.evaluate(e))},b.prototype.toString=function(){return"("+this.lhs.toString()+" < "+this.rhs.toString()+")"},w.prototype=new g,w.prototype.constructor=w,w.superclass=g.prototype,w.prototype.init=function(e,t){w.superclass.init.call(this,e,t)},w.prototype.evaluate=function(e){return this.lhs.evaluate(e).greaterthan(this.rhs.evaluate(e))},w.prototype.toString=function(){return"("+this.lhs.toString()+" > "+this.rhs.toString()+")"},O.prototype=new g,O.prototype.constructor=O,O.superclass=g.prototype,O.prototype.init=function(e,t){O.superclass.init.call(this,e,t)},O.prototype.evaluate=function(e){return this.lhs.evaluate(e).lessthanorequal(this.rhs.evaluate(e))},O.prototype.toString=function(){return"("+this.lhs.toString()+" <= "+this.rhs.toString()+")"},S.prototype=new g,S.prototype.constructor=S,S.superclass=g.prototype,S.prototype.init=function(e,t){S.superclass.init.call(this,e,t)},S.prototype.evaluate=function(e){return this.lhs.evaluate(e).greaterthanorequal(this.rhs.evaluate(e))},S.prototype.toString=function(){return"("+this.lhs.toString()+" >= "+this.rhs.toString()+")"},E.prototype=new g,E.prototype.constructor=E,E.superclass=g.prototype,E.prototype.init=function(e,t){E.superclass.init.call(this,e,t)},E.prototype.evaluate=function(e){return this.lhs.evaluate(e).number().plus(this.rhs.evaluate(e).number())},E.prototype.toString=function(){return"("+this.lhs.toString()+" + "+this.rhs.toString()+")"},x.prototype=new g,x.prototype.constructor=x,x.superclass=g.prototype,x.prototype.init=function(e,t){x.superclass.init.call(this,e,t)},x.prototype.evaluate=function(e){return this.lhs.evaluate(e).number().minus(this.rhs.evaluate(e).number())},x.prototype.toString=function(){return"("+this.lhs.toString()+" - "+this.rhs.toString()+")"},N.prototype=new g,N.prototype.constructor=N,N.superclass=g.prototype,N.prototype.init=function(e,t){N.superclass.init.call(this,e,t)},N.prototype.evaluate=function(e){return this.lhs.evaluate(e).number().multiply(this.rhs.evaluate(e).number())},N.prototype.toString=function(){return"("+this.lhs.toString()+" * "+this.rhs.toString()+")"},A.prototype=new g,A.prototype.constructor=A,A.superclass=g.prototype,A.prototype.init=function(e,t){A.superclass.init.call(this,e,t)},A.prototype.evaluate=function(e){return this.lhs.evaluate(e).number().div(this.rhs.evaluate(e).number())},A.prototype.toString=function(){return"("+this.lhs.toString()+" div "+this.rhs.toString()+")"},T.prototype=new g,T.prototype.constructor=T,T.superclass=g.prototype,T.prototype.init=function(e,t){T.superclass.init.call(this,e,t)},T.prototype.evaluate=function(e){return this.lhs.evaluate(e).number().mod(this.rhs.evaluate(e).number())},T.prototype.toString=function(){return"("+this.lhs.toString()+" mod "+this.rhs.toString()+")"},C.prototype=new g,C.prototype.constructor=C,C.superclass=g.prototype,C.prototype.init=function(e,t){C.superclass.init.call(this,e,t)},C.prototype.evaluate=function(e){return this.lhs.evaluate(e).nodeset().union(this.rhs.evaluate(e).nodeset())},C.prototype.toString=function(){return s(n,[this.lhs,this.rhs]).join(" | ")},P.prototype=new p,P.prototype.constructor=P,P.superclass=p.prototype,P.prototype.init=function(e,t,r){P.superclass.init.call(this),this.filter=e,this.filterPredicates=t,this.locationPath=r},P.applyPredicates=function(e,s,n){if(0===e.length)return n;var i=s.extend({});return r((function(e,r){return i.contextSize=e.length,s=function(e,t){return i.contextNode=e,i.contextPosition=t+1,P.predicateMatches(r,i)},n=[],t((function(e,t){s(e,t)&&n.push(e)}),e),n;var s,n}),n,e)},P.getRoot=function(e,t){var r=t[0];if(9===r.nodeType)return r;if(e.virtualRoot)return e.virtualRoot;var s=r.ownerDocument;if(s)return s;for(var n=r;null!=n.parentNode;)n=n.parentNode;return n},P.applyStep=function(e,t,r){var s=[];switch(t.contextNode=r,e.axis){case L.ANCESTOR:if(t.contextNode===t.virtualRoot)break;for(n=2==t.contextNode.nodeType?P.getOwnerElement(t.contextNode):t.contextNode.parentNode;null!=n&&(e.nodeTest.matches(n,t)&&s.push(n),n!==t.virtualRoot);)n=n.parentNode;break;case L.ANCESTORORSELF:for(var n=t.contextNode;null!=n&&(e.nodeTest.matches(n,t)&&s.push(n),n!==t.virtualRoot);n=2==n.nodeType?P.getOwnerElement(n):n.parentNode);break;case L.ATTRIBUTE:var i=t.contextNode.attributes;if(null!=i)for(var o=0;o<i.length;o++)n=i.item(o),e.nodeTest.matches(n,t)&&s.push(n);break;case L.CHILD:for(n=t.contextNode.firstChild;null!=n;n=n.nextSibling)e.nodeTest.matches(n,t)&&s.push(n);break;case L.DESCENDANT:for(var a=[t.contextNode.firstChild];a.length>0;)for(n=a.pop();null!=n;)e.nodeTest.matches(n,t)&&s.push(n),null!=n.firstChild?(a.push(n.nextSibling),n=n.firstChild):n=n.nextSibling;break;case L.DESCENDANTORSELF:for(e.nodeTest.matches(t.contextNode,t)&&s.push(t.contextNode),a=[t.contextNode.firstChild];a.length>0;)for(n=a.pop();null!=n;)e.nodeTest.matches(n,t)&&s.push(n),null!=n.firstChild?(a.push(n.nextSibling),n=n.firstChild):n=n.nextSibling;break;case L.FOLLOWING:if(t.contextNode===t.virtualRoot)break;for(a=[],null!=t.contextNode.firstChild?a.unshift(t.contextNode.firstChild):a.unshift(t.contextNode.nextSibling),n=t.contextNode.parentNode;null!=n&&9!=n.nodeType&&n!==t.virtualRoot;n=n.parentNode)a.unshift(n.nextSibling);do{for(n=a.pop();null!=n;)e.nodeTest.matches(n,t)&&s.push(n),null!=n.firstChild?(a.push(n.nextSibling),n=n.firstChild):n=n.nextSibling}while(a.length>0);break;case L.FOLLOWINGSIBLING:if(t.contextNode===t.virtualRoot)break;for(n=t.contextNode.nextSibling;null!=n;n=n.nextSibling)e.nodeTest.matches(n,t)&&s.push(n);break;case L.NAMESPACE:var h={};if(1==t.contextNode.nodeType){for(h.xml=c.XML_NAMESPACE_URI,h.xmlns=c.XMLNS_NAMESPACE_URI,n=t.contextNode;null!=n&&1==n.nodeType;n=n.parentNode)for(o=0;o<n.attributes.length;o++){var l=n.attributes.item(o),u=String(l.name);"xmlns"==u?null==h[""]&&(h[""]=l.value):u.length>6&&"xmlns:"==u.substring(0,6)&&null==h[p=u.substring(6,u.length)]&&(h[p]=l.value)}for(var p in h){var d=new G(p,h[p],t.contextNode);e.nodeTest.matches(d,t)&&s.push(d)}}break;case L.PARENT:n=null,t.contextNode!==t.virtualRoot&&(n=2==t.contextNode.nodeType?P.getOwnerElement(t.contextNode):t.contextNode.parentNode),null!=n&&e.nodeTest.matches(n,t)&&s.push(n);break;case L.PRECEDING:a=null!=t.virtualRoot?[t.virtualRoot]:[R(t.contextNode)];e:for(;a.length>0;)for(n=a.pop();null!=n;){if(n==t.contextNode)break e;e.nodeTest.matches(n,t)&&s.unshift(n),null!=n.firstChild?(a.push(n.nextSibling),n=n.firstChild):n=n.nextSibling}break;case L.PRECEDINGSIBLING:if(t.contextNode===t.virtualRoot)break;for(n=t.contextNode.previousSibling;null!=n;n=n.previousSibling)e.nodeTest.matches(n,t)&&s.push(n);break;case L.SELF:e.nodeTest.matches(t.contextNode,t)&&s.push(t.contextNode)}return s},P.applySteps=function(e,t,s){return r(D.bind(null,t),s,e)},P.prototype.applyFilter=function(e,t){if(!this.filter)return{nodes:[e.contextNode]};var r=this.filter.evaluate(e);if(!$.instance_of(r,W)){if(null!=this.filterPredicates&&this.filterPredicates.length>0||null!=this.locationPath)throw new Error("Path expression filter must evaluate to a nodeset if predicates or location path are used");return{nonNodes:r}}return{nodes:P.applyPredicates(this.filterPredicates||[],t,r.toUnsortedArray())}},P.applyLocationPath=function(e,t,r){if(!e)return r;var s=e.absolute?[P.getRoot(t,r)]:r;return P.applySteps(e.steps,t,s)},P.prototype.evaluate=function(e){var t=h(new z,e),r=this.applyFilter(e,t);if("nonNodes"in r)return r.nonNodes;var s=new W;return s.addArray(P.applyLocationPath(this.locationPath,t,r.nodes)),s},P.predicateMatches=function(e,t){var r=e.evaluate(t);return $.instance_of(r,q)?t.contextPosition===r.numberValue():r.booleanValue()},P.predicateString=function(e){return o("[","]",e.toString())},P.predicatesString=function(e){return i("",s(P.predicateString,e))},P.prototype.toString=function(){if(null!=this.filter){var e=n(this.filter);return $.instance_of(this.filter,M)?o("'","'",e):null!=this.filterPredicates&&this.filterPredicates.length?o("(",")",e)+P.predicatesString(this.filterPredicates):null!=this.locationPath?e+(this.locationPath.absolute?"":"/")+n(this.locationPath):e}return n(this.locationPath)},P.getOwnerElement=function(e){if(e.ownerElement)return e.ownerElement;try{if(e.selectSingleNode)return e.selectSingleNode("..")}catch(e){}for(var t=(9==e.nodeType?e:e.ownerDocument).getElementsByTagName("*"),r=0;r<t.length;r++)for(var s=t.item(r),n=s.attributes,i=0;i<n.length;i++)if(n.item(i)===e)return s;return null},j.prototype=new Object,j.prototype.constructor=j,j.superclass=Object.prototype,j.prototype.init=function(e,t){this.absolute=e,this.steps=t},j.prototype.toString=function(){return(this.absolute?"/":"")+s(n,this.steps).join("/")},L.prototype=new Object,L.prototype.constructor=L,L.superclass=Object.prototype,L.prototype.init=function(e,t,r){this.axis=e,this.nodeTest=t,this.predicates=r},L.prototype.toString=function(){return L.STEPNAMES[this.axis]+"::"+this.nodeTest.toString()+P.predicatesString(this.predicates)},L.ANCESTOR=0,L.ANCESTORORSELF=1,L.ATTRIBUTE=2,L.CHILD=3,L.DESCENDANT=4,L.DESCENDANTORSELF=5,L.FOLLOWING=6,L.FOLLOWINGSIBLING=7,L.NAMESPACE=8,L.PARENT=9,L.PRECEDING=10,L.PRECEDINGSIBLING=11,L.SELF=12,L.STEPNAMES=r((function(e,t){return e[t[0]]=t[1],e}),{},[[L.ANCESTOR,"ancestor"],[L.ANCESTORORSELF,"ancestor-or-self"],[L.ATTRIBUTE,"attribute"],[L.CHILD,"child"],[L.DESCENDANT,"descendant"],[L.DESCENDANTORSELF,"descendant-or-self"],[L.FOLLOWING,"following"],[L.FOLLOWINGSIBLING,"following-sibling"],[L.NAMESPACE,"namespace"],[L.PARENT,"parent"],[L.PRECEDING,"preceding"],[L.PRECEDINGSIBLING,"preceding-sibling"],[L.SELF,"self"]]),I.prototype=new Object,I.prototype.constructor=I,I.superclass=Object.prototype,I.prototype.init=function(e,t){this.type=e,this.value=t},I.prototype.toString=function(){return"<unknown nodetest type>"},I.prototype.matches=function(e,t){console.warn("unknown node test type")},I.NAMETESTANY=0,I.NAMETESTPREFIXANY=1,I.NAMETESTQNAME=2,I.COMMENT=3,I.TEXT=4,I.PI=5,I.NODE=6,I.isNodeType=function(e){return function(t){return function(e,t){for(var r=0;r<e.length;r+=1)if(e[r]===t)return!0;return!1}(e,t.nodeType)}},I.makeNodeTestType=function(e,t,r){var s=r||function(){};return s.prototype=new I(e),s.prototype.constructor=s,h(s.prototype,t),s},I.makeNodeTypeTest=function(e,t,r){return new(I.makeNodeTestType(e,{matches:I.isNodeType(t),toString:(s=r,function(){return s})}));var s},I.hasPrefix=function(e){return e.prefix||-1!==(e.nodeName||e.tagName).indexOf(":")},I.isElementOrAttribute=I.isNodeType([1,2]),I.nameSpaceMatches=function(e,t,r){var s=r.namespaceURI||"";if(!e)return!s||t.allowAnyNamespaceForNoPrefix&&!I.hasPrefix(r);var n=t.namespaceResolver.getNamespace(e,t.expressionContextNode);if(null==n)throw new Error("Cannot resolve QName "+e);return n===s},I.localNameMatches=function(e,t,r){var s=r.localName||r.nodeName;return t.caseInsensitive?e.toLowerCase()===s.toLowerCase():e===s},I.NameTestPrefixAny=I.makeNodeTestType(I.NAMETESTPREFIXANY,{matches:function(e,t){return I.isElementOrAttribute(e)&&I.nameSpaceMatches(this.prefix,t,e)},toString:function(){return this.prefix+":*"}},(function(e){this.prefix=e})),I.NameTestQName=I.makeNodeTestType(I.NAMETESTQNAME,{matches:function(e,t){return I.isNodeType([1,2,G.XPATH_NAMESPACE_NODE])(e)&&I.nameSpaceMatches(this.prefix,t,e)&&I.localNameMatches(this.localName,t,e)},toString:function(){return this.name}},(function(e){var t=e.split(":");this.name=e,this.prefix=t.length>1?t[0]:null,this.localName=t[t.length>1?1:0]})),I.PITest=I.makeNodeTestType(I.PI,{matches:function(e,t){return I.isNodeType([7])(e)&&(e.target||e.nodeName)===this.name},toString:function(){return o('processing-instruction("','")',this.name)}},(function(e){this.name=e})),I.nameTestAny=I.makeNodeTypeTest(I.NAMETESTANY,[1,2,G.XPATH_NAMESPACE_NODE],"*"),I.textTest=I.makeNodeTypeTest(I.TEXT,[3,4],"text()"),I.commentTest=I.makeNodeTypeTest(I.COMMENT,[8],"comment()"),I.nodeTest=I.makeNodeTypeTest(I.NODE,[1,2,3,4,7,8,9],"node()"),I.anyPiTest=I.makeNodeTypeTest(I.PI,[7],"processing-instruction()"),F.prototype=new p,F.prototype.constructor=F,F.superclass=p.prototype,F.prototype.init=function(e){this.variable=e},F.prototype.toString=function(){return"$"+this.variable},F.prototype.evaluate=function(e){var t=$.resolveQName(this.variable,e.namespaceResolver,e.contextNode,!1);if(null==t[0])throw new Error("Cannot resolve QName "+fn);var r=e.variableResolver.getVariable(t[1],t[0]);if(!r)throw Q.fromMessage("Undeclared variable: "+this.toString());return r},U.prototype=new p,U.prototype.constructor=U,U.superclass=p.prototype,U.prototype.init=function(e,t){this.functionName=e,this.arguments=t},U.prototype.toString=function(){for(var e=this.functionName+"(",t=0;t<this.arguments.length;t++)t>0&&(e+=", "),e+=this.arguments[t].toString();return e+")"},U.prototype.evaluate=function(e){var t=K.getFunctionFromContext(this.functionName,e);if(!t)throw new Error("Unknown function "+this.functionName);var r=[e].concat(this.arguments);return t.apply(e.functionResolver.thisArg,r)};var B=new Object;function M(e){arguments.length>0&&this.init(e)}function q(e){arguments.length>0&&this.init(e)}function H(e){arguments.length>0&&this.init(e)}function V(e){this.init(e)}function W(){this.init()}function G(e,t,r){this.isXPathNamespace=!0,this.ownerDocument=r.ownerDocument,this.nodeName="#namespace",this.prefix=e,this.localName=e,this.namespaceURI=t,this.nodeValue=t,this.ownerElement=r,this.nodeType=G.XPATH_NAMESPACE_NODE}function z(e,t,r){this.variableResolver=null!=e?e:new X,this.namespaceResolver=null!=t?t:new Y,this.functionResolver=null!=r?r:new K}function X(){}function K(e){this.thisArg=null!=e?e:J,this.functions=new Object,this.addStandardFunctions()}function Y(){}B.equals=function(e,t){return e.equals(t)},B.notequal=function(e,t){return e.notequal(t)},B.lessthan=function(e,t){return e.lessthan(t)},B.greaterthan=function(e,t){return e.greaterthan(t)},B.lessthanorequal=function(e,t){return e.lessthanorequal(t)},B.greaterthanorequal=function(e,t){return e.greaterthanorequal(t)},M.prototype=new p,M.prototype.constructor=M,M.superclass=p.prototype,M.prototype.init=function(e){this.str=String(e)},M.prototype.toString=function(){return this.str},M.prototype.evaluate=function(e){return this},M.prototype.string=function(){return this},M.prototype.number=function(){return new q(this.str)},M.prototype.bool=function(){return new H(this.str)},M.prototype.nodeset=function(){throw new Error("Cannot convert string to nodeset")},M.prototype.stringValue=function(){return this.str},M.prototype.numberValue=function(){return this.number().numberValue()},M.prototype.booleanValue=function(){return this.bool().booleanValue()},M.prototype.equals=function(e){return $.instance_of(e,H)?this.bool().equals(e):$.instance_of(e,q)?this.number().equals(e):$.instance_of(e,W)?e.compareWithString(this,B.equals):new H(this.str==e.str)},M.prototype.notequal=function(e){return $.instance_of(e,H)?this.bool().notequal(e):$.instance_of(e,q)?this.number().notequal(e):$.instance_of(e,W)?e.compareWithString(this,B.notequal):new H(this.str!=e.str)},M.prototype.lessthan=function(e){return this.number().lessthan(e)},M.prototype.greaterthan=function(e){return this.number().greaterthan(e)},M.prototype.lessthanorequal=function(e){return this.number().lessthanorequal(e)},M.prototype.greaterthanorequal=function(e){return this.number().greaterthanorequal(e)},q.prototype=new p,q.prototype.constructor=q,q.superclass=p.prototype,q.prototype.init=function(e){this.num="string"==typeof e?this.parse(e):Number(e)},q.prototype.numberFormat=/^\s*-?[0-9]*\.?[0-9]+\s*$/,q.prototype.parse=function(e){return this.numberFormat.test(e)?parseFloat(e):Number.NaN},q.prototype.toString=function(){var e=this.num.toString();return-1!==e.indexOf("e-")?function(e){for(var t=e.split("e-"),r=t[0].replace(".",""),s=Number(t[1]),n=0;n<s-1;n+=1)r="0"+r;return"0."+r}(e):-1!==e.indexOf("e")?function(e){for(var t=e.split("e"),r=t[0].replace(".",""),s=Number(t[1])+1-r.length,n=0;n<s;n+=1)r+="0";return r}(e):e},q.prototype.evaluate=function(e){return this},q.prototype.string=function(){return new M(this.toString())},q.prototype.number=function(){return this},q.prototype.bool=function(){return new H(this.num)},q.prototype.nodeset=function(){throw new Error("Cannot convert number to nodeset")},q.prototype.stringValue=function(){return this.string().stringValue()},q.prototype.numberValue=function(){return this.num},q.prototype.booleanValue=function(){return this.bool().booleanValue()},q.prototype.negate=function(){return new q(-this.num)},q.prototype.equals=function(e){return $.instance_of(e,H)?this.bool().equals(e):$.instance_of(e,M)?this.equals(e.number()):$.instance_of(e,W)?e.compareWithNumber(this,B.equals):new H(this.num==e.num)},q.prototype.notequal=function(e){return $.instance_of(e,H)?this.bool().notequal(e):$.instance_of(e,M)?this.notequal(e.number()):$.instance_of(e,W)?e.compareWithNumber(this,B.notequal):new H(this.num!=e.num)},q.prototype.lessthan=function(e){return $.instance_of(e,W)?e.compareWithNumber(this,B.greaterthan):$.instance_of(e,H)||$.instance_of(e,M)?this.lessthan(e.number()):new H(this.num<e.num)},q.prototype.greaterthan=function(e){return $.instance_of(e,W)?e.compareWithNumber(this,B.lessthan):$.instance_of(e,H)||$.instance_of(e,M)?this.greaterthan(e.number()):new H(this.num>e.num)},q.prototype.lessthanorequal=function(e){return $.instance_of(e,W)?e.compareWithNumber(this,B.greaterthanorequal):$.instance_of(e,H)||$.instance_of(e,M)?this.lessthanorequal(e.number()):new H(this.num<=e.num)},q.prototype.greaterthanorequal=function(e){return $.instance_of(e,W)?e.compareWithNumber(this,B.lessthanorequal):$.instance_of(e,H)||$.instance_of(e,M)?this.greaterthanorequal(e.number()):new H(this.num>=e.num)},q.prototype.plus=function(e){return new q(this.num+e.num)},q.prototype.minus=function(e){return new q(this.num-e.num)},q.prototype.multiply=function(e){return new q(this.num*e.num)},q.prototype.div=function(e){return new q(this.num/e.num)},q.prototype.mod=function(e){return new q(this.num%e.num)},H.prototype=new p,H.prototype.constructor=H,H.superclass=p.prototype,H.prototype.init=function(e){this.b=Boolean(e)},H.prototype.toString=function(){return this.b.toString()},H.prototype.evaluate=function(e){return this},H.prototype.string=function(){return new M(this.b)},H.prototype.number=function(){return new q(this.b)},H.prototype.bool=function(){return this},H.prototype.nodeset=function(){throw new Error("Cannot convert boolean to nodeset")},H.prototype.stringValue=function(){return this.string().stringValue()},H.prototype.numberValue=function(){return this.number().numberValue()},H.prototype.booleanValue=function(){return this.b},H.prototype.not=function(){return new H(!this.b)},H.prototype.equals=function(e){return $.instance_of(e,M)||$.instance_of(e,q)?this.equals(e.bool()):$.instance_of(e,W)?e.compareWithBoolean(this,B.equals):new H(this.b==e.b)},H.prototype.notequal=function(e){return $.instance_of(e,M)||$.instance_of(e,q)?this.notequal(e.bool()):$.instance_of(e,W)?e.compareWithBoolean(this,B.notequal):new H(this.b!=e.b)},H.prototype.lessthan=function(e){return this.number().lessthan(e)},H.prototype.greaterthan=function(e){return this.number().greaterthan(e)},H.prototype.lessthanorequal=function(e){return this.number().lessthanorequal(e)},H.prototype.greaterthanorequal=function(e){return this.number().greaterthanorequal(e)},H.true_=new H(!0),H.false_=new H(!1),V.prototype=new Object,V.prototype.constructor=V,V.superclass=Object.prototype,V.prototype.init=function(e){this.left=null,this.right=null,this.node=e,this.depth=1},V.prototype.balance=function(){var e=null==this.left?0:this.left.depth,t=null==this.right?0:this.right.depth;if(e>t+1)(null==this.left.left?0:this.left.left.depth)<(null==this.left.right?0:this.left.right.depth)&&this.left.rotateRR(),this.rotateLL();else if(e+1<t){var r=null==this.right.right?0:this.right.right.depth;(null==this.right.left?0:this.right.left.depth)>r&&this.right.rotateLL(),this.rotateRR()}},V.prototype.rotateLL=function(){var e=this.node,t=this.right;this.node=this.left.node,this.right=this.left,this.left=this.left.left,this.right.left=this.right.right,this.right.right=t,this.right.node=e,this.right.updateInNewLocation(),this.updateInNewLocation()},V.prototype.rotateRR=function(){var e=this.node,t=this.left;this.node=this.right.node,this.left=this.right,this.right=this.right.right,this.left.right=this.left.left,this.left.left=t,this.left.node=e,this.left.updateInNewLocation(),this.updateInNewLocation()},V.prototype.updateInNewLocation=function(){this.getDepthFromChildren()},V.prototype.getDepthFromChildren=function(){this.depth=null==this.node?0:1,null!=this.left&&(this.depth=this.left.depth+1),null!=this.right&&this.depth<=this.right.depth&&(this.depth=this.right.depth+1)},V.prototype.add=function(e){if(e===this.node)return!1;var t=function(e,t){if(e===t)return 0;if(e.compareDocumentPosition){var r=e.compareDocumentPosition(t);return 1&r||10&r?1:20&r?-1:0}for(var s=0,n=0,i=e;null!=i;i=i.parentNode||i.ownerElement)s++;for(var o=t;null!=o;o=o.parentNode||o.ownerElement)n++;if(s>n){for(;s>n;)e=e.parentNode||e.ownerElement,s--;if(e===t)return 1}else if(n>s){for(;n>s;)t=t.parentNode||t.ownerElement,n--;if(e===t)return-1}for(var a=e.parentNode||e.ownerElement,h=t.parentNode||t.ownerElement;a!==h;)t=h,a=(e=a).parentNode||e.ownerElement,h=t.parentNode||t.ownerElement;var l=$.isAttribute(e),c=$.isAttribute(t);if(l&&!c)return-1;if(!l&&c)return 1;if(a)for(var u=l?a.attributes:a.childNodes,p=u.length,d=0;d<p;d+=1){var f=u[d];if(f===e)return-1;if(f===t)return 1}throw new Error("Unexpected: could not determine node order")}(e,this.node),r=!1;return-1==t?null==this.left?(this.left=new V(e),r=!0):(r=this.left.add(e))&&this.balance():1==t&&(null==this.right?(this.right=new V(e),r=!0):(r=this.right.add(e))&&this.balance()),r&&this.getDepthFromChildren(),r},W.prototype=new p,W.prototype.constructor=W,W.superclass=p.prototype,W.prototype.init=function(){this.tree=null,this.nodes=[],this.size=0},W.prototype.toString=function(){var e=this.first();return null==e?"":this.stringForNode(e)},W.prototype.evaluate=function(e){return this},W.prototype.string=function(){return new M(this.toString())},W.prototype.stringValue=function(){return this.toString()},W.prototype.number=function(){return new q(this.string())},W.prototype.numberValue=function(){return Number(this.string())},W.prototype.bool=function(){return new H(this.booleanValue())},W.prototype.booleanValue=function(){return!!this.size},W.prototype.nodeset=function(){return this},W.prototype.stringForNode=function(e){return 9==e.nodeType||1==e.nodeType||11===e.nodeType?this.stringForContainerNode(e):2===e.nodeType?e.value||e.nodeValue:e.isNamespaceNode?e.namespace:e.nodeValue},W.prototype.stringForContainerNode=function(e){for(var t="",r=e.firstChild;null!=r;r=r.nextSibling){var s=r.nodeType;1!==s&&3!==s&&4!==s&&9!==s&&11!==s||(t+=this.stringForNode(r))}return t},W.prototype.buildTree=function(){if(!this.tree&&this.nodes.length){this.tree=new V(this.nodes[0]);for(var e=1;e<this.nodes.length;e+=1)this.tree.add(this.nodes[e])}return this.tree},W.prototype.first=function(){var e=this.buildTree();if(null==e)return null;for(;null!=e.left;)e=e.left;return e.node},W.prototype.add=function(e){for(var t=0;t<this.nodes.length;t+=1)if(e===this.nodes[t])return;this.tree=null,this.nodes.push(e),this.size+=1},W.prototype.addArray=function(e){var r=this;t((function(e){r.add(e)}),e)},W.prototype.toArray=function(){var e=[];return this.toArrayRec(this.buildTree(),e),e},W.prototype.toArrayRec=function(e,t){null!=e&&(this.toArrayRec(e.left,t),t.push(e.node),this.toArrayRec(e.right,t))},W.prototype.toUnsortedArray=function(){return this.nodes.slice()},W.prototype.compareWithString=function(e,t){for(var r=this.toUnsortedArray(),s=0;s<r.length;s++){var n=r[s],i=t(new M(this.stringForNode(n)),e);if(i.booleanValue())return i}return new H(!1)},W.prototype.compareWithNumber=function(e,t){for(var r=this.toUnsortedArray(),s=0;s<r.length;s++){var n=r[s],i=t(new q(this.stringForNode(n)),e);if(i.booleanValue())return i}return new H(!1)},W.prototype.compareWithBoolean=function(e,t){return t(this.bool(),e)},W.prototype.compareWithNodeSet=function(e,t){for(var r=this.toUnsortedArray(),s=function(e,r){return t(r,e)},n=0;n<r.length;n++){var i=new M(this.stringForNode(r[n])),o=e.compareWithString(i,s);if(o.booleanValue())return o}return new H(!1)},W.compareWith=function(e){var t=Array.prototype.slice,r=e.length,s=function(e,r){return function(){return r.apply(this,e.concat(t.call(arguments)))}},n=function(){var i=t.call(arguments);return i.length<r?s(i,n):e.apply(this,t.apply(arguments,[0,r]))};return n}((function(e,t){return $.instance_of(t,M)?this.compareWithString(t,e):$.instance_of(t,q)?this.compareWithNumber(t,e):$.instance_of(t,H)?this.compareWithBoolean(t,e):this.compareWithNodeSet(t,e)})),W.prototype.equals=W.compareWith(B.equals),W.prototype.notequal=W.compareWith(B.notequal),W.prototype.lessthan=W.compareWith(B.lessthan),W.prototype.greaterthan=W.compareWith(B.greaterthan),W.prototype.lessthanorequal=W.compareWith(B.lessthanorequal),W.prototype.greaterthanorequal=W.compareWith(B.greaterthanorequal),W.prototype.union=function(e){var t=new W;return t.addArray(this.toUnsortedArray()),t.addArray(e.toUnsortedArray()),t},G.prototype=new Object,G.prototype.constructor=G,G.superclass=Object.prototype,G.prototype.toString=function(){return'{ "'+this.prefix+'", "'+this.namespaceURI+'" }'},z.prototype=new Object,z.prototype.constructor=z,z.superclass=Object.prototype,z.prototype.extend=function(e){return h(new z,this,e)},X.prototype=new Object,X.prototype.constructor=X,X.superclass=Object.prototype,X.prototype.getVariable=function(e,t){return null},K.prototype=new Object,K.prototype.constructor=K,K.superclass=Object.prototype,K.prototype.addStandardFunctions=function(){this.functions["{}last"]=J.last,this.functions["{}position"]=J.position,this.functions["{}count"]=J.count,this.functions["{}id"]=J.id,this.functions["{}local-name"]=J.localName,this.functions["{}namespace-uri"]=J.namespaceURI,this.functions["{}name"]=J.name,this.functions["{}string"]=J.string,this.functions["{}concat"]=J.concat,this.functions["{}starts-with"]=J.startsWith,this.functions["{}contains"]=J.contains,this.functions["{}substring-before"]=J.substringBefore,this.functions["{}substring-after"]=J.substringAfter,this.functions["{}substring"]=J.substring,this.functions["{}string-length"]=J.stringLength,this.functions["{}normalize-space"]=J.normalizeSpace,this.functions["{}translate"]=J.translate,this.functions["{}boolean"]=J.boolean_,this.functions["{}not"]=J.not,this.functions["{}true"]=J.true_,this.functions["{}false"]=J.false_,this.functions["{}lang"]=J.lang,this.functions["{}number"]=J.number,this.functions["{}sum"]=J.sum,this.functions["{}floor"]=J.floor,this.functions["{}ceiling"]=J.ceiling,this.functions["{}round"]=J.round},K.prototype.addFunction=function(e,t,r){this.functions["{"+e+"}"+t]=r},K.getFunctionFromContext=function(e,t){var r=$.resolveQName(e,t.namespaceResolver,t.contextNode,!1);if(null===r[0])throw new Error("Cannot resolve QName "+name);return t.functionResolver.getFunction(r[1],r[0])},K.prototype.getFunction=function(e,t){return this.functions["{"+t+"}"+e]},Y.prototype=new Object,Y.prototype.constructor=Y,Y.superclass=Object.prototype,Y.prototype.getNamespace=function(e,t){if("xml"==e)return c.XML_NAMESPACE_URI;if("xmlns"==e)return c.XMLNS_NAMESPACE_URI;for(9==t.nodeType?t=t.documentElement:2==t.nodeType?t=P.getOwnerElement(t):1!=t.nodeType&&(t=t.parentNode);null!=t&&1==t.nodeType;){for(var r=t.attributes,s=0;s<r.length;s++){var n=r.item(s),i=n.name||n.nodeName;if("xmlns"===i&&""===e||i==="xmlns:"+e)return String(n.value||n.nodeValue)}t=t.parentNode}return null};var J=new Object;J.last=function(e){if(1!=arguments.length)throw new Error("Function last expects ()");return new q(e.contextSize)},J.position=function(e){if(1!=arguments.length)throw new Error("Function position expects ()");return new q(e.contextPosition)},J.count=function(){var e,t=arguments[0];if(2!=arguments.length||!$.instance_of(e=arguments[1].evaluate(t),W))throw new Error("Function count expects (node-set)");return new q(e.size)},J.id=function(){var e,t=arguments[0];if(2!=arguments.length)throw new Error("Function id expects (object)");e=arguments[1].evaluate(t);for(var r=(e=$.instance_of(e,W)?e.toArray().join(" "):e.stringValue()).split(/[\x0d\x0a\x09\x20]+/),s=new W,n=9==t.contextNode.nodeType?t.contextNode:t.contextNode.ownerDocument,i=0;i<r.length;i++){var o;null!=(o=n.getElementById?n.getElementById(r[i]):$.getElementById(n,r[i]))&&s.add(o)}return s},J.localName=function(e,t){var r;if(1==arguments.length)r=e.contextNode;else{if(2!=arguments.length)throw new Error("Function local-name expects (node-set?)");r=t.evaluate(e).first()}return new M(null==r?"":r.localName||r.baseName||r.target||r.nodeName||"")},J.namespaceURI=function(){var e,t=arguments[0];if(1==arguments.length)e=t.contextNode;else{if(2!=arguments.length)throw new Error("Function namespace-uri expects (node-set?)");e=arguments[1].evaluate(t).first()}return new M(null==e?"":e.namespaceURI)},J.name=function(){var e,t=arguments[0];if(1==arguments.length)e=t.contextNode;else{if(2!=arguments.length)throw new Error("Function name expects (node-set?)");e=arguments[1].evaluate(t).first()}return null==e?new M(""):1==e.nodeType?new M(e.nodeName):2==e.nodeType?new M(e.name||e.nodeName):7===e.nodeType?new M(e.target||e.nodeName):null==e.localName?new M(""):new M(e.localName)},J.string=function(){var e=arguments[0];if(1==arguments.length)return new M(W.prototype.stringForNode(e.contextNode));if(2==arguments.length)return arguments[1].evaluate(e).string();throw new Error("Function string expects (object?)")},J.concat=function(e){if(arguments.length<3)throw new Error("Function concat expects (string, string[, string]*)");for(var t="",r=1;r<arguments.length;r++)t+=arguments[r].evaluate(e).stringValue();return new M(t)},J.startsWith=function(){var e=arguments[0];if(3!=arguments.length)throw new Error("Function startsWith expects (string, string)");var t=arguments[1].evaluate(e).stringValue(),r=arguments[2].evaluate(e).stringValue();return new H(t.substring(0,r.length)==r)},J.contains=function(){var e=arguments[0];if(3!=arguments.length)throw new Error("Function contains expects (string, string)");var t=arguments[1].evaluate(e).stringValue(),r=arguments[2].evaluate(e).stringValue();return new H(-1!==t.indexOf(r))},J.substringBefore=function(){var e=arguments[0];if(3!=arguments.length)throw new Error("Function substring-before expects (string, string)");var t=arguments[1].evaluate(e).stringValue(),r=arguments[2].evaluate(e).stringValue();return new M(t.substring(0,t.indexOf(r)))},J.substringAfter=function(){var e=arguments[0];if(3!=arguments.length)throw new Error("Function substring-after expects (string, string)");var t=arguments[1].evaluate(e).stringValue(),r=arguments[2].evaluate(e).stringValue();if(0==r.length)return new M(t);var s=t.indexOf(r);return new M(-1==s?"":t.substring(s+r.length))},J.substring=function(){var e=arguments[0];if(3!=arguments.length&&4!=arguments.length)throw new Error("Function substring expects (string, number, number?)");var t=arguments[1].evaluate(e).stringValue(),r=Math.round(arguments[2].evaluate(e).numberValue())-1,s=4==arguments.length?r+Math.round(arguments[3].evaluate(e).numberValue()):void 0;return new M(t.substring(r,s))},J.stringLength=function(){var e,t=arguments[0];if(1==arguments.length)e=W.prototype.stringForNode(t.contextNode);else{if(2!=arguments.length)throw new Error("Function string-length expects (string?)");e=arguments[1].evaluate(t).stringValue()}return new q(e.length)},J.normalizeSpace=function(){var e,t=arguments[0];if(1==arguments.length)e=W.prototype.stringForNode(t.contextNode);else{if(2!=arguments.length)throw new Error("Function normalize-space expects (string?)");e=arguments[1].evaluate(t).stringValue()}for(var r=0,s=e.length-1;$.isSpace(e.charCodeAt(s));)s--;for(var n="";r<=s&&$.isSpace(e.charCodeAt(r));)r++;for(;r<=s;)if($.isSpace(e.charCodeAt(r)))for(n+=" ";r<=s&&$.isSpace(e.charCodeAt(r));)r++;else n+=e.charAt(r),r++;return new M(n)},J.translate=function(e,t,n,o){if(4!=arguments.length)throw new Error("Function translate expects (string, string, string)");var a=t.evaluate(e).stringValue(),h=n.evaluate(e).stringValue(),l=o.evaluate(e).stringValue(),c=r((function(e,t,r){return t in e||(e[t]=r>l.length?"":l[r]),e}),{},h),u=i("",s((function(e){return e in c?c[e]:e}),a));return new M(u)},J.boolean_=function(){var e=arguments[0];if(2!=arguments.length)throw new Error("Function boolean expects (object)");return arguments[1].evaluate(e).bool()},J.not=function(e,t){if(2!=arguments.length)throw new Error("Function not expects (object)");return t.evaluate(e).bool().not()},J.true_=function(){if(1!=arguments.length)throw new Error("Function true expects ()");return H.true_},J.false_=function(){if(1!=arguments.length)throw new Error("Function false expects ()");return H.false_},J.lang=function(){var e,t=arguments[0];if(2!=arguments.length)throw new Error("Function lang expects (string)");for(var r=t.contextNode;null!=r&&9!=r.nodeType;r=r.parentNode){var s=r.getAttributeNS(c.XML_NAMESPACE_URI,"lang");if(null!=s){e=String(s);break}}if(null==e)return H.false_;var n=arguments[1].evaluate(t).stringValue();return new H(e.substring(0,n.length)==n&&(e.length==n.length||"-"==e.charAt(n.length)))},J.number=function(){var e=arguments[0];if(1!=arguments.length&&2!=arguments.length)throw new Error("Function number expects (object?)");return 1==arguments.length?new q(W.prototype.stringForNode(e.contextNode)):arguments[1].evaluate(e).number()},J.sum=function(){var e,t=arguments[0];if(2!=arguments.length||!$.instance_of(e=arguments[1].evaluate(t),W))throw new Error("Function sum expects (node-set)");e=e.toUnsortedArray();for(var r=0,s=0;s<e.length;s++)r+=new q(W.prototype.stringForNode(e[s])).numberValue();return new q(r)},J.floor=function(){var e=arguments[0];if(2!=arguments.length)throw new Error("Function floor expects (number)");return new q(Math.floor(arguments[1].evaluate(e).numberValue()))},J.ceiling=function(){var e=arguments[0];if(2!=arguments.length)throw new Error("Function ceiling expects (number)");return new q(Math.ceil(arguments[1].evaluate(e).numberValue()))},J.round=function(){var e=arguments[0];if(2!=arguments.length)throw new Error("Function round expects (number)");return new q(Math.round(arguments[1].evaluate(e).numberValue()))};var $=new Object;$.isAttribute=function(e){return e&&(2===e.nodeType||e.ownerElement)},$.splitQName=function(e){var t=e.indexOf(":");return-1==t?[null,e]:[e.substring(0,t),e.substring(t+1)]},$.resolveQName=function(e,t,r,s){var n=$.splitQName(e);return null!=n[0]?n[0]=t.getNamespace(n[0],r):s?(n[0]=t.getNamespace("",r),null==n[0]&&(n[0]="")):n[0]="",n},$.isSpace=function(e){return 9==e||13==e||10==e||32==e},$.isLetter=function(e){return e>=65&&e<=90||e>=97&&e<=122||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=255||e>=256&&e<=305||e>=308&&e<=318||e>=321&&e<=328||e>=330&&e<=382||e>=384&&e<=451||e>=461&&e<=496||e>=500&&e<=501||e>=506&&e<=535||e>=592&&e<=680||e>=699&&e<=705||902==e||e>=904&&e<=906||908==e||e>=910&&e<=929||e>=931&&e<=974||e>=976&&e<=982||986==e||988==e||990==e||992==e||e>=994&&e<=1011||e>=1025&&e<=1036||e>=1038&&e<=1103||e>=1105&&e<=1116||e>=1118&&e<=1153||e>=1168&&e<=1220||e>=1223&&e<=1224||e>=1227&&e<=1228||e>=1232&&e<=1259||e>=1262&&e<=1269||e>=1272&&e<=1273||e>=1329&&e<=1366||1369==e||e>=1377&&e<=1414||e>=1488&&e<=1514||e>=1520&&e<=1522||e>=1569&&e<=1594||e>=1601&&e<=1610||e>=1649&&e<=1719||e>=1722&&e<=1726||e>=1728&&e<=1742||e>=1744&&e<=1747||1749==e||e>=1765&&e<=1766||e>=2309&&e<=2361||2365==e||e>=2392&&e<=2401||e>=2437&&e<=2444||e>=2447&&e<=2448||e>=2451&&e<=2472||e>=2474&&e<=2480||2482==e||e>=2486&&e<=2489||e>=2524&&e<=2525||e>=2527&&e<=2529||e>=2544&&e<=2545||e>=2565&&e<=2570||e>=2575&&e<=2576||e>=2579&&e<=2600||e>=2602&&e<=2608||e>=2610&&e<=2611||e>=2613&&e<=2614||e>=2616&&e<=2617||e>=2649&&e<=2652||2654==e||e>=2674&&e<=2676||e>=2693&&e<=2699||2701==e||e>=2703&&e<=2705||e>=2707&&e<=2728||e>=2730&&e<=2736||e>=2738&&e<=2739||e>=2741&&e<=2745||2749==e||2784==e||e>=2821&&e<=2828||e>=2831&&e<=2832||e>=2835&&e<=2856||e>=2858&&e<=2864||e>=2866&&e<=2867||e>=2870&&e<=2873||2877==e||e>=2908&&e<=2909||e>=2911&&e<=2913||e>=2949&&e<=2954||e>=2958&&e<=2960||e>=2962&&e<=2965||e>=2969&&e<=2970||2972==e||e>=2974&&e<=2975||e>=2979&&e<=2980||e>=2984&&e<=2986||e>=2990&&e<=2997||e>=2999&&e<=3001||e>=3077&&e<=3084||e>=3086&&e<=3088||e>=3090&&e<=3112||e>=3114&&e<=3123||e>=3125&&e<=3129||e>=3168&&e<=3169||e>=3205&&e<=3212||e>=3214&&e<=3216||e>=3218&&e<=3240||e>=3242&&e<=3251||e>=3253&&e<=3257||3294==e||e>=3296&&e<=3297||e>=3333&&e<=3340||e>=3342&&e<=3344||e>=3346&&e<=3368||e>=3370&&e<=3385||e>=3424&&e<=3425||e>=3585&&e<=3630||3632==e||e>=3634&&e<=3635||e>=3648&&e<=3653||e>=3713&&e<=3714||3716==e||e>=3719&&e<=3720||3722==e||3725==e||e>=3732&&e<=3735||e>=3737&&e<=3743||e>=3745&&e<=3747||3749==e||3751==e||e>=3754&&e<=3755||e>=3757&&e<=3758||3760==e||e>=3762&&e<=3763||3773==e||e>=3776&&e<=3780||e>=3904&&e<=3911||e>=3913&&e<=3945||e>=4256&&e<=4293||e>=4304&&e<=4342||4352==e||e>=4354&&e<=4355||e>=4357&&e<=4359||4361==e||e>=4363&&e<=4364||e>=4366&&e<=4370||4412==e||4414==e||4416==e||4428==e||4430==e||4432==e||e>=4436&&e<=4437||4441==e||e>=4447&&e<=4449||4451==e||4453==e||4455==e||4457==e||e>=4461&&e<=4462||e>=4466&&e<=4467||4469==e||4510==e||4520==e||4523==e||e>=4526&&e<=4527||e>=4535&&e<=4536||4538==e||e>=4540&&e<=4546||4587==e||4592==e||4601==e||e>=7680&&e<=7835||e>=7840&&e<=7929||e>=7936&&e<=7957||e>=7960&&e<=7965||e>=7968&&e<=8005||e>=8008&&e<=8013||e>=8016&&e<=8023||8025==e||8027==e||8029==e||e>=8031&&e<=8061||e>=8064&&e<=8116||e>=8118&&e<=8124||8126==e||e>=8130&&e<=8132||e>=8134&&e<=8140||e>=8144&&e<=8147||e>=8150&&e<=8155||e>=8160&&e<=8172||e>=8178&&e<=8180||e>=8182&&e<=8188||8486==e||e>=8490&&e<=8491||8494==e||e>=8576&&e<=8578||e>=12353&&e<=12436||e>=12449&&e<=12538||e>=12549&&e<=12588||e>=44032&&e<=55203||e>=19968&&e<=40869||12295==e||e>=12321&&e<=12329},$.isNCNameChar=function(e){return e>=48&&e<=57||e>=1632&&e<=1641||e>=1776&&e<=1785||e>=2406&&e<=2415||e>=2534&&e<=2543||e>=2662&&e<=2671||e>=2790&&e<=2799||e>=2918&&e<=2927||e>=3047&&e<=3055||e>=3174&&e<=3183||e>=3302&&e<=3311||e>=3430&&e<=3439||e>=3664&&e<=3673||e>=3792&&e<=3801||e>=3872&&e<=3881||46==e||45==e||95==e||$.isLetter(e)||e>=768&&e<=837||e>=864&&e<=865||e>=1155&&e<=1158||e>=1425&&e<=1441||e>=1443&&e<=1465||e>=1467&&e<=1469||1471==e||e>=1473&&e<=1474||1476==e||e>=1611&&e<=1618||1648==e||e>=1750&&e<=1756||e>=1757&&e<=1759||e>=1760&&e<=1764||e>=1767&&e<=1768||e>=1770&&e<=1773||e>=2305&&e<=2307||2364==e||e>=2366&&e<=2380||2381==e||e>=2385&&e<=2388||e>=2402&&e<=2403||e>=2433&&e<=2435||2492==e||2494==e||2495==e||e>=2496&&e<=2500||e>=2503&&e<=2504||e>=2507&&e<=2509||2519==e||e>=2530&&e<=2531||2562==e||2620==e||2622==e||2623==e||e>=2624&&e<=2626||e>=2631&&e<=2632||e>=2635&&e<=2637||e>=2672&&e<=2673||e>=2689&&e<=2691||2748==e||e>=2750&&e<=2757||e>=2759&&e<=2761||e>=2763&&e<=2765||e>=2817&&e<=2819||2876==e||e>=2878&&e<=2883||e>=2887&&e<=2888||e>=2891&&e<=2893||e>=2902&&e<=2903||e>=2946&&e<=2947||e>=3006&&e<=3010||e>=3014&&e<=3016||e>=3018&&e<=3021||3031==e||e>=3073&&e<=3075||e>=3134&&e<=3140||e>=3142&&e<=3144||e>=3146&&e<=3149||e>=3157&&e<=3158||e>=3202&&e<=3203||e>=3262&&e<=3268||e>=3270&&e<=3272||e>=3274&&e<=3277||e>=3285&&e<=3286||e>=3330&&e<=3331||e>=3390&&e<=3395||e>=3398&&e<=3400||e>=3402&&e<=3405||3415==e||3633==e||e>=3636&&e<=3642||e>=3655&&e<=3662||3761==e||e>=3764&&e<=3769||e>=3771&&e<=3772||e>=3784&&e<=3789||e>=3864&&e<=3865||3893==e||3895==e||3897==e||3902==e||3903==e||e>=3953&&e<=3972||e>=3974&&e<=3979||e>=3984&&e<=3989||3991==e||e>=3993&&e<=4013||e>=4017&&e<=4023||4025==e||e>=8400&&e<=8412||8417==e||e>=12330&&e<=12335||12441==e||12442==e||183==e||720==e||721==e||903==e||1600==e||3654==e||3782==e||12293==e||e>=12337&&e<=12341||e>=12445&&e<=12446||e>=12540&&e<=12542},$.coalesceText=function(e){for(var t=e.firstChild;null!=t;t=t.nextSibling)if(3==t.nodeType||4==t.nodeType){var r=t.nodeValue,s=t;for(t=t.nextSibling;null!=t&&(3==t.nodeType||4==t.nodeType);){r+=t.nodeValue;var n=t;t=t.nextSibling,n.parentNode.removeChild(n)}if(4==s.nodeType){var i=s.parentNode;if(null==s.nextSibling)i.removeChild(s),i.appendChild(i.ownerDocument.createTextNode(r));else{var o=s.nextSibling;i.removeChild(s),i.insertBefore(i.ownerDocument.createTextNode(r),o)}}else s.nodeValue=r;if(null==t)break}else 1==t.nodeType&&$.coalesceText(t)},$.instance_of=function(e,t){for(;null!=e;){if(e.constructor===t)return!0;if(e===Object)return!1;e=e.constructor.superclass}return!1},$.getElementById=function(e,t){if(1==e.nodeType&&(e.getAttribute("id")==t||e.getAttributeNS(null,"id")==t))return e;for(var r=e.firstChild;null!=r;r=r.nextSibling){var s=$.getElementById(r,t);if(null!=s)return s}return null};var Q=function(){function e(t,r,s){var n=Error.call(this,function(t,r){var s=r?": "+r.toString():"";switch(t){case e.INVALID_EXPRESSION_ERR:return"Invalid expression"+s;case e.TYPE_ERR:return"Type error"+s}return null}(t,r)||s);return n.code=t,n.exception=r,n}return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e.superclass=Error,e.prototype.toString=function(){return this.message},e.fromMessage=function(t,r){return new e(null,r,t)},e.INVALID_EXPRESSION_ERR=51,e.TYPE_ERR=52,e}();function Z(e,t,r){this.xpath=r.parse(e),this.context=new z,this.context.namespaceResolver=new ee(t)}function ee(e){this.xpathNSResolver=e}function te(e){this.node=e,this.namespaceResolver=new Y}function re(e,t){switch(t==re.ANY_TYPE&&(e.constructor===M?t=re.STRING_TYPE:e.constructor===q?t=re.NUMBER_TYPE:e.constructor===H?t=re.BOOLEAN_TYPE:e.constructor===W&&(t=re.UNORDERED_NODE_ITERATOR_TYPE)),this.resultType=t,t){case re.NUMBER_TYPE:return void(this.numberValue=e.numberValue());case re.STRING_TYPE:return void(this.stringValue=e.stringValue());case re.BOOLEAN_TYPE:return void(this.booleanValue=e.booleanValue());case re.ANY_UNORDERED_NODE_TYPE:case re.FIRST_ORDERED_NODE_TYPE:if(e.constructor===W)return void(this.singleNodeValue=e.first());break;case re.UNORDERED_NODE_ITERATOR_TYPE:case re.ORDERED_NODE_ITERATOR_TYPE:if(e.constructor===W)return this.invalidIteratorState=!1,this.nodes=e.toArray(),void(this.iteratorIndex=0);break;case re.UNORDERED_NODE_SNAPSHOT_TYPE:case re.ORDERED_NODE_SNAPSHOT_TYPE:if(e.constructor===W)return this.nodes=e.toArray(),void(this.snapshotLength=this.nodes.length)}throw new Q(Q.TYPE_ERR)}function se(e,t){e.createExpression=function(e,r){try{return new Z(e,r,t)}catch(e){throw new Q(Q.INVALID_EXPRESSION_ERR,e)}},e.createNSResolver=function(e){return new te(e)},e.evaluate=function(r,s,n,i,o){if(i<0||i>9)throw{code:0,toString:function(){return"Request type not supported"}};return e.createExpression(r,n,t).evaluate(s,i,o)}}Z.prototype={},Z.prototype.constructor=Z,Z.superclass=Object.prototype,Z.getOwnerDocument=function(e){return 9===e.nodeType?e:e.ownerDocument},Z.detectHtmlDom=function(e){if(!e)return!1;var t=Z.getOwnerDocument(e);try{return t.implementation.hasFeature("HTML","2.0")}catch(e){return!0}},Z.prototype.evaluate=function(e,t,r){return this.context.expressionContextNode=e,this.context.caseInsensitive=Z.detectHtmlDom(e),new re(this.xpath.evaluate(this.context),t)},ee.prototype={},ee.prototype.constructor=ee,ee.superclass=Object.prototype,ee.prototype.getNamespace=function(e,t){return null==this.xpathNSResolver?null:this.xpathNSResolver.lookupNamespaceURI(e)},te.prototype={},te.prototype.constructor=te,te.superclass=Object.prototype,te.prototype.lookupNamespaceURI=function(e){return this.namespaceResolver.getNamespace(e,this.node)},re.prototype={},re.prototype.constructor=re,re.superclass=Object.prototype,re.prototype.iterateNext=function(){if(this.resultType!=re.UNORDERED_NODE_ITERATOR_TYPE&&this.resultType!=re.ORDERED_NODE_ITERATOR_TYPE)throw new Q(Q.TYPE_ERR);return this.nodes[this.iteratorIndex++]},re.prototype.snapshotItem=function(e){if(this.resultType!=re.UNORDERED_NODE_SNAPSHOT_TYPE&&this.resultType!=re.ORDERED_NODE_SNAPSHOT_TYPE)throw new Q(Q.TYPE_ERR);return this.nodes[e]},re.ANY_TYPE=0,re.NUMBER_TYPE=1,re.STRING_TYPE=2,re.BOOLEAN_TYPE=3,re.UNORDERED_NODE_ITERATOR_TYPE=4,re.ORDERED_NODE_ITERATOR_TYPE=5,re.UNORDERED_NODE_SNAPSHOT_TYPE=6,re.ORDERED_NODE_SNAPSHOT_TYPE=7,re.ANY_UNORDERED_NODE_TYPE=8,re.FIRST_ORDERED_NODE_TYPE=9;try{var ne=!0;try{document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("XPath",null)&&(ne=!1)}catch(e){}ne&&se(document,new l)}catch(e){}se(e,new l),function(){var t=new l,r=new Y,s=new K,n=new X;function i(e){return{getNamespace:function(t,s){return e(t,s)||r.getNamespace(t,s)}}}function o(e){if(null==e||e instanceof M||e instanceof H||e instanceof q||e instanceof W)return e;switch(typeof e){case"string":return new M(e);case"boolean":return new H(e);case"number":return new q(e)}var t=new W;return t.addArray([].concat(e)),t}function a(e){return{getFunction:function(t,r){var n=e(t,r);return n?function(e){return function(t){var r=Array.prototype.slice.call(arguments,1).map((function(e){return e.evaluate(t)}));return o(e.apply(this,[].concat(t,r)))}}(n):s.getFunction(t,r)}}}function h(e){return{getVariable:function(t,r){return o(e(t,r))}}}function c(e,t,r){e in r&&(t[e]=r[e])}function u(e){var t,o,l=new z;return e?(l.namespaceResolver=(t=e.namespaces)&&"function"==typeof t.getNamespace?i((o=t).getNamespace.bind(o)):"function"==typeof t?i(t):"object"==typeof t?function(e){return i((function(t){return e[t]}))}(t):r,l.functionResolver=function(e){return e&&"function"==typeof e.getFunction?a((t=e).getFunction.bind(t)):"function"==typeof e?a(e):"object"==typeof e?function(e){return a((function(t){return e[t]}))}(e):s;var t}(e.functions),l.variableResolver=function(e){if(e){if("function"==typeof e.getVariable)return h(e.getVariable.bind(e));if("function"==typeof e)return h(e);if("object"==typeof e)return h((function(t){return e[t]}))}return n}(e.variables),l.expressionContextNode=e.node,c("allowAnyNamespaceForNoPrefix",l,e),c("isHtml",l,e)):l.namespaceResolver=r,l}var p={evaluate:function(e){return function(e,t){var r=u(t);return e.evaluate(r)}(this.expression,e)},evaluateNumber:function(e){return this.evaluate(e).numberValue()},evaluateString:function(e){return this.evaluate(e).stringValue()},evaluateBoolean:function(e){return this.evaluate(e).booleanValue()},evaluateNodeSet:function(e){return this.evaluate(e).nodeset()},select:function(e){return this.evaluateNodeSet(e).toArray()},select1:function(e){return this.select(e)[0]}};e.parse=function(e){var r=t.parse(e);return Object.create(p,{expression:{value:r}})}}(),h(e,{XPath:c,XPathParser:l,XPathResult:re,Step:L,PathExpr:P,NodeTest:I,LocationPath:j,OrOperation:m,AndOperation:_,BarOperation:C,EqualsOperation:v,NotEqualOperation:y,LessThanOperation:b,GreaterThanOperation:w,LessThanOrEqualOperation:O,GreaterThanOrEqualOperation:S,PlusOperation:E,MinusOperation:x,MultiplyOperation:N,DivOperation:A,ModOperation:T,UnaryMinusOperation:f,FunctionCall:U,VariableReference:F,XPathContext:z,XNodeSet:W,XBoolean:H,XString:M,XNumber:q,NamespaceResolver:Y,FunctionResolver:K,VariableResolver:X,Utilities:$}),e.select=function(t,r,s){return e.selectWithResolver(t,r,null,s)},e.useNamespaces=function(t){var r={mappings:t||{},lookupNamespaceURI:function(e){return this.mappings[e]}};return function(t,s,n){return e.selectWithResolver(t,s,r,n)}},e.selectWithResolver=function(e,t,r,s){var n=new Z(e,r,new l),i=re.ANY_TYPE,o=n.evaluate(t,i,null);return o.resultType==re.STRING_TYPE?o=o.stringValue:o.resultType==re.NUMBER_TYPE?o=o.numberValue:o.resultType==re.BOOLEAN_TYPE?o=o.booleanValue:(o=o.nodes,s&&(o=o[0])),o},e.select1=function(t,r){return e.select(t,r,!0)}}(t)},9727:(e,t,r)=>{e.exports={EventTarget:r(6341),Event:r(1897)}},1897:e=>{e.exports=function(e){this.type=e,this.isTrusted=!1,this._yaeti=!0}},6341:e=>{function t(){"function"!=typeof this.addEventListener&&(this._listeners={},this.addEventListener=r,this.removeEventListener=s,this.dispatchEvent=n)}function r(e,t){var r,s,n;if(e&&t){for(void 0===(r=this._listeners[e])&&(this._listeners[e]=r=[]),s=0;n=r[s];s++)if(n===t)return;r.push(t)}}function s(e,t){var r,s,n;if(e&&t&&void 0!==(r=this._listeners[e])){for(s=0;n=r[s];s++)if(n===t){r.splice(s,1);break}0===r.length&&delete this._listeners[e]}}function n(e){var t,r,s,n,i,o=!1;if(!e||"string"!=typeof e.type)throw new Error("`event` must have a valid `type` property");e._yaeti&&(e.target=this,e.cancelable=!0);try{e.stopImmediatePropagation=function(){o=!0}}catch(e){}for(t=e.type,r=this._listeners[t]||[],"function"==typeof(s=this["on"+t])&&s.call(this,e),n=0;(i=r[n])&&!o;n++)i.call(this,e);return!e.defaultPrevented}e.exports=t,Object.defineProperties(t.prototype,{listeners:{get:function(){return this._listeners}}})},8881:(e,t,r)=>{"use strict";r.r(t),r.d(t,{api:()=>ye});class n{constructor(e){this._options={},this.setOpts(e)}get numOpts(){return Object.keys(this._options).length}get keys(){var e=[];for(var t in this._options)e.push(t);return e}setOpts(e){if(null!=e){var t=e;for(var r in"string"==typeof e&&(t=JSON.parse(e)),t)this.setOpt(r,t[r])}}getOpts(){return this._options}hasOpt(e){var t=e.toLowerCase();return this._options.hasOwnProperty(t)}hasOpts(e){var t=!0;for(var r of e)0==this.hasOpt(r)&&(t=!1);return t}getOpt(e,t){var r=null,s=e.toLowerCase();return this._options.hasOwnProperty(s)&&(r=this._options[s]),null==r&&null!=t&&(r=t),r}getOptAndClear(e,t){var r=this.getOpt(e,t);return this.clearOpt(e),r}getInt(e,t){var r=0,s=this.getOpt(e,t);return null!=s&&(r=parseInt(s)),r}getArray(e,t){var r=null,s=this.getOpt(e,t);return null!=s&&Array.isArray(s)&&(r=s),r}setOpt(e,t){var r=e.toLowerCase();null==t?this._options.hasOwnProperty(r)&&(delete this._options[r],this.optionCleared(r,t)):(this._options[r]=t,this.optionSet(r,t))}clearOpt(e){var t=e.toLowerCase();this._options.hasOwnProperty(t)&&(delete this._options[t],this.optionCleared(t))}clearOpts(e){for(var t of e)this.clearOpt(t)}reset(){this._options={}}addOpts(e,t){if(null!=t)t.forEach((t=>{this._options.hasOwnProperty(t)&&(e[t]=this._options[t])}));else for(var r in this._options)e[r]=this._options[r]}optionSet(){}optionCleared(){}resolve(e){for(var t in this._options){var r=new RegExp("@"+t+"@","g");e=e.replace(r,this._options[t])}return e}clone(e){var t={};return this.addOpts(t,e),t}toString(){return JSON.stringify(this._options)}}var a=!1;"object"==typeof process&&process.hasOwnProperty("versions")&&process.versions.hasOwnProperty("node")&&(a=!0);class h{constructor(e,t,r){this._a=[],this._lower=parseFloat(e)-.01,this._upper=parseFloat(t)+.01,this._num=parseFloat(r),this._interval=(this._upper-this._lower)/this._num,Object.defineProperty(this,"lower",{get(){return this._lower}}),Object.defineProperty(this,"upper",{get(){return this._upper}}),Object.defineProperty(this,"interval",{get(){return this._interval}});for(var s=new Number(this._lower),n=0;n<this._num+1;n++)this._a.push(s),s+=this._interval;Object.defineProperty(this,"length",{get(){return this._a.length}})}index(e){for(var t=-1,r=0;r<this._a.length-1;r++)if(e>=this._a[r]&&e<=this._a[r+1]){t=r;break}return t}createSteps(e){for(var t,r,s=[],n=0;n<this._a.length-1;n++)t=parseFloat(this._a[n]),r=parseFloat(this._a[n+1]),s.push({range:[t,r],color:e[n]});return s}toString(){return JSON.stringify(this._a)}}class l{constructor(){this._items=[],this._running=!1}add(e){0==c.supports(e,"run")&&c.exception("The timer entry must implement the run method"),0==c.supports(e,"getInterval")&&c.exception("The timer entry must implement the getInterval method"),e._fired=0,Object.defineProperty(e,"fired",{get(){return this._fired},set(e){this._fired=e}}),this._items.push(e)}start(){this._running=!0;var e=this;setTimeout((function(){e.run()}),1e3)}stop(){this._running=!1}run(){var e=new Date,t=[],r=1e3;if(this._items.forEach((s=>{var n=e.getTime()-s.fired,i=s.getInterval();n>i?(i<r&&(r=i),t.push(s)):(n=e.getTime()-s.fired+i)<r&&(r=n)})),t.forEach((e=>{e.run()})),this._running){var s=this;setTimeout((function(){s.run()}),r)}}}var c={s4:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},guid:function(){return(this.s4()+this.s4()+"-"+this.s4()+"-4"+this.s4().substr(0,3)+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()).toLowerCase()},supports:function(e,t){return null!=e&&t in e&&"function"==typeof e[t]},contains:function(e,t){if(null!=e)for(var r=0;r<e.length;r++)if(e[r]==t)return!0;return!1},indexOf:function(e,t){if(null!=e)for(var r=0;r<e.length;r++)if(e[r]==t)return r;return-1},addTo:function(e,t){return 0==this.contains(e,t)&&(e.push(t),!0)},setItem:function(e,t){for(var r=null,s=0;s<e.length;s++)if(e[s]==t){r=e[s];break}if(null==r)r=t,e.push(t);else for(var n in t)r[n]=t[n];return r},removeFrom:function(e,t){var r=this.indexOf(e,t);return r>=0&&(e.splice(r,1),!0)},createRange:function(e,t,r){return new h(e,t,r)},createTimer:function(){return new l},createUrl:function(e){var t={},r=a?new URL(e):new URL(e,document.URL);return t.protocol=r.protocol,"http"!=r.protocol&&(r.protocol="http",r=new URL(r.toString())),t.host=r.hostname,t.port=r.port,t.path=r.pathname,t.secure="https:"==t.protocol||"wss:"==t.protocol,t.toString=function(){return this.protocol+"//"+this.host+":"+this.port+this.path},t},reverse:function(e){for(var t=[],r=e.length-1;r>=0;r--)t.push(e[r]);return t},createBuffer:function(e){for(var t=new DataView(new ArrayBuffer(e.length)),r=0;r<e.length;r++)t.setUint8(r,e.charCodeAt(r));return t.buffer},bufferToArrayBuffer:function(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),s=0;s<e.length;s++)r[s]=e[s];return t},stringFromBytes:function(e){var t="";return e.forEach((e=>{t+=String.fromCharCode(e)})),t},stringFromArrayBuffer:function(e){for(var t="",r=new DataView(e),s=0;s<e.byteLength;s++)t+=String.fromCharCode(r.getUint8(s));return t},bytesFromString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(e.charCodeAt(r));return t},createWebSocket:function(e,t){var r=null;return a?"ws"==process.env.NODE_WEBSOCKETS?(r=new(require("ws"))(e),this.supports(t,"open")&&r.on("open",t.open),this.supports(t,"close")&&r.on("close",t.close),this.supports(t,"error")&&r.on("error",t.error),this.supports(t,"message")&&r.on("message",t.message)):(r=new(0,require("websocket").w3cwebsocket)(e),this.supports(t,"open")&&(r.onopen=t.open),this.supports(t,"close")&&(r.onclose=t.close),this.supports(t,"error")&&(r.onerror=t.error),this.supports(t,"message")&&(r.onmessage=t.message)):(r=new WebSocket(e),this.supports(t,"open")&&(r.onopen=t.open),this.supports(t,"close")&&(r.onclose=t.close),this.supports(t,"error")&&(r.onerror=t.error),this.supports(t,"message")&&(r.onmessage=t.message)),r},createDataFromCsv:function(e,t){var r,s,i,o,a,h,l=new n(t),c=[],u=e.split("\n"),p=null,d=null,f=0,g=0;for(l.hasOpt("fields")?d=l.getOpt("fields"):l.getOpt("header",!1)&&(p=(a=u[g].trim()).split(","),g++);g<u.length;)if(0!=(a=u[g].trim()).length){r=[],i="";for(var m=0;m<a.length;m++)","==(o=a[m])?f>0?i+=o:(r.push(i),i=""):'"'==o?"\\"==s?i+=o:f^=1:"\\"==o?"\\"==s&&(i+=o):i+=o,s=o;if(i.length>0&&r.push(i),null!=d){h={};for(var _=0;_<r.length;_++)d.hasOwnProperty(_)&&(h[d[_]]=r[_])}else if(null!=p)for(h={},_=0;_<r.length;_++)h[p[_]]=r[_];else h=r;c.push(h),g++}else g++;return c},formatDate:function(e,t){var r,s,n;s="";for(var i=0;i<t.length;i++)"%"==(n=t[i])?i<t.length-1&&("m"==(r=t[++i])?s+=e.getUTCMonth():"d"==r||"e"==r?s+=e.getUTCDate():"Y"==r?s+=e.getFullYear():"%"==r&&(s+="%")):s+=n;return s},b64Encode:function(e){return a?Buffer.from(e).toString("base64"):btoa(e)},b64Decode:function(e){return a?Buffer.from(e,"base64"):atob(e)},stringify:function(e){var t=JSON.parse(JSON.stringify(e,((e,t)=>"bigint"==typeof t?t.toString():t)));return JSON.stringify(t,null,"    ")},createCommandLineOpts:function(){for(var e,t=new n,r=null,s=null,i=2;i<process.argv.length;i++)if(e=process.argv[i],null!=s)s.length>0&&(s+=" "),s+=e;else{if("--"==e){s="";continue}e.startsWith("--")?(null!=r&&t.setOpt(r,!0),r=e.substr(2)):null!=r&&(t.setOpt(r,this.createValue(e)),r=null)}return null!=s&&t.setOpt("_end",s),null!=r&&t.setOpt(r,!0),t},createValue:function(e){var t=e;return 0==e.indexOf("[")&&e.lastIndexOf("]")==e.length-1?t=e=(e=e.substr(1,e.length-2)).split(","):0==e.indexOf("{")&&e.lastIndexOf("}")==e.length-1?t=JSON.parse(e):"true"==e?t=!0:"false"==e&&(t=!1),t},getBorders:function(e,t){var r={left:0,top:0,right:0,bottom:0};if(Object.defineProperty(r,"hsize",{get(){return this.left+this.right}}),Object.defineProperty(r,"vsize",{get(){return this.top+this.bottom}}),null==e||"none"==e.style.display)return r;var s=window.getComputedStyle(e,null);return r.left=parseInt(s.getPropertyValue("border-left-width")),r.top=parseInt(s.getPropertyValue("border-top-width")),r.right=parseInt(s.getPropertyValue("border-right-width")),r.bottom=parseInt(s.getPropertyValue("border-bottom-width")),t&&(r.left+=parseInt(s.getPropertyValue("padding-left")),r.top+=parseInt(s.getPropertyValue("padding-top")),r.right+=parseInt(s.getPropertyValue("padding-right")),r.bottom+=parseInt(s.getPropertyValue("padding-bottom"))),isNaN(r.left)&&(r.left=0),isNaN(r.top)&&(r.top=0),isNaN(r.right)&&(r.right=0),isNaN(r.bottom)&&(r.bottom=0),r},getMargins:function(e){var t={left:0,top:0,right:0,bottom:0};if(null==e||"none"==e.style.display)return t;var r=window.getComputedStyle(e,null);return t.left=parseInt(r.marginLeft),t.top=parseInt(r.marginTop),t.right=parseInt(r.marginRight),t.bottom=parseInt(r.marginBottom),isNaN(t.left)&&(t.left=0),isNaN(t.top)&&(t.top=0),isNaN(t.right)&&(t.right=0),isNaN(t.bottom)&&(t.bottom=0),t},getPadding:function(e){var t={left:0,top:0,right:0,bottom:0};if(Object.defineProperty(t,"hsize",{get(){return this.left+this.right}}),Object.defineProperty(t,"vsize",{get(){return this.top+this.bottom}}),null==e||"none"==e.style.display)return t;var r=window.getComputedStyle(e,null);return t.left+=parseInt(r.getPropertyValue("padding-left")),t.top+=parseInt(r.getPropertyValue("padding-top")),t.right+=parseInt(r.getPropertyValue("padding-right")),t.bottom+=parseInt(r.getPropertyValue("padding-bottom")),t},getOffset:function(e){var t=new Object;t._x=0,t._y=0,t._parentX=-1,t._parentY=-1,t._width=0,t._height=0;var r=e;for(null!=e.firstChild&&1==e.firstChild.nodeType&&(r=e.firstChild);null!=r;)t._x+=r.offsetLeft,t._y+=r.offsetTop,-1==t._parentX&&(t._parentX=r.offsetLeft,t._parentY=r.offsetTop),t._x-=r.scrollLeft,t._y-=r.scrollTop,r=r.offsetParent;return t._width=e.offsetWidth,t._height=e.offsetHeight,t.right=function(){return this._x+this._width},t.bottom=function(){return this._y+this._height},t},getCbState:function(e){var t="string"==typeof e?document.getElementById(e):e,r=!1;if(null!=t){var s=t.firstChild;0==s.disabled&&(r=s.checked)}return r},setCbState:function(e,t){var r="string"==typeof e?document.getElementById(e):e,s=!1;if(null!=r){var n=r.firstChild;t.hasOwnProperty("checked")&&(n.checked=t.checked),t.hasOwnProperty("enabled")&&(t.enabled?(r.style.opacity=1,n.disabled=!1,s=n.checked):(r.style.opacity=.3,n.disabled=!0))}return s},setLinkState:function(e,t){var r="string"==typeof e?document.getElementById(e):e;return null!=r&&(0==r.hasOwnProperty("_enabled")&&(r._enabled=!0,r._href=r.href),t?(r.href=r._href,r.style.opacity=1,r.style.cursor="pointer"):(r.href="#",r.style.opacity=.3,r.style.cursor="default")),t},exception:function(e){throw a?new Error(e):e}};String.prototype.splitNoSpaces=function(){return this.split(" ").filter((function(e){return e}))},String.prototype.pad=function(e,t){for(var r="",s=0;s<e-this.length;s++)r+=t;return r+this},Object.defineProperty(c,"isNode",{get:()=>a});class u{constructor(e){this._size=2*this.size(e),this._data=new ArrayBuffer(this._size),this._view=new DataView(this._data),this._index=0,this._debug=!1,Object.defineProperty(this,"data",{get(){return this._data}}),this.encode(e)}encode(e,t){if(e instanceof Object)if(Array.isArray(e))this.writeName(t),this.beginArray(),e.forEach((e=>{this.encode(e)})),this.endArray();else if(e instanceof ArrayBuffer)this.writeBuffer(e,t);else{for(var r in this.writeName(t),this.beginObject(),e)this.encode(e[r],r);this.endObject()}else this.writeValue(e,t)}writeValue(e,t){var r=typeof e;"string"==r?this.writeString(e,t):"number"==r?this.writeI32(e,t):"bigint"==r?this.writeI64(e,t):"boolean"==r&&this.writeString(e?"true":"false",t)}writeString(e,t){if(this.writeName(t),this.writeType("S"),this.writeLength(e.length),this._debug){var r=e.length>50?e.substr(0,20)+"...":e;console.log("index: "+this._index+" write string: "+r)}for(var s=0;s<e.length;s++)this._view.setUint8(this._index,e.charCodeAt(s)),this._index++}writeI32(e,t){this.writeName(t),this.writeType("l"),this._debug&&console.log("index: "+this._index+" write i32: "+e),this._view.setInt32(this._index,e),this._index+=4}writeI64(e,t){this.writeName(t),this.writeType("L"),this._debug&&console.log("index: "+this._index+" write i64: "+e),this._view.setBigInt64(this._index,e),this._index+=8}writeBuffer(e,t){this.writeName(t),this.writeType("B"),this.writeLength(e.byteLength);for(var r=new DataView(e),s=0;s<e.byteLength;s++)this._view.setUint8(this._index,r.getUint8(s)),this._index++}writeName(e){if(null!=e&&e.length>0){this.writeLength(e.length),this._debug&&console.log("index: "+this._index+" write name: "+e);for(var t=0;t<e.length;t++)this._view.setUint8(this._index,e.charCodeAt(t)),this._index++}}writeType(e){this._debug&&console.log("index: "+this._index+" write type: "+e),this._view.setUint8(this._index,e.charCodeAt()),this._index++}writeLength(e){this._debug&&console.log("index: "+this._index+" write length: "+e),this._view.setUint32(this._index,e),this._index+=4}beginObject(){this.writeType("{")}endObject(){this.writeType("}")}beginArray(){this.writeType("[")}endArray(){this.writeType("]")}size(e){var t=0,r=typeof e;if("string"==r)t=2*e.length;else if("number"==r)t=8;else if("bigint"==r)t=8;else if("boolean"==r)t=4;else if("object"==r)if(e instanceof ArrayBuffer)t=e.byteLength;else for(var s in e)t+=this.size(e[s]);else{if("array"!=r)throw"unknown type: "+r;e.forEach((e=>{t+=this.size(e)}))}return t+=5}dump(){for(var e,t=0,r=0;r<this._data.byteLength&&("{"==(e=String.fromCharCode(this._view.getUint8(r)))&&t++,console.log(r+" :: "+this._view.getUint8(r)+" ::: "+e),"}"!=e||0!=--t);r++);}}class p{constructor(e){this._data=new DataView(e,0),this._size=this._data.buffer.byteLength,this._index=0,this._o=null,this._debug=!1,this.addTo()}addTo(e,t){var r=this.getType(!0);"{"==r?this.addObject(e,t):"["==r?this.addArray(e,t):this.addValue(e,t)}addObject(e,t){this._debug&&console.log("index: "+this._index+" add object: "+e+" to "+t);var r,s,n={};for(null==this._o?this._o=n:Array.isArray(t)?t.push(n):t[e]=n;this._index<this._size;){if("}"==this.getType(!1)){this._index++;break}r=this.getLength(),e=this.getString(r),"{"==(s=this.getType())||"["==s?this.addTo(e,n):this.addValue(e,n)}this._debug&&console.log("index: "+this._index+" add object: "+e+" to "+t+" complete")}addArray(e,t){this._debug&&console.log("index: "+this._index+" add array: "+e+" to "+t);var r,s=[];for(null==this._o?this._o=s:Array.isArray(t)?t.push(s):t[e]=s;this._index<this._size;)if("["==(r=this.getType(!1)))this.addTo("",s);else{if("]"==r){this._index++;break}"{"==r?this.addTo("",s):this.addValue("",s)}this._debug&&console.log("index: "+this._index+" add array: "+e+" to "+t+" complete")}addValue(e,t){this._debug&&console.log("index: "+this._index+" add value: "+e+" to "+t);var r=this.getType(!0),s=null;if("S"==r)(n=this.getLength())>0&&(this._debug&&console.log("index: "+this._index+" get string of "+n+" bytes"),s=new Uint8Array(this._data.buffer,this._index,n).reduce((function(e,t){return e+String.fromCharCode(t)}),""),this._index+=n);else if("B"==r){var n;(n=this.getLength())>0&&(this._debug&&console.log("index: "+this._index+" get blob of "+n+" bytes"),s=new Uint8Array(this._data.buffer,this._index,n),s=null!=c.isNode?Buffer.from(s).toString("base64"):btoa(s.reduce((function(e,t){return e+String.fromCharCode(t)}),"")),this._index+=n)}else"l"==r?s=this.getI32():"L"==r?s=this.getI64():"D"==r&&(s=this.getDouble());null!=s&&(Array.isArray(t)?t.push(s):t[e]=s)}getType(e){var t=String.fromCharCode(this._data.getInt8(this._index));return this._debug&&console.log("index: "+this._index+" get type: "+t),e&&this._index++,t}getLength(){var e=this._data.getInt32(this._index);return this._debug&&console.log("index: "+this._index+" get length: "+e),this._index+=4,e}getString(e){var t=String.fromCharCode.apply(null,new Uint8Array(this._data.buffer,this._index,e));return this._debug&&console.log("index: "+this._index+" get string: "+t),this._index+=e,t}getI32(){var e=this._data.getInt32(this._index);return this._debug&&console.log("index: "+this._index+" get i32: "+e),this._index+=4,e}getI64(){var e=this._data.getBigInt64(this._index);return this._debug&&console.log("index: "+this._index+" get i64: "+e),this._index+=8,e}getDouble(){var e=this._data.getFloat64(this._index);return this._debug&&console.log("index: "+this._index+" get double: "+e),this._index+=8,e}}var f=function(e){return new u(e).data},g=function(e){return(e=new p(e))._o},m=null,_=null,v=null,y=null;c.isNode&&("ws"==process.env.NODE_WEBSOCKETS?v={open:function(e){var t=this._connection;null!=t&&(t._websocket=this,t._ready=!0,t.ready())},close:function(e){var t=this._connection;null!=t&&(t.clear(),t.closed())},error:function(e){var t=this._connection;null!=t&&(console.log(t.getUrl()+": "+e),t.clear(),t.error())},message:function(e){var t=this._connection;if(null!=t)if("string"==typeof e)t.message(e);else{for(var r=new ArrayBuffer(e.length),s=new Uint8Array(r),n=0;n<e.length;++n)s[n]=e[n];var i=g(r);t.data(i)}},data:function(e){var t=this._connection;if(null!=t){var r=Buffer.alloc(0);e.on("readable",(function(){var t=e.read();null!=t&&(r=Buffer.concat([r,t],r.length+t.length))})),e.on("end",(function(){for(var e=new ArrayBuffer(r.length),s=new Uint8Array(e),n=0;n<r.length;++n)s[n]=r[n];var i=g(e);t.data(i)}))}}}:y={open:function(){var e=this._conn;null!=e&&(e._websocket=this,e._ready=!0,e.ready())},close:function(e){var t=this._conn;null!=t&&(t.clear(),t.closed())},error:function(e){var t=this._conn;null!=t&&(t.clear(),t.error())},message:function(e){var t=this._conn;if(null!=t)if("string"==typeof e.data)t.message(e.data);else{var r=g(e.data);t.data(r)}}});var b={_established:new Object,open:function(e){var t=this._connection;null!=t&&(b._established[t.getUrl()]=!0,t._websocket=this,t._ready=!0,t.ready())},close:function(e){var t=this._connection;null!=t&&(t.clear(),t.closed())},error:function(e){var t=this._connection;null!=t&&(t.clear(),t.error())},message:function(e){var t=this._connection;if(null!=t)if(e.data instanceof ArrayBuffer||e.data instanceof Blob){var r=new FileReader;r.onload=function(e){var r=g(e.target.result);t.data(r)},r.readAsArrayBuffer(e.data)}else t.message(e.data)},prompted:function(e){return this._prompted.hasOwnProperty(e)}};class w extends n{constructor(e,t,r,s,n,i){super(n),this._host=e,this._port=new Number(t),this._path=r,this._secure=s,this._config=i,0==this._port&&(this._port=this._secure?443:80),this._reconnect={interval:5,attempts:0,timestamp:0,timer:null},this._websocket=null,Object.defineProperty(this,"websocket",{get(){return this._websocket}}),Object.defineProperty(this,"protocol",{get(){return this._secure?"wss":"ws"}}),Object.defineProperty(this,"httpProtocol",{get(){return this._secure?"https":"http"}}),Object.defineProperty(this,"host",{get(){return this._host}}),Object.defineProperty(this,"port",{get(){return this._port}}),Object.defineProperty(this,"path",{get(){return this._path}}),Object.defineProperty(this,"isSecure",{get(){return this._secure}}),Object.defineProperty(this,"parms",{get(){var e="",t=this.getOpts();for(var r in t)e.length>0&&(e+="&"),e+=r+"="+t[r];return e}}),Object.defineProperty(this,"urlBase",{get(){var e="";return e+=this.protocol,e+="://",e+=this.host,(e+=":")+this.port}}),Object.defineProperty(this,"url",{get(){var e=this.urlBase;return null!=this._path&&this._path.length>0&&(e+=this._path),this.numOpts>0&&(e+="?",e+=this.parms),e}}),Object.defineProperty(this,"httpurlBase",{get(){var e="";return e+=this.httpProtocol,e+="://",e+=this.host,(e+=":")+this.port}}),Object.defineProperty(this,"httpurl",{get(){var e=this.httpurlBase;return null!=this._path&&this._path.length>0&&(e+=this._path),this.numOpts>0&&(e+="?",e+=this.parms),e}}),Object.defineProperty(this,"hasAuthorization",{get(){return null!=this._authorization&&this._authorization.length>0}}),Object.defineProperty(this,"authorization",{get(){return this._authorization},set(e){this._authorization=e,null!=this._authorization&&this.isConnected()&&0==this.isHandshakeComplete()&&this._websocket.send(this._authorization)}})}getType(){return this.constructor.name}ready(){}closed(){}error(){}handshakeComplete(){}start(){if(this._reconnect.timer=null,!this.isConnected()){this.clear();var e=this.getUrl();if(null==e)throw"invalid url";if(this._ready=!1,c.isNode)if("ws"==process.env.NODE_WEBSOCKETS)null==m?Promise.resolve().then(r.t.bind(r,2041,1)).then((t=>{var r=new(m=t.default)(e);r._connection=this,r.on("open",v.open),r.on("close",v.close),r.on("error",v.error),r.on("message",v.message)})).catch((e=>{console.log("import error on ws: "+e)})):((s=new m(e))._connection=this,s.on("open",v.open),s.on("close",v.close),s.on("error",v.error),s.on("message",v.message));else if(null==_)Promise.resolve().then(r.t.bind(r,9316,1)).then((t=>{function r(e,t){this._conn=t,this.binaryType="arraybuffer";var r={};r.tlsOptions=null!=this._conn._config?this._conn._config:{},_.call(this,e,null,null,null,null,r)}_=t.default.w3cwebsocket,r.prototype=Object.create(_.prototype),r.prototype.constructor=r;var s=new r(e,this);s.onopen=y.open,s.onclose=y.close,s.onerror=y.error,s.onmessage=y.message})).catch((e=>{console.log("import error on ws: "+e)}));else{function t(e,t){this._conn=t,this.binaryType="arraybuffer";var r={};r.tlsOptions=null!=this._conn._config?this._conn._config:{},_.call(this,e,null,null,null,null,r)}var s;t.prototype=Object.create(_.prototype),t.prototype.constructor=t,(s=new t(e,this)).onopen=y.open,s.onclose=y.close,s.onerror=y.error,s.onmessage=y.message}else(s=new WebSocket(e))._connection=this,s.onopen=b.open,s.onclose=b.close,s.onerror=b.error,s.onmessage=b.message}}stop(){return!!this.isConnected()&&(this.clear(),!0)}restart(){this.clear(),this.start()}reconnect(e){if(null==this._reconnect.timer&&(null!=e&&(this._reconnect.interval=e),0==this.isConnected())){var t=this;this._reconnect.timer=setTimeout((function(){t.start()}),1e3*this._reconnect.interval)}}message(e){if(!this._handshakeComplete){for(var t,r="",s=null,n=0;n<e.length;n++)if("\n"==(t=e.charAt(n))){if(0==r.length)break;null==this._headers&&(this._headers=new Object),this._headers[r]=null!=s?s.trim():"",r="",s=null}else null!=s?s+=t:":"==t?s="":r+=t;var i=this.getHeader("status");if(null!=i)if(200==i)this._handshakeComplete=!0,this.handshakeComplete();else if(401==i)if(null!=this._authorization)this._websocket.send(this._authorization);else{var o=this.getHeader("www-authenticate","").toLowerCase(),a=o.split(" ");a.length>1&&(o=a[0]);var h=!1;if(this._delegates.forEach((e=>{c.supports(e,"authenticate")&&(e.authenticate(this,o),h=!0)})),0==h){var l=this.getHeader("status");throw l+="\n",l+=this.getHeader("www-authenticate",""),l+="\n",c.isNode?new Error(l):l}}}}setBearer(e){this.authorization="Bearer "+e}setBasic(e){this.authorization="Basic "+e}data(e){}clear(){null!=this._websocket&&(this._websocket._connection=null,this._websocket.close(),this._websocket=null),this._ready=!1,this._handshakeComplete=!1,this._headers=null}getHeader(e,t){var r=t;return null!=this._headers&&this._headers.hasOwnProperty(e)&&(r=this._headers[e]),r}isHandshakeComplete(){return this._handshakeComplete}send(e){null!=this._websocket&&this._websocket.send(e)}sendObject(e){this.getOpt("debug",!1)&&console.log(JSON.stringify(e,null,"\t")),this.send(c.stringify(e))}sendBinary(e){var t=f(e);this.send(t)}isConnected(){return null!=this._websocket}getUrl(){return this.url}established(){var e=this.getUrl();return b.established(e)}static create(e,t){var r=c.createUrl(decodeURI(e));return new w(r.host,r.port,r.path,r.secure,t)}static createDelegateConnection(e,t,r,s){var n=c.createUrl(decodeURI(t));return new O(e,n.host,n.port,n.path,n.secure,r,s)}static established(e){return b._established.hasOwnProperty(e)}}class O extends w{constructor(e,t,r,s,n,i,o){super(t,r,s,n,i,o),this._delegate=e}ready(){c.supports(this._delegate,"ready")&&this._delegate.ready()}closed(){c.supports(this._delegate,"closed")&&this._delegate.closed()}error(){c.supports(this._delegate,"error")&&this._delegate.error()}handshakeComplete(){c.supports(this._delegate,"handshakeComplete")&&this._delegate.handshakeComplete()}message(e){0!=this.isHandshakeComplete()?c.supports(this._delegate,"message")&&this._delegate.message(e):super.message(e)}data(e){c.supports(this._delegate,"data")&&this._delegate.data(e)}}var S=null,E=null,x=null;c.isNode&&(Promise.resolve().then(r.t.bind(r,9992,1)).then((e=>{E=e.default})).catch((e=>{console.log("import error on xpath: "+e)})),Promise.resolve().then(r.t.bind(r,3668,1)).then((e=>{var t=e.default.DOMParser,r=e.default.XMLSerializer;x=new t,S=new r})).catch((e=>{console.log("import error on xmldom: "+e)})));var N={getNodes:function(e,t){var r=new Array;if(c.isNode){if(null!=(i=this.getXPath().select(e,t)))for(var s=0;s<i.length;s++)r.push(i[s])}else for(var n,i=(null==t?t=document:null!=t.ownerDocument?t.ownerDocument:t).evaluate(e,t,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);null!=(n=i.iterateNext());)r.push(n);return r},getElements:function(e){for(var t=[],r=0;r<e.children.length;r++)t.push(e.children.item(r));return t},getChildren:function(e){for(var t=[],r=0;r<e.childNodes.length;r++)t.push(e.childNodes.item(r));return t},getNode:function(e,t){var r=null,s=this.getNodes(e,t);return s.length>0&&(r=s[0]),r},getString:function(e,t){var r="";return this.getNodes(e,t).forEach((e=>{r+=null!=e.textContent?e.textContent:e.nodeValue})),r},nodeText:function(e){var t="",r=e;return null!=e.firstChild&&(4==e.firstChild.nodeType&&(r=e.firstChild),t=null!=r.textContent?r.textContent:r.nodeValue),t},xmlString:function(e){return c.isNode?S.serializeToString(e):(new XMLSerializer).serializeToString(e)},setNodeText:function(e,t){e.textContent=t},format:function(e,t){var r=new Object;return r._s="",null==t&&(t="  "),this.formatNode(r,e,0,t),r._s},formatNode:function(e,t,r,s){if(1==t.nodeType){for(var n=0;n<r;n++)e._s+=s;var i;if(e._s+="<"+t.tagName,t.attributes.length>0)for(n=0;n<t.attributes.length;n++)i=t.attributes[n],e._s+=" "+i.nodeName+"='"+i.nodeValue+"'";if(t.hasChildNodes()){e._s+=">";var o,a=!1,h=!1,l=!1;for(n=0;n<t.childNodes.length;n++)3==(o=t.childNodes[n]).nodeType?a=!0:4==o.nodeType?h=!0:l=!0;if(0==l&&(a||h))e._s+=h?"<![CDATA["+t.textContent+"]]>":t.textContent,e._s+="</"+t.tagName+">",r>0&&(e._s+="\n");else{for(e._s+="\n",n=0;n<t.childNodes.length;n++)this.formatNode(e,t.childNodes[n],r+1,s);for(n=0;n<r;n++)e._s+=s;e._s+="</"+t.tagName+">",r>0&&(e._s+="\n")}}else e._s+="></"+t.tagName+">\n"}},createXml:function(e){var t=null;return c.isNode?(t=x.parseFromString(e,"application/xml"),console.log(t)):t=(new DOMParser).parseFromString(e,"application/xml"),t},addOpts:function(e,t){this.getNodes("*",e).forEach((e=>{var r=e.tagName,s=this.nodeText(e);t.setOpt(r,s)}))},getXPath:function(){return E}},A=null,T=null;class C extends n{constructor(e,t,r,s){super(),this._name=e,this._url=t,this._delegate=r,this._context=s,this._requestHeaders=new Object,this._responseHeaders=null,this._data=null,this._method=null,this._xml=null}get(){this.send("GET")}post(){this.send("POST")}put(){this.send("PUT")}del(){this.send("DELETE")}head(){this.send("HEAD")}send(e){null!=e&&(this._method=e);var t=new URL(this._url,document.URL).protocol.toLowerCase();"file:"==t&&c.exception("file protocol is not supported");var r=new XMLHttpRequest,s=!1;r._url=this._url,r._protocol=t,r._ajax=this,this._request=r,this._xml=null,r.onreadystatechange=function(){if(1==this.readyState);else if(2==this.readyState);else if(3==this.readyState)s=!0;else if(4==this.readyState){if(401==this.status){var e=this.getResponseHeader("www-authenticate"),t=null;if(null!=e&&e.length>0){var r=e.split(" ");r.length>0&&(t=r[0].toLowerCase())}return null==t&&null!=this.responseXML&&(t=this.responseXML.firstChild.getAttribute("scheme")),void(null!=t&&c.supports(this._ajax._delegate,"authenticate")&&this._ajax._delegate.authenticate(t,this._ajax))}if("HEAD"==this._ajax._method)if(0==s)if("https:"==this._protocol){if(this._ajax.hasOpt("cert-confirm-url")){var n=this._ajax.getOpt("cert-confirm-url");window.open(n,n,"")}}else c.supports(this._ajax._delegate,"error")&&this._ajax._delegate.error(this._ajax,null,null);else c.supports(this._ajax._delegate,"response")&&this._ajax._delegate.response(this._ajax,null,null);else if(0==s)"https:"==this._protocol?this._ajax.hasOpt("cert-confirm-url")&&(n=this._ajax.getOpt("cert-confirm-url"),window.open(n,n,"")):c.supports(this._ajax._delegate,"error")&&this._ajax._delegate.error(this._ajax,null,null);else{var i=this.getResponseHeader("content-type");null!=this.responseXML?this._ajax._xml=this.responseXML:-1==i.indexOf("text/xml")&&-1==i.indexOf("application/xml")||(this._ajax._xml=N.createXml(this.responseText)),0==this.status?null!=this.responseText&&this.responseText.length>0||null!=this.responseXML?c.supports(this._ajax._delegate,"response")&&(null!=this.responseXML&&(this._ajax._xml=this.responseXML),this._ajax._delegate.response(this._ajax,this.responseText,this._ajax._xml)):c.supports(this._ajax._delegate,"error")&&this._ajax._delegate.error(this._ajax,null,null):c.supports(this._ajax._delegate,"response")&&this._ajax._delegate.response(this._ajax,this.responseText,this._ajax._xml)}}},r.open(this._method,this._url,!0),r.setRequestHeader("accept","text/xml");var n=null;if(c.supports(this._delegate,"authorization")&&(n=this._delegate.authorization()),null!=n&&n.length>0&&r.setRequestHeader("authorization",n),null!=this._requestHeaders)for(var i in this._requestHeaders)r.setRequestHeader(i,this._requestHeaders[i]);try{r.send(this._data)}catch(e){console.log("error: "+this._url+" : "+e),c.supports(r._ajax._delegate,"error")&&r._ajax._delegate.error(this,null,null)}}setAccept(e){this.setRequestHeader("accept",e)}setRequestHeaders(e){for(var t in e)this.setRequestHeader(t,e[t])}setRequestHeader(e,t){this._requestHeaders[e]=t}getResponseHeader(e){return this._request.getResponseHeader(e)}setData(e,t){this._data=e,null!=t&&this.setRequestHeader("content-type",t)}getContext(e){return this._context}getName(){return this._name}getUrl(){return this._url}getResponseText(){return null!=this._request?this._request.responseText:""}getResponseXml(){return null!=this._request?this._request._xml:null}getStatus(e){var t=0;return null!=this._request&&(t=this._request.status),t}}class P extends n{constructor(e,t,r,s){super(),this._name=e,this._url=t,this._delegate=r,this._context=s,this._requestHeaders=new Object,this._options={},this._response=null,this._responseText="",this._data=null,this._xml=null}get(e){this.setOptions(e),this.send("GET")}post(e){this.setOptions(e),this.send("POST")}put(e){this.setOptions(e),this.send("PUT")}del(e){this.setOptions(e),this.send("DELETE")}head(){this.send("HEAD")}setOptions(e){if(null!=e)for(var t in e)this._options[t]=e[t]}send(e){null!=e&&(this._options.method=e);var t=new URL(this._url);this._options.hostname=t.hostname,this._options.port=t.port,this._options.path=t.pathname;var s=t.protocol.toLowerCase();if("file:"!=s)"https:"==s?null==A?Promise.resolve().then(r.t.bind(r,7211,1)).then((e=>{A=e.default,this.complete(A.request(this._options))})).catch((e=>{console.log("import error on https: "+e)})):this.complete(A.request(this._options)):null==T?Promise.resolve().then(r.t.bind(r,8605,1)).then((e=>{T=e.default,this.complete(T.request(this._options))})).catch((e=>{console.log("import error on http: "+e)})):this.complete(T.request(this._options));else{var n=this._url.substr(7),i=this;require("fs").readFile(n,null,(function(e,t){this._responseText=t,null!=e?c.supports(i._delegate,"error")&&i._delegate.error(i,e):c.supports(i._delegate,"response")&&i._delegate.response(i,t,null)}))}}complete(e){var t=this;for(var r in this._requestHeaders)e.setHeader(r,this._requestHeaders[r]);e.on("response",(function(e){t._response=e;var r=e.headers["content-type"],s="";e.on("data",(function(e){s+=e.toString()})),e.on("end",(function(e){t._responseText=s,null!=r&&(-1==r.indexOf("text/xml")&&-1==r.indexOf("application/xml")||(t._xml=N.createXml(s))),c.supports(t._delegate,"response")&&t._delegate.response(t,s,t._xml)}))})),e.on("error",(function(e){console.log("got error: "+e.toString())})),null!=this._data&&e.write(this._data),e.end()}setAccept(e){this.setRequestHeader("accept",e)}setRequestHeaders(e){for(var t in e)this.setRequestHeader(t,e[t])}setRequestHeader(e,t){this._requestHeaders[e]=t}setData(e,t){this._data=e,null!=t&&this.setRequestHeader("content-type",t)}getContext(e){return this._context}getName(){return this._name}getUrl(){return this._url}getResponseText(){return this._responseText}getResponseXml(){return this._xml}getStatus(e){return null!=this._response?this._response.statusCode:0}}var R={create:function(e,t,r,s){return c.isNode?new P(e,t,r,s):new C(e,t,r,s)}};class k{constructor(){this._languages=null,this._parms=null,this._strings=null,this._delegate=null,this._locale=null;try{navigator.hasOwnProperty("language")&&(this._languages=[navigator.language]),null==this._languages&&(this._languages=navigator.languages);var e=window.location.search,t=new Object;for(var r in e.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),(function(e,r,s,n){t[r]=n})),t)t[r]=decodeURIComponent(t[r]);this._parms=t,this._strings=new Object}catch(e){}}getParm(e){var t=null;return null!=this._parms&&this._parms.hasOwnProperty(e)&&(t=unescape(this._parms[e])),t}getParms(){return this._parms}load(e,t){this._delegate=t,R.create("resources",e,this).get()}response(e,t,r){this._strings=new Object;for(var s,n,i,o=!1,a="",h=0;h<t.length;h++)"\n"==t[h]?(0==o&&(s=a.indexOf("="))>0&&(i=a.substr(0,s),n=a.substr(s+1),this._strings[i]=n),a="",o=!1):0==a.length?"#"==t[h]?o=!0:a+=t[h]:0==o&&(a+=t[h]);c.supports(this._delegate,"resourcesLoaded")&&this._delegate.resourcesLoaded(this)}error(e){var t=e.getUrl();t+="<br/>",t+=e.getResponseText(),alert(t)}getString(e,t){var r=null;if(null!=this._strings&&this._strings.hasOwnProperty(e)&&(r=this._strings[e]),null==r)return e+" not found";if(null!=t)for(var s in t)r=r.replace("$"+s,t[s]);return r}findString(e,t){var r=null;if(null!=this._strings&&this._strings.hasOwnProperty(e)&&(r=this._strings[e]),null!=r&&null!=t)for(var s in t)r=r.replace("$"+s,t[s]);return r}getStrings(){return this._strings}getLanguages(){return this._languages}getLocale(){return this._locale}setClassText(e,t,r){var s=null!=r?r:new Object,n=s.hasOwnProperty("contains")&&s.contains,i=s.hasOwnProperty("space")&&s.space,o=(!!s.hasOwnProperty("tips")&&s.tips,s.hasOwnProperty("element")?s.element:"*"),a=this.getString(t),h="";h+="//",h+=o,n?(h+="[contains(@class,'",h+=e,i&&(h+=" "),h+="')"):(h+="[@class='",h+=e,h+="'"),h+="]";for(var l=N.getNodes(h,document.body),c=0;c<l.length;c++)-1==(o=l[c]).className.indexOf("icon")?o.textContent=a:o.title=a}toString(){var e="";for(var t in this._strings)e+=t,e+="=",e+=this._strings[t];return e}}class D extends n{constructor(){super(),this._fields=[],this._fieldMap={},this._keyFields=[],this._columns=[],this._delegates=[],Object.defineProperty(this,"size",{get(){return this._fields.length}}),Object.defineProperty(this,"numkeys",{get(){return this._keyFields.length}})}addDelegate(e){c.addTo(this._delegates,e),this.size>0&&c.supports(d,"schemaLoaded")&&d.schemaLoaded(this)}setFields(e){var t,r,s;this._fields=[],this._fieldMap={},this._keyFields=[],this._columns=[],e.forEach((e=>{s=new n,t=e.name,s.setOpt("name",t),s.setOpt("espType",e.type),s.setOpt("isNumber",!1),s.setOpt("isTime",!1),s.setOpt("isDate",!1),s.setOpt("isArray",!1),e.hasOwnProperty("label")&&s.setOpt("label",e.label),"utf8str"==(r=s.getOpt("espType"))?s.setOpt("type","string"):"int32"==r||"int64"==r?(s.setOpt("type","int"),s.setOpt("isNumber",!0)):"double"==r||"money"==r?(s.setOpt("type","float"),s.setOpt("isNumber",!0)):"array(dbl)"==r?(s.setOpt("type","float"),s.setOpt("isNumber",!0),s.setOpt("isArray",!0)):"array(i32)"==r||"array(i64)"==r?(s.setOpt("type","int"),s.setOpt("isNumber",!0),s.setOpt("isArray",!0)):"date"==r?(s.setOpt("type","date"),s.setOpt("isDate",!0)):"timestamp"==r?(s.setOpt("type","datetime"),s.setOpt("isTime",!0)):s.setOpt("type",r),s.setOpt("isKey",e.hasOwnProperty("key")&&"true"==e.key),this._fields.push(s),this._columns.push(t),this._fieldMap[t]=s,s.isKey&&this._keyFields.push(s)}))}fromXml(e){var t,r,s;for(var i of(this._fields=[],this._fieldMap={},this._keyFields=[],this._columns=[],N.getNodes(".//fields/field",e)))s=new n,t=i.getAttribute("name"),s.setOpt("name",t),s.setOpt("espType",i.getAttribute("type")),s.setOpt("isNumber",!1),s.setOpt("isTime",!1),s.setOpt("isDate",!1),s.setOpt("isArray",!1),"utf8str"==(r=s.getOpt("espType"))?s.setOpt("type","string"):"int32"==r||"int64"==r?(s.setOpt("type","int"),s.setOpt("isNumber",!0)):"double"==r||"money"==r?(s.setOpt("type","float"),s.setOpt("isNumber",!0)):"array(dbl)"==r?(s.setOpt("type","float"),s.setOpt("isNumber",!0),s.setOpt("isArray",!0)):"array(i32)"==r||"array(i64)"==r?(s.setOpt("type","int"),s.setOpt("isNumber",!0),s.setOpt("isArray",!0)):"date"==r?(s.setOpt("type","date"),s.setOpt("isDate",!0)):"timestamp"==r?(s.setOpt("type","datetime"),s.setOpt("isTime",!0)):s.setOpt("type",r),s.setOpt("isKey","true"==i.getAttribute("key")),this._fields.push(s),this._columns.push(t),this._fieldMap[t]=s,s.getOpt("isKey",!1)&&this._keyFields.push(s);for(var o of this._delegates)c.supports(o,"schemaLoaded")&&o.schemaLoaded(this)}fromJson(e,t){var r,s,i;for(var o of(this._fields=[],this._fieldMap={},this._keyFields=[],this._columns=[],e.fields.forEach((e=>{i=new n,r=e["@name"],i.setOpt("name",r),i.setOpt("espType",e["@type"]),i.setOpt("isNumber",!1),i.setOpt("isTime",!1),i.setOpt("isDate",!1),i.setOpt("isArray",!1),"utf8str"==(s=i.getOpt("espType"))?i.setOpt("type","string"):"int32"==s||"int64"==s?(i.setOpt("type","int"),i.setOpt("isNumber",!0)):"double"==s||"money"==s?(i.setOpt("type","float"),i.setOpt("isNumber",!0)):"array(dbl)"==s?(i.setOpt("type","float"),i.setOpt("isNumber",!0),i.setOpt("isArray",!0)):"array(i32)"==s||"array(i64)"==s?(i.setOpt("type","int"),i.setOpt("isNumber",!0),i.setOpt("isArray",!0)):"date"==s?(i.setOpt("type","date"),i.setOpt("isDate",!0)):"timestamp"==s?(i.setOpt("type","datetime"),i.setOpt("isTime",!0)):i.setOpt("type",s),i.setOpt("isKey",e.hasOwnProperty("@key")&&"true"==e["@key"]),this._fields.push(i),this._columns.push(r),this._fieldMap[r]=i,i.getOpt("isKey",!1)&&this._keyFields.push(i)})),c.supports(t,"completeSchema")&&t.completeSchema(this),this._delegates))c.supports(o,"schemaLoaded")&&o.schemaLoaded(this)}getField(e){return this._fieldMap.hasOwnProperty(e)?this._fieldMap[e]:null}getFields(e){return this._fields}getFieldDescriptors(e){var t=[];return this._fields.forEach((e=>{t.push(e.getOpts())})),t}getKeyFields(){return this._keyFields}getColumnFields(){var e=[];for(var t of this._fields)0==t.getOpt("isKey",!1)&&e.push(t);return e}getKeyFieldNames(e){var t=[],r=this.getKeyFields();if(null!=r)for(var s of r)t.push(s.getOpt("name"));return t}toString(){return c.stringify(this._fieldMap)}createDataFromCsv(e,t){var r,s,i,o,a,h,l,u,p=new n(t),d=p.getOpt("delegate"),f=[],g=e.split("\n"),m=this.getFields(),_=null,v=0,y=!1,b=0;p.getOpt("header",!1)&&(_=(h=g[b].trim()).split(","),b++);for(var w=p.getOpt("opcodes",!1),O=p.getOpt("flags",!1),S=c.supports(d,"filter")?d.filter:null,E=c.supports(d,"supplement")?d.supplement:null;b<g.length;)if(0!=(h=g[b].trim()).length)if("/*"!=h)if(y&&"*/"==h)y=!1,b++;else if(y)b++;else{l=[],o="";for(var x=0;x<h.length;x++)","==(a=h[x])?v>0?o+=a:(l.push(o),o=""):'"'==a?"\\"==i?o+=a:v^=1:"\\"==a?"\\"==i&&(o+=a):o+=a,i=a;if(o.length>0&&l.push(o),u={},null!=_)for(var N=0;N<l.length;N++)null!=(r=this.getField(_[N]))&&(u[r.getOpt("name")]=l[N]);else for(s=0,N=0;N<l.length;N++)w&&0==N?"i"!=(h=l[N].trim().toLowerCase())&&"u"!=h&&"p"!=h&&"d"!=h||("u"==h?u["@opcode"]="update":"p"==h?u["@opcode"]="upsert":"d"==h&&(u["@opcode"]="delete")):O&&1==N?h=l[N].trim().toLowerCase():s<m.length&&(u[(r=m[s]).getOpt("name")]=l[N],s++);b++,null!=S&&0==S(u)||(null!=E&&E(u),f.push(u))}else y=!0,b++;else b++;return f}}class j{constructor(e){this._projects=[],this._contqueries=[],this._windows=[],this._sourceWindows=[];for(var t,r,s,n,i,o,a,h,l,c,u,p,d,f,g,m,_=N.getNodes("//project",e),v=0;v<_.length;v++){d=_[v].getAttribute("name"),(s=new Object).xml=_[v],s.key=d,s.name=d,s.index=_[v].getAttribute("index"),m=_[v].getAttribute("read"),s.hasReadPermission=!(null!=m&&m.length>0)||"true"==m,m=_[v].getAttribute("write"),s.hasWritePermission=!(null!=m&&m.length>0)||"true"==m,this._projects.push(s),s.contqueries=new Array,t=N.getNodes(".//contquery",_[v]);for(var y=0;y<t.length;y++)if(c=t[y].getAttribute("name"),(r=new Object).key=d+"/"+c,r.name=c,r.index=t[y].getAttribute("index"),m=t[y].getAttribute("read"),r.hasReadPermission=!(null!=m&&m.length>0)||"true"==m,m=t[y].getAttribute("write"),r.hasWritePermission=!(null!=m&&m.length>0)||"true"==m,s.contqueries.push(r),this._contqueries.push(r),r.windows=new Array,r.edges=new Array,0==(n=N.getNodes(".//window",t[y])).length&&(n=N.getNodes(".//windows/*",t[y])),0!=n.length){for(var b,w,O=0;O<n.length;O++)(l=this.addWindow(s,r,n[O])).xml=n[O],null!=(b=N.getNode("./xml",n[O]))?(w=N.createXml(N.nodeText(b)),l.xmlsource=N.xmlString(w.documentElement)):l.xmlsource=N.format(l.xml),l.pubsubEnabled="true"==n[O].getAttribute("pubsub"),m=n[O].getAttribute("read"),l.hasReadPermission=!(null!=m&&m.length>0)||"true"==m,m=n[O].getAttribute("write"),l.hasWritePermission=!(null!=m&&m.length>0)||"true"==m,r.windows.push(l);for(a=N.getNodes("./edges/edge",t[y]),O=0;O<a.length;O++){o=a[O].getAttribute("source").split(" "),i=a[O].getAttribute("target").split(" ");for(var S=0;S<o.length;S++)if(f=d+"/"+c+"/"+o[S].trim(),null!=(u=this.getWindow(f)))for(var E=0;E<i.length;E++)(m=i[E].trim()).length>0&&(g=d+"/"+c+"/"+m,null!=(p=this.getWindow(g))&&(u.outgoing.push(p),p.incoming.push(u),(h=new Object).a=u.key,h.z=p.key,r.edges.push(h)))}}}for(v=0;v<this._contqueries.length;v++)this._contqueries[v].windows.sort(L.compareNames);this._xml=e,this._xml.documentElement.removeAttribute("id"),Object.defineProperty(this,"xml",{get(){return this._xml}}),Object.defineProperty(this,"xmlstring",{get(){return N.xmlString(this._xml)}}),Object.defineProperty(this,"projects",{get(){return this._projects}})}addWindow(e,t,r){var s=r.getAttribute("name"),n=r.getAttribute("type");null!=n&&0!=n.length||(n=r.nodeName);var i=n.split("-");if(i.length>1){n="";for(var o=1;o<i.length;o++)n.length>0&&(n+="-"),n+=i[o]}var a=new Object;a.p=e.name,a.cq=t.name,a.name=s,a.type=n,a.index=r.getAttribute("index"),a.class=L._windowClasses.hasOwnProperty(n)?L._windowClasses[n]:"unknown",null==a.index&&null==(a.index=t.index)&&null==(a.index=e.index)&&(a.index="pi_HASH");var h=new D;return h.fromXml(r),a.schema=h,a.key=e.name+"/"+t.name+"/"+s,a.incoming=new Array,a.outgoing=new Array,a.cpu=0,a.count=0,this._windows.push(a),"window-source"==a.type&&(this.sourceWindows[a.key]=!0),a}getProjects(e){return this._projects}getProject(e){return this.get(e,this._projects)}getContqueries(e){return this._contqueries}getContquery(e){return this.get(e,this._contqueries)}getWindows(){return this._windows}getSourceWindows(){var e=[];return this._windows.forEach((t=>{"source"==t.type&&e.push(t)})),e}getWindowsForProject(e){var t=[];return this._windows.forEach((r=>{"*"!=e&&e!=r.p||t.push(r)})),t}getWindow(e){return this.get(e,this._windows)}getWindowType(e){var t=null,r=this.getWindow(e);return null!=r&&(t=r.type),t}get(e,t){for(var r=0;r<t.length;r++)if(t[r].key==e)return t[r];return null}removeIsolated(e){for(var t,r=new Array,s=0;s<e.windows.length;s++)("source"==(t=e.windows[s]).type||"window-source"==t.type||t.incoming.length>0||t.outgoing.length>0)&&r.push(t);e.windows=r}}var L={_windowClasses:new Object,init(){this._windowClasses.source="input",this._windowClasses.filter="transformation",this._windowClasses.aggregate="transformation",this._windowClasses.compute="transformation",this._windowClasses.union="transformation",this._windowClasses.join="transformation",this._windowClasses.copy="transformation",this._windowClasses.functional="transformation",this._windowClasses.notification="utility",this._windowClasses.pattern="utility",this._windowClasses.counter="utility",this._windowClasses.geofence="utility",this._windowClasses.procedural="utility",this._windowClasses["model-supervisor"]="analytics",this._windowClasses["model-reader"]="analytics",this._windowClasses.train="analytics",this._windowClasses.calculate="analytics",this._windowClasses.score="analytics",this._windowClasses["text-context"]="textanalytics",this._windowClasses["text-category"]="textanalytics",this._windowClasses["text-sentiment"]="textanalytics",this._windowClasses["text-topic"]="textanalytics"},compareNames:function(e,t){return e.name.localeCompare(t.name)},create:e=>new j(e)};L.init();const I=new k;class F extends n{constructor(e,t){super(t),this._connection=e,this._version,Object.defineProperty(this,"connection",{get(){return this._connection}}),Object.defineProperty(this,"connect",{get(){return this._connection.connect}}),Object.defineProperty(this,"version",{get(){return this._version},set(e){this._version=parseFloat(e)}}),Object.defineProperty(this,"protocol",{get(){return this._connection.protocol}}),Object.defineProperty(this,"httpProtocol",{get(){return this._connection.httpProtocol}}),Object.defineProperty(this,"host",{get(){return this._connection.host}}),Object.defineProperty(this,"port",{get(){return this._connection.port}}),Object.defineProperty(this,"isSecure",{get(){return this._connection.isSecure}}),Object.defineProperty(this,"url",{get(){return this._connection.url}}),Object.defineProperty(this,"httpurl",{get(){return this._connection.httpurl}}),Object.defineProperty(this,"k8s",{get(){return this.getOpt("k8s")}}),this._closed=!1,Object.defineProperty(this,"closed",{get(){return this._closed},set(e){this._closed=e}}),this.init()}init(){this._datasources={},this._publishers={},this._stats=new q(this),this._log=new H(this),this._modelDelegates={},this._publisherDelegates={},this._guidDelegates={},this._loadDelegates={},this._responseDelegates={},this._gets={}}versionGreaterThan(e){return this._version>e}versionLessThan(e){return this._version<e}stop(){this._connection.stop()}formUrl(e,t,r){var s=e;s+="/eventStreamProcessing/v1/",s+=t;var n="";if(null!=r)for(var i in r){var o=r[i];if("object"==typeof o)for(var a in o)n+=n.length>0?"&":"?",n+=a+"="+o[a];else n+=n.length>0?"&":"?",n+=i+"="+o}return n.length>0&&(s+=n),s}getUrl(e,t){return this.formUrl(this._connection.urlBase,e,t)}getHttpUrl(e,t){return this.formUrl(this._connection.httpurlBase,e,t)}createRequest(e,t,r){var s=R.create(e,t,r);return this._connection.hasAuthorization&&s.setRequestHeader("authorization",this._connection.authorization),s}closed(){}close(){this._closed=!0}send(e){this._connection.send(e)}sendObject(e){this._connection.sendObject(e)}sendBinary(e){this._connection.sendBinary(e)}message(e){if(0!=e.length){for(var t=null,r=null,s=0;s<e.length;s++){if("{"==e[s]||"["==e[s]){r=JSON.parse(e);break}if("<"==e[s]){t=N.createXml(e);break}}null!=r?this.processJson(r):null!=t&&this.processXml(t,e)}}addProjectUpdateDelegate(e){c.exception("addProjectUpdateDelegate is not supported")}removeProjectUpdateDelegate(e){c.exception("removeProjectUpdateDelegate is not supported")}data(e){this.processJson(e)}addDelegate(e){c.addTo(this._delegates,e)}removeDelegate(e){c.removeFrom(this._delegates,e)}getDatasource(e){var t=new n(e),r="stream";return t.hasOpt("mode")&&(r=t.getOpt("mode")),"collection"==r?this.getEventCollection(t.getOpts()):this.getEventStream(t.getOpts())}getEventCollection(e){e.mode="collection";var t=new B(this,e);return this._datasources[t._id]=t,t.open(),t}getEventStream(e){var t=new M(this,e);return this._datasources[t._id]=t,t.open(),t}getPublisher(e){if(e.hasOwnProperty("id")){var t=e.id;if(this._publishers.hasOwnProperty(t))return this._publishers[t]}var r=new V(this,e);return this._publishers[r._id]=r,r.open(),r}closePublisher(e){this._publishers.hasOwnProperty(e)&&this._publishers[e].close()}clearWindow(e){}publishDataFrom(e,t,r,s){var n=this;R.create("load",t,{response:function(t,i,o){n.publishData(e,i,r,s)},error:function(e,t){console.log("error: "+t)}}).get()}publishData(e,t,r,s){var i=new n(s);i.setOpt("format","csv");var o=i.getOpt("times",1),a={ready:function(){for(var e=0;e<o;e++)l.send(t);setTimeout((function(){null!=r&&c.supports(r,"publishComplete")&&r.publishComplete(),l.stop()}),1e3)}},h=this.getUrl("publishers/"+e),l=w.createDelegateConnection(a,h,i.getOpts(),this._connection._connect.config);l.authorization=this._connection.authorization,l.start()}publishUrl(e,t,r,s){null==s&&(s={}),s.value="injected",s.eventUrl=t;var n=this.getHttpUrl("windows/"+e+"/state",s);R.create("publish",n,{response:function(e,t,s){null!=r&&c.supports(r,"publishComplete")&&r.publishComplete()},error:function(e,t){console.log("error: "+t)}}).put()}getStats(e){return null!=e&&this._stats.setOpts(e),this._stats}getLog(){return this._log}get(e,t,r){}loadModel(e,t){if(0==c.supports(e,"modelLoaded"))throw"The delegate must implement the modelLoaded method";var r=this.getHttpUrl("projects",t),s=this,n={response:function(t,r,n){if(c.supports(e,"modelLoaded")){var i=new j(n);e.modelLoaded(i,s)}},error:function(t,r){c.supports(e,"error")&&e.error(t.getName(),r)}};this.createRequest("load",r,n).get(this._connection._config)}loadUrl(e,t,r){R.create("load",t,{response:function(t,s,n){c.supports(r,"loaded")&&r.loaded(e,s,n)},error:function(t,s){c.supports(r,"error")&&r.error(e,text)}}).get()}loadProjectFrom(e,t,r,s){var n=this;R.create("load",t,{response:function(t,i,o){n.loadProject(e,i,r,s)},error:function(e,t){console.log("error: "+t)}}).get()}loadRouterFrom(e,t,r,s){var n=this;R.create("load",t,{response:function(t,i,o){n.loadRouter(e,i,r,s)},error:function(e,t){console.log("error: "+t)}}).get()}loadProject(e,t,r,s){var n=this,i={response:function(t,s,i){c.supports(r,"loaded")&&r.loaded(n,e)},error:function(e,t,s){if(c.supports(r,"error")){var i=N.getString("//message",s);r.error(n,e.getName(),i)}}},o=this.getHttpUrl("projects/"+e,s),a=this.createRequest("loadProject",o,i);a.setData(t),a.put()}loadRouter(e,t,r,s){var n={response:function(e,t,s){if(c.supports(r,"loaded")){var n=N.getString("//message",s);r.loaded(this,n)}},error:function(e,t,s){if(c.supports(r,"error")){var n=N.getString("//message",s);r.error(this,e.getName(),n)}}},i=this.getHttpUrl("routers/"+e,s),o=this.createRequest("loadRouter",i,n);o.setData(t),o.put()}deleteProject(e,t){this.url;var r={project:{}},s=r.project;s.name=e,s.action="delete",this.sendObject(r)}getProjectXml(e,t){var r=null!=e?{name:e}:{},s=this.getHttpUrl("projectXml",r);this.createRequest("load",s,t).get()}getXml(e,t){this.getProjectXml(null,t)}getLoggers(e){if(0==c.supports(e,"response"))throw"The delegate must implement the response method";var t={response:function(t,r,s){var n=[];N.getNodes("//loggers/logger",s).forEach((e=>{n.push({"@level":e.getAttribute("level"),"@name":e.getAttribute("name")})})),e.response(this,n)},error:function(t,r){c.supports(e,"error")&&(console.log("error: "+r),e.error(t.getName(),r))}},r=this.getHttpUrl("loggers");this.createRequest("loggers",r,t).get()}setLogger(e,t,r){var s={response:function(e,t,s){var n=N.getString("//message",s);r.response(this,n)},error:function(e,t){c.supports(r,"error")&&(console.log("error: "+t),r.error(e.getName(),t))}},n=this.getHttpUrl("loggers/"+e+"/level",{value:t});this.createRequest("setLogger",n,s).put()}createModel(e){return new j(e)}loadGuids(e,t){if(0==c.supports(e,"guidsLoaded"))throw"The stats delegate must implement the guidsLoaded method";var r=c.guid();this._guidDelegates[r]=new W(this,e);var s={guids:{}},n=s.guids;n.id=r,null!=t&&(n.num=t),this.sendObject(s)}guid(){return c.guid()}getStatus(){this.sendObject({request:"status"})}createEventSources(e){return eventsources.createEventSources(this,e)}toString(){return""+this._connection.getUrl()}}class U extends n{constructor(e,t){super(t),this._api=e,this._id=this.getOpt("id",c.guid()),this._path=this.getOpt("window"),this._schema=new D,this._schema.addDelegate(this),Object.defineProperty(this,"id",{get(){return this._id}}),Object.defineProperty(this,"api",{get(){return this._api}}),Object.defineProperty(this,"schema",{get(){return this._schema}}),Object.defineProperty(this,"name",{get(){var e=this.getOpt("name","");return 0==e.length&&(e=this.getOpt("window")),e},set(e){this.setOpt("name",e)}}),Object.defineProperty(this,"size",{get(){var e=0;return null!=this._data&&(e=Array.isArray(this._data)?this._data.length:Object.keys(this._data).length),e}}),this._data=null,this._list=null,this._delegates=[],this._schemaDelegates=[],this._paused=!1}schemaLoaded(){this._delegates.forEach((e=>{c.supports(e,"schemaReady")&&e.schemaReady(this._api,this)}))}isArray(){return null!=this._data&&Array.isArray(this._data)}setIntervalProperty(){var e=null;this.hasOpt("interval")?e=this.getOpt("interval"):this._api.hasOpt("interval")&&(e=this._api.getOpt("interval")),null==e&&(e=0),this.setOpt("interval",e)}setFilter(e){this.setOpt("filter",e),this.set(!0),this.deliverFilterChange()}clearFilter(){this.clearOpt("filter"),this.set(!0),this.deliverFilterChange()}getFilter(){return this.getOpt("filter")}play(){this._paused=!1}pause(){this._paused=!0}togglePlay(){var e=!1;return this._paused?(this.play(),e=!0):this.pause(),e}setSchemaFromXml(e){this._schema.fromXml(e)}setSchemaFromJson(e){this._schema.fromJson(e)}getKey(e){var t,r="";return this._schema._keyFields.forEach((s=>{t=s.getOpt("name"),0!=e.hasOwnProperty(t)&&(r.length>0&&(r+="-"),r+=e[t])})),r}toggleSelectedKeys(e,t){var r;t&&this.deselectAll(),e.forEach((e=>{null!=(r=this.getDataByKey(e))&&this.toggleSelected(r)})),this.deliverSelectionChange(null,!1)}isSelected(e){return null!=e&&e.hasOwnProperty("@selected")&&1==e["@selected"]}toggleSelected(e){return e.hasOwnProperty("@selected")?e["@selected"]=!e["@selected"]:e["@selected"]=!1,e["@selected"]}deselectAll(){Array.isArray(this._data)?this._data.forEach((e=>{e["@selected"]=!1})):Object.values(this._data).forEach((e=>{e["@selected"]=!1}))}setSelectedIndices(e,t){t&&this.deselectAll();var r=this.getList();e.forEach((e=>{e<r.length&&(r[e]["@selected"]=!0)})),this.deliverSelectionChange(null,!1)}toggleSelectedIndices(e,t){t&&this.deselectAll();var r=this.getList();e.forEach((e=>{e<r.length&&this.toggleSelected(r[e])})),this.deliverSelectionChange(null,!1)}selectByKeys(e){this.deselectAll(),e.forEach((e=>{console.log("key: "+e)}))}getSelectedItems(){var e=[];return this.getList().forEach((t=>{this.isSelected(t)&&e.push(t)})),e}getSelectedIndices(){var e=[],t=0;return this.getList().forEach((r=>{this.isSelected(r)&&e.push(t),t++})),e}getSelectedKeys(){var e=[];return this.getList().forEach((t=>{this.isSelected(t)&&e.push(t["@key"])})),e}getSelectedItem(){var e=this.getSelectedItems();return e.length>0?e[0]:null}getSelectedIndex(){var e=this.getSelectedIndices();return e.length>0?e[0]:null}getSelectedKey(){var e=this.getSelectedKeys();return e.length>0?e[0]:null}getKeyValues(){var e=[];if(Array.isArray(this._data))for(var t of this._data)e.push(t["@key"]);else for(var r in this._data)e.push(r);return e}getList(){var e=null;if(null!=this._data)if(Array.isArray(this._data))e=this._data;else if(null!=this._list)e=this._list;else for(var t in e=[],this._data)e.push(this._data[t]);return e}getValues(e){var t=this._schema.getField(e);if(null==t)return null;var r,s=[],n=t.getOpt("isNumber",!1);if(Array.isArray(this._data)||null!=this._list)(null!=this._list?this._list:this._data).forEach((t=>{t.hasOwnProperty(e)?n?s.push(parseFloat(t[e])):s.push(t[e]):n?s.push(0):s.push("")}));else for(var i in this._data)(r=this._data[i]).hasOwnProperty(e)?n?s.push(parseFloat(r[e])):s.push(r[e]):n?s.push(0):s.push("");return s}getLimits(e){var t=null,r=this.getValues(e);return r.length>0&&(t={min:Math.min.apply(Math,r),max:Math.max.apply(Math,r),values:r}),t}getValuesBy(e,t,r,s="."){if(0==this.schema.size)return null;var n,i={},o=[];for(var a of e){if(null==(n=this._schema.getField(a)))throw"field "+a+" not found";null!=r&&r.hasOwnProperty(n.getOpt("name"))||(o.push(n),i[n.getOpt("name")]=[])}var h=!1,l=!1;1==o.length&&((n=o[0]).getOpt("isDate",!1)?h=!0:n.getOpt("isTime",!1)&&(l=!0));var c=[];for(var a of t){if(null==(n=this._schema.getField(a)))throw"field "+a+" not found";c.push(n)}var u=null;if(Array.isArray(this._data)?u=this._data:(u=[],Object.values(this._data).forEach((e=>{u.push(e)}))),null==u)throw"invalid data";var p,d,f,g,m={};for(var _ of u){if(null!=r){var v=!0;for(var y in r)if(r[y]!=_[y]){v=!1;break}if(0==v)continue}if(g="",o.forEach((e=>{f=e.getOpt("name"),_.hasOwnProperty(f)&&(p=_[f],g.length>0&&(g+=s),g+=p,0==i[f].includes(p)&&i[f].push(p))})),m.hasOwnProperty(g))d=m[g];else{for(n of(d={},c))f=n.getOpt("name"),d[f]=0;m[g]={key:g,data:d,selected:this.isSelected(_)}}for(n of c)n.getOpt("isNumber",!1)&&(f=n.getOpt("name"),d[f]+=parseFloat(_[f]))}var b={};for(n of c)f=n.getOpt("name"),b[f]=[];var w=[],O=[];return Object.values(m).forEach((e=>{if(g=e.key,d=e.data,h){var t=new Date,r=1e3*new Number(g);t.setTime(r),w.push(t)}else l?(t=new Date,r=new Number(g)/1e3,t.setTime(r),w.push(t)):w.push(g);for(n of(O.push(e.selected),c))f=n.getOpt("name"),n.getOpt("isNumber",!1)?b[f].push(parseFloat(d[f])):b[f].push(d[f])})),{keys:w,keyvalues:i,values:b,selected:O}}getKeyFieldNames(){return null!=this._schema?this._schema.getKeyFieldNames():null}events(e){}info(e){}set(e){}addDelegate(e){if(0==c.supports(e,"dataChanged"))throw c.isNode?new Error("The datasource delegate must implement the dataChanged method"):"The datasource delegate must implement the dataChanged method";c.addTo(this._delegates,e)}removeDelegate(e){c.removeFrom(this._delegates,e)}addSchemaDelegate(e){if(0==c.supports(e,"schemaSet"))throw c.isNode?new Error("The datasource schema delegate must implement the schemaSet method"):"The datasource schema delegate must implement the schemaSet method";c.addTo(this._schemaDelegates,e)}removeSchemaDelegate(e){c.removeFrom(this._schemaDelegates,e)}clear(){null!=this._data&&(Array.isArray(this._data),this._data=[]),this.deliverDataChange(null,!0)}deliverDataChange(e,t){this._delegates.forEach((r=>{r.dataChanged(this,e,t)}))}deliverInfoChange(){this._delegates.forEach((e=>{c.supports(e,"infoChanged")&&e.infoChanged(this)}))}deliverSchemaSet(){this.getOpt("debug")&&console.log("schema set for "+this+"\n"+this._schema.toString()),this._schemaDelegates.forEach((e=>{c.supports(e,"schemaSet")&&e.schemaSet(this,this._schema)}))}deliverInfo(e){this._delegates.forEach((t=>{c.supports(t,"info")&&t.info(this,e)}))}deliverFilterChange(){this._delegates.forEach((e=>{c.supports(e,"filterChanged")&&e.filterChanged(this)}))}deliverSelectionChange(){this._delegates.forEach((e=>{c.supports(e,"selectionChanged")&&e.selectionChanged(this)}))}getDataByKey(e){var t=null;if(null!=this._data)if(Array.isArray(this._data)){for(var r of this._data)if(e==r["@key"]){t=r;break}}else t=this._data[e];return t}createDataFromCsv(e){var t=null;return null!=this._schema&&(t=this._schema.createDataFromCsv(e)),t}}class B extends U{constructor(e,t){super(e,t),this._window=this.getOpt("window"),this.setOpt("format","xml"),this._data={},this._list=[],this._page=0,this._pages=0,this._sort=null,this._sortdir=0}open(){var e=this._api.getUrl("subscribers/"+this._path),t={mode:"updating",schema:!0,format:"xml",snapshot:!0},r=this.getInt("interval",0);this.hasOpt("pagesize")&&(t.pagesize=this.getOpt("pagesize")),this.hasOpt("filter")&&(t.filter=this.getOpt("filter")),this.hasOpt("sort")?(t.sort=this.getOpt("sort"),0==r&&(r=1e3),t.interval=r):r>0&&(t.interval=r),this._connection=w.createDelegateConnection(this,e,t,this._api.connection._connect.config),this._connection.authorization=this._api._connection.authorization,this._connection.start(),this.setIntervalProperty()}set(e){var t="";t+="<properties>",t+="<filter>",t+=this.getOpt("filter"),t+="</filter>",t+="</properties>",this._connection.send(t),e&&this.load()}close(){this._connection.stop(),this._connection=null}message(e){var t=N.createXml(e),r=t.documentElement;"schema"==r.tagName?this.setSchemaFromXml(t):"events"==r.tagName&&this.eventsXml(t.documentElement)}play(){var e={"event-collection":{}},t=e["event-collection"];t.id=this._id,t.action="play",this._api.sendObject(e),super.play()}pause(){var e={"event-collection":{}},t=e["event-collection"];t.id=this._id,t.action="pause",this._api.sendObject(e),super.pause()}sort(e,t){var r=parseFloat(e[this._sort]),s=parseFloat(t[this._sort]);return 0==this._sortdir?s-r:r-s}load(){this.loadPage(null)}first(){this.loadPage("first")}last(){this.loadPage("last")}prev(){this.loadPage("prev")}next(){this.loadPage("next")}loadPage(e){var t="<load";null!=e&&(t+=" page='"+e+"'"),t+="/>",this._connection.send(t)}setSchemaFromXml(e){super.setSchemaFromXml(e),this.deliverSchemaSet()}setSchemaFromJson(e){super.setSchemaFromJson(e),this.deliverSchemaSet()}events(e){if(this.getOpt("debug")&&(console.log("events for "+this._path),console.log(c.stringify(e))),0!=e.hasOwnProperty("entries")){var t,r=[],s=e.entries;null!=s&&s.forEach((e=>{for(var s in t={},e)t[s]=e[s];0==t.hasOwnProperty("@opcode")&&(t["@opcode"]="insert"),t["@key"]=this.getKey(t),r.push(t)}));var n=e.hasOwnProperty("info")?e.info:null;this.process(r,null!=n),null!=n&&this.info(n)}}eventsXml(e){this.getOpt("debug")&&(console.log("events for "+this._path),console.log(N.format(e)));var t,r,s,n,i=[];N.getNodes("//events/event",e).forEach((e=>{null!=(s=e.getAttribute("opcode"))&&0!=s.length||(s="insert"),o={},o["@opcode"]=s,null!=(n=e.getAttribute("timestamp"))&&n.length>0&&(o["@timestamp"]=n),N.getNodes("./*",e).forEach((function(e){t=e.getAttribute("type"),r=e.textContent,null!=t&&t.length>0?o[e.nodeName]="_data://"+t+":"+r:o[e.nodeName]=r})),o["@key"]=this.getKey(o),i.push(o)}));var a=e.hasAttribute("page");this.process(i,a),a&&this.info(e)}info(e){e.hasOwnProperty("page")&&(this._page=e.page,this._pages=e.pages,this.deliverInfoChange())}process(e,t){var r,s,n=null;t&&(n=this.getSelectedKeys(),this._data={},this._list=[]),e.forEach((e=>{null!=(r=e["@key"])&&("delete"==e["@opcode"]?this._data.hasOwnProperty(r)&&(c.removeFrom(this._list,this._data[r]),delete this._data[r]):t?((s={})["@key"]=r,this._data[r]=s,this._list.push(s),s["@selected"]=n.includes(r),this._schema._columns.forEach((t=>{e.hasOwnProperty(t)&&(s[t]=e[t])}))):(this._data.hasOwnProperty(r)?(s=this._data[r],c.setItem(this._list,s)):((s={})["@key"]=r,s["@selected"]=!1,this._data[r]=s,this._list.push(s)),this._schema._columns.forEach((t=>{e.hasOwnProperty(t)&&(s[t]=e[t])}))))})),this.deliverDataChange(e,t)}}class M extends U{constructor(e,t){super(e,t),this._window=this.getOpt("window"),this.setOpt("format","xml"),this._data=[],this._counter=1}ready(){this.set()}open(){this.setIntervalProperty();var e=this._api.getUrl("subscribers/"+this._path),t={mode:"streaming",schema:!0,format:"xml"};this.hasOpt("filter")&&(t.filter=this.getOpt("filter")),this.hasOpt("maxevents")&&(t.maxevents=this.getOpt("maxevents")),this._connection=w.createDelegateConnection(this,e,t,this._api.connection._connect.config),this._connection.authorization=this._api._connection.authorization,this._connection.start()}message(e){var t=N.createXml(e),r=t.documentElement;"schema"==r.tagName?this.setSchemaFromXml(t):"events"==r.tagName&&this.eventsXml(t.documentElement)}set(e){var t="";t+="<properties>",t+="<filter>",t+=this.getOpt("filter"),t+="</filter>",t+="</properties>",this._connection.send(t)}close(){var e={"event-stream":{}},t=e["event-stream"];t.id=this._id,t.action="close",this._api.sendObject(e)}play(){var e={"event-stream":{}},t=e["event-stream"];t.id=this._id,t.action="play",this._api.sendObject(e),super.play()}pause(){var e={"event-stream":{}},t=e["event-stream"];t.id=this._id,t.action="pause",this._api.sendObject(e),super.play()}setSchemaFromXml(e){super.setSchemaFromXml(e),this.completeSchema(),this.deliverSchemaSet()}setSchemaFromJson(e){super.setSchemaFromJson(e),this.completeSchema(),this.deliverSchemaSet()}completeSchema(){for(var e=0;e<this._schema._fields.length;e++)this._schema._fields[e].setOpt("isKey",!1);var t;t=new n({name:"@opcode",espType:"utf8str",type:"string",isKey:!1,isNumber:!1,isDate:!1,isTime:!1}),this._schema._fields.unshift(t),this._schema._columns.unshift(t.getOpt("name")),this._schema._fieldMap[t.getOpt("name")]=t,t=new n({name:"@timestamp",espType:"timestamp",type:"date",isKey:!1,isNumber:!0,isDate:!1,isTime:!0}),this._schema._fields.unshift(t),this._schema._columns.unshift(t.getOpt("name")),this._schema._fieldMap[t.getOpt("name")]=t,t=new n({name:"@counter",espType:"int32",type:"int",isKey:!0,isNumber:!0,isDate:!1,isTime:!1}),this._schema._fields.unshift(t),this._schema._columns.unshift(t.getOpt("name")),this._schema._fieldMap[t.getOpt("name")]=t,this._schema._keyFields=[t]}events(e){if(this.getOpt("debug")&&(console.log("events for "+this._path),console.log(c.stringify(e))),0!=e.hasOwnProperty("entries")){var t=e.entries,r=[];if(null!=t){var s,n=this.getOpt("ignore_deletes",!1);for(var i of t){for(var o in s={},i)s[o]=i[o];if(0==s.hasOwnProperty("@opcode"))s["@opcode"]="insert";else if(n&&"delete"==s["@opcode"])continue;s["@key"]=this.getKey(s),r.push(s)}}this.process(r)}}eventsXml(e){this.getOpt("debug")&&(console.log("events for "+this._path),console.log(N.format(e)));for(var t,r,n,i,o,a,h=N.getNodes("//events/event",e),l=new Array,c=this.getOpt("ignore_deletes",!1),u=0;u<h.length;u++)if(null!=(n=(o=h[u]).getAttribute("opcode"))&&0!=n.length||(n="insert"),"delete"!=n||!c){(a={})["@opcode"]=n,s=o.getAttribute("timestamp"),null!=s&&s.length>0&&(a["@timestamp"]=s),r=N.getNodes("./*",o);for(var p=0;p<r.length;p++)i=r[p].getAttribute("type"),t=r[p].textContent,null!=i&&i.length,a[r[p].nodeName]=t;l.push(a)}this.process(l)}process(e){var t;for(var r of e){for(var s of(t={},this._schema._columns))r.hasOwnProperty(s)&&(t[s]=r[s]);t["@counter"]=this._counter,t["@key"]=this.getKey(t),t["@selected"]=!1,r["@counter"]=t["@counter"],r["@key"]=t["@key"],this._counter+=1,this._data.push(t)}var n=this.getOpt("maxevents",50),i=this._data.length-n;if(i>0)for(var o=0;o<i;o++)this._data.shift();this.deliverDataChange(e,!1)}info(e){}}class q extends n{constructor(e,t){super(t),this._api=e,this._connection=null;var r=I.getString("Project"),s=I.getString("Contquery"),n=I.getString("Window"),i=I.getString("CPU"),o=I.getString("Interval"),a=I.getString("Count"),h=new Array;h.push({name:"project",label:r,isKey:!0}),h.push({name:"contquery",label:s,isKey:!0}),h.push({name:"window",label:n,isKey:!0}),h.push({name:"cpu",label:i,type:"int"}),h.push({name:"interval",label:o,type:"int"}),h.push({name:"count",label:a,type:"int"}),Object.defineProperty(this,"api",{get(){return this._api}}),Object.defineProperty(this,"windows",{get(){return this._windows}}),Object.defineProperty(this,"memory",{get(){return this._memory}}),Object.defineProperty(this,"config",{get(){return this._config}}),this._windows=[],this._memory={},this._config={},this._delegates=[]}message(e){var t=N.createXml(e);this._windows=[];for(var r,s,n,i,o,a,h=N.getNodes(".//project",t),l=0;l<h.length;l++){n=h[l].getAttribute("name"),r=N.getNodes("./contquery",h[l]);for(var c=0;c<r.length;c++){i=r[c].getAttribute("name"),s=N.getNodes("./window",r[c]);for(var u=0;u<s.length;u++)o=s[u],(a=new Object).project=n,a.contquery=i,a.window=o.getAttribute("name"),a.cpu=new Number(o.getAttribute("cpu")),a.interval=new Number(o.getAttribute("interval")),a.count=new Number(o.getAttribute("count")),this._windows.push(a)}}this._windows.sort(this.sort),this._memory={};var p=N.getNode(".//server-memory",t);null!=p&&(this._memory.system=parseInt(N.getString("system",p)),this._memory.virtual=parseInt(N.getString("virtual",p)),this._memory.resident=parseInt(N.getString("resident",p))),this._config={};var d,f,g=N.getNodes(".//properties/property",t);if(g.length>0)for(var m of g)d=m.getAttribute("name"),f=N.nodeText(m),this._config[d]=!(f.length>0)||f;for(l=0;l<this._delegates.length;l++)this._delegates[l].handleStats(this)}process(e){}start(){if(null==this._connection){var e={};e.minCpu=this.getOpt("mincpu",5),e.counts=this.getOpt("counts",!0),e.config=this.getOpt("config",!0),e.memory=this.getOpt("memory",!0),e.format="xml";var t=this._api.getUrl("projectStats");this._connection=w.createDelegateConnection(this,t,e,this._api.connection._connect.config),this._connection.authorization=this._api._connection.authorization,this._connection.start()}}stop(){null!=this._connection&&(this._connection.stop(),this._connection=null)}sort(e,t){return t-e}optionSet(e,t){null!=this._delegates&&this._delegates.length>0&&this.set()}set(){}addDelegate(e){if(0==c.supports(e,"handleStats"))throw"The stats delegate must implement the handleStats method";c.addTo(this._delegates,e)&&1==this._delegates.length&&this.start()}removeDelegate(e){c.removeFrom(this._delegates,e)&&0==this._delegates.length&&this.stop()}getWindows(){return this._windows}getMemoryData(){return this._memory}getConfig(){return this._config}}class H{constructor(e){this._api=e,this._delegates=[],this._connection=null,this._filter=null,Object.defineProperty(this,"filter",{get(){return this._filter},set(e){this._filter=e;var t={logs:{}};t.logs.filter=this._filter,this._api.sendObject(t)}})}start(){if(null==this._connection){var e=this._api.getUrl("logs");this._connection=w.createDelegateConnection(this,e,null,this._api.connection._connect.config),this._connection.authorization=this._api._connection.authorization,this._connection.start()}}stop(){null!=this._connection&&(this._connection.stop(),this._connection=null)}message(e){var t,r,s={};if(s._timestamp=e.substr(0,19),-1!=(r=e.indexOf("["))&&-1!=(t=e.indexOf("]",r))){var n=(i=e.substring(r+1,t-1)).split(":");3==n.length&&(s.logLevel=n[0],s.messageFile=n[1],s.messageLine=n[2])}if(-1!=t&&(-1!=(r=e.indexOf("[",t+1))&&(t=e.indexOf("]",r+1)),-1!=t)){var i=e.substr(t+1);i=e.replace(this._newlines,"<br/>"),i=e.replace(this._spaces,"&nbsp;"),s.messageContent=i}this._delegates.forEach((e=>{e.handleLog(this,s)}))}addDelegate(e){if(0==c.supports(e,"handleLog"))throw"The stats delegate must implement the handleLog method";return c.addTo(this._delegates,e)&&1==this._delegates.length&&this.start(),!0}removeDelegate(e){c.removeFrom(this._delegates,e)&&0==this._delegates.length&&this.stop()}}class V extends n{constructor(e,t){super(t),this._api=e,this._path=this.getOpt("window"),this._id=this.getOpt("id",c.guid()),this._data=new Array,this._schema=new D,this._csv=null,Object.defineProperty(this,"schema",{get(){return this._schema}}),this._schemaDelegates=[]}open(){this.addOpts({});var e={schema:!0,format:"json"};this.hasOpt("dateformat")&&(e.dateformat=this.getOpt("dateformat"));var t=this._api.getUrl("publishers/"+this._path,e);this._connection=w.createDelegateConnection(this,encodeURI(t),e,this._api.connection._connect.config),this._connection.authorization=this._api._connection.authorization,this._connection.start()}close(){this._connection.stop(),this._connection=null}ready(){this.publish()}message(e){var t=JSON.parse(e);if(t.hasOwnProperty("schema")){var r,s={fields:[]};t.schema[0].fields.forEach((e=>{(r={})["@name"]=e.field.attributes.name,r["@type"]=e.field.attributes.type,e.field.attributes.hasOwnProperty("key")&&(r["@key"]=e.field.attributes.key),s.fields.push(r)})),this.setSchemaFromJson(s)}}addSchemaDelegate(e){if(0==c.supports(e,"schemaSet"))throw c.isNode?new Error("The datasource schema delegate must implement the schemaSet method"):"The datasource schema delegate must implement the schemaSet method";c.addTo(this._schemaDelegates,e)}removeSchemaDelegate(e){c.removeFrom(this._schemaDelegates,e)}setSchemaFromXml(e){this._schema.fromXml(e),this.deliverSchemaSet(),null!=this._csv&&this.csv()}setSchemaFromJson(e){this._schema.fromJson(e),this.deliverSchemaSet(),null!=this._csv&&this.csv()}deliverSchemaSet(){this.getOpt("debug")&&console.log("schema set for "+this+"\n"+this._schema.toString()),this._schemaDelegates.forEach((e=>{e.schemaSet(this,this._schema)}))}begin(){this._o=new Object}set(e,t){null!=this._o&&(this._o[e]=t)}end(){null!=this._o&&(this._data.push(this._o),this._o=new Object)}add(e){if(Array.isArray(e))for(var t of e)this._data.push(e);else this._data.push(e)}publish(){if(0!=this._connection.isConnected()&&this._data.length>0){var e=[];e.push(this._data),this._connection.sendObject(e),this._data=new Array}}send(e){if(this._csv.index<this._csv.items.length){this.add(this._csv.items[this._csv.index]),this.publish(),this._csv.index++;var t=this._csv.options.getOpt("pause",0);t>0&&(e=this,setTimeout((function(){e.send()}),t))}}csv(){if(0!=this._schema.size){this._csv.items=this._schema.createDataFromCsv(this._csv.data,this._csv.options.getOpts());var e=this._csv.options.getOpt("pause",0),t=this._csv.options.getOpt("opcode","insert");if(e>0){var r=this;setTimeout((function(){r.send()}),e)}else{for(var s of this._csv.items)s.opcode=s.hasOwnProperty("@opcode")?s["@opcode"]:t,this.add(s),this.publish();this._csv.options.getOpt("close",!1)&&this.close()}}}publishCsvFrom(e,t){var r=this;R.create("load",e,{response:function(e,s,n){r.publishCsv(s,t)},error:function(e,t){console.log("error: "+t)}}).get()}publishCsv(e,t){this._csv={data:e,options:new n(t),index:0},0!=this._schema.size&&this.csv()}isBinary(){return!1}}class W{constructor(e,t){this._api=e,this._delegate=t}deliver(e){if(c.supports(this._delegate,"guidsLoaded")){for(var t=[],r=N.getNodes("./guid",e),s=0;s<r.length;s++)t.push(N.nodeText(r[s]));this._delegate.guidsLoaded(t,this._api)}}}class G{constructor(e,t){this._api=e,this._delegate=t,this._eventsources={},this._running=!1,this._paused=!1,this._restart=!1,this._config=null,Object.defineProperty(this,"connect",{get(){return this._api.connect}}),Object.defineProperty(this,"running",{get(){return this._running}}),Object.defineProperty(this,"configuration",{get(){return this._config}}),Object.defineProperty(this,"paused",{get(){return this._paused},set(e){this._paused=e}}),this._api.connection.addDelegate(this)}ready(e){this._restart&&(this._restart=!1,this.start())}closed(e){Object.values(this._eventsources).forEach((e=>{e.reset()})),this._restart=!0}configure(e,t){this._config=e;var r=e.hasOwnProperty("nodeType")?N.xmlString(e):e;null!=t&&(r=new n(t).resolve(r));var s=N.createXml(r).documentElement;N.getNodes("./event-sources/*",s).forEach((e=>{var t=e.hasAttribute("name")?e.getAttribute("name"):"",r=e.hasAttribute("window")?e.getAttribute("window"):"";0!=t.length&&0!=r.length||c.exception("you must specify name and window for each event source");var s=e.tagName,n={name:t,window:r},i=null;"url-event-source"==s?i=new X(this,n):"code-event-source"==s?i=new Y(this,n):"csv-event-source"==s&&(i=new K(this,n)),null==i&&c.exception("failed to create event source from \n\n"+N.xmlString(e)+"\n"),this.addEventSource(i),i.configure(e)})),N.getNodes("./edges/edge",s).forEach((e=>{var t=e.getAttribute("source").split(" "),r=e.getAttribute("target").split(" ");t.forEach((e=>{r.forEach((t=>{this.addEdge(e,t)}))}))}))}configureFromUrl(e,t,r){var s=this,i=new n(t),o=i.getOptAndClear("start",!1);R.create("request",e,{response:function(e,t,n){s.configure(t,i.getOpts()),o&&s.start(),null!=r&&c.supports(r,"ready")&&r.ready(s)},error(e,t){console.log("error: "+t)}}).get()}createEventSource(e){var t=new n(e),r=t.getOpt("type",""),s=t.getOpt("name",""),i=t.getOpt("window","");0!=r.length&&0!=s.length&&0!=i.length||c.exception("you must specify type, name and window for each event source");var o=null;return e={name:s,window:i},"url"==r?o=new X(this,e):"code"==r?o=new Y(this,e):"csv"==r&&(o=new K(this,e)),null==o&&c.exception("invalid event source type: "+r),o.setOpts(t.getOpts()),this.addEventSource(o),o}addEventSource(e){"name"in e==0&&c.exception("the event source must have a name property"),this._eventsources.hasOwnProperty(e.name)&&c.exception("event source "+e.name+" already exists"),this._eventsources[e.name]=e}addEdge(e,t){var r=this.getEventSource(e);null==r&&c.exception("cannot find event source "+e);var s=this.getEventSource(t);null==s&&c.exception("cannot find event source "+t),s._sources.push(r)}getEventSource(e){return this._eventsources.hasOwnProperty(e)?this._eventsources[e]:null}togglePause(){return this._paused=!this._paused,this._paused}start(){Object.values(this._eventsources).forEach((e=>{e.init()})),this._running=!0;var e=this;setTimeout((function(){e.run()}),1e3)}run(){if(this._paused){var e=this;setTimeout((function(){e.run()}),1e3)}else{var t=new Date,r=(e=[],!1),s=5e3,n=0;Object.values(this._eventsources).forEach((i=>{if(i.repeat>=0&&0==i.done){if(0==i.sending)if(i.checkDependencies()){var o=t.getTime()-i.timestamp,a=i.interval;o>a?(a<s&&(s=a),e.push(i)):(o=t.getTime()-i.timestamp+a)<s&&(s=o)}else r=!0}else n++})),e.forEach((e=>{e.repeat>=0&&e.process()})),n==Object.keys(this._eventsources).length?(this._running=!1,c.supports(this._delegate,"complete")&&(e=this,setTimeout((function(){e._delegate.complete(e)}),1e3))):(e=this,setTimeout((function(){e.run()}),r?1e3:s))}}publish(e,t){0==this._eventsources.hasOwnProperty(e)&&c.exception("cannot find event source "+e),this._eventsources[e].process(t)}}class z extends n{constructor(e,t){super(t),this._window=this.getOpt("window"),null==this._window&&c.exception("no window specified"),Object.defineProperty(this,"esp",{get(){return this._eventsources.connect}}),Object.defineProperty(this,"tools",{get:()=>c}),this._eventsources=e,this._api=e._api,this._ready=!1,this._done=!1,this._sources=[],this._times=0,this._timestamp=0,this._senders=[],this._publisher=null,Object.defineProperty(this,"publisher",{get(){return this._publisher}}),Object.defineProperty(this,"repeat",{get(){return this.getOpt("repeat","1")}}),this._interval=3e4,Object.defineProperty(this,"interval",{get(){return this._interval},set(e){var t=e.split(" "),r=(e=parseFloat(t[0]),2==t.length?t[1]:"milliseconds");"second"==r||"seconds"==r?e*=1e3:"minute"==r||"minutes"==r?e*=6e4:"hour"!=r&&"hours"!=r||(e*=36e5),this._interval=e}}),Object.defineProperty(this,"timestamp",{get(){return this._timestamp},set(e){this._timestamp=e}}),Object.defineProperty(this,"name",{get(){return this.getOpt("name","")},set(e){this.setOpt("name",e)}}),Object.defineProperty(this,"done",{get(){return this._done&&0==this.sending},set(e){this._done=e}}),Object.defineProperty(this,"sending",{get(){return this._senders.length>0}})}configure(e){var t=null;t="nodeType"in e==0?N.createXml(e).documentElement:e,N.getNodes("./options/option",t).forEach((e=>{var t=e.getAttribute("name"),r=N.nodeText(e);this.setOpt(t,r),"interval"==t&&(this.interval=r)}))}init(){this._times=0,this._timestamp=0,this.done=!1,this.checkCycles();var e={window:this._window};this.hasOpt("dateformat")&&(e.dateformat=this.getOpt("dateformat")),this._api.version<7&&(e.format="json"),this._publisher=this._api.getPublisher(e),this._publisher.addSchemaDelegate(this)}reset(){this._times=0,this._timestamp=0,this._senders=[],this._publisher=null}schemaSet(e,t){this._ready=!0}send(e){new J(this,e).run()}dependsOn(e){var t=!1;for(var r of this._sources)if(r==e||r.dependsOn(e)){t=!0;break}return t}checkCycles(){for(var e of this._sources)e.dependsOn(this)&&c.exception("cyclical dependency detected on "+e.name+" to "+this.name),e.checkCycles()}checkDependencies(){var e=!0;for(var t of this._sources){if(0==t.done){e=!1;break}if(0==t.checkDependencies()){e=!1;break}}return e}process(e){this.run(e)&&(this._timestamp=(new Date).getTime(),this._times++,this.repeat>0&&this._times>=this.repeat&&(this._done=!0))}run(e){return!1}}class X extends z{constructor(e,t){super(e,t),this._transform=null,Object.defineProperty(this,"transform",{get(){return this._transform},set(e){this._transform=e}})}configure(e){z.prototype.configure.call(this,e),this.hasOpt("transform")&&(this._transform=new Function("eventsource","data",this.getOpt("transform")))}init(){super.init(this),null==this._transform&&c.exception("you must specify the transform value for the UrlEventSource"),0==this.hasOpt("url")&&0==this.hasOpt("url-func")&&c.exception("you must specify the either a url or a url function value for the UrlEventSource")}run(e){var t=!1,r=null;if(this.hasOpt("url")?r=this.getOpt("url"):this.hasOpt("url-func")&&(r=new Function(this.getOpt("url-func"))()),null!=r){null!=e&&(r=new n(e).resolve(r));var s=this;if(this._api.version>7&&this.getOpt("use-connect",!1)){var i={response:function(e){var t=s._transform(s,e);null!=t&&s.send(t)},error(e,t){console.log("error: "+t)}};this._api.get(r,i)}else R.create("request",r,i={response:function(e,t,r){var n=s._transform(s,t);null!=n&&s.send(n)},error(e,t){console.log("error: "+t)}}).get();t=!0}return t}}class K extends z{constructor(e,t){super(e,t),this._data=null,this._filter=null,this._supplement=null}init(){if(super.init(),0==this.hasOpt("csv")&&0==this.hasOpt("url")&&c.exception("you must specify CSV data for the event source with either the csv or url option"),this.hasOpt("csv"))this._data=this.getOpt("csv");else{var e=this,t={response:function(t,r){e._data=r},error:function(t,r){console.log("error: "+e.getOpt("url")+" "+r)}};R.create("load",this.getOpt("url"),t).get()}this.hasOpt("filter")&&(this._filter=new Function("o",this.getOpt("filter"))),this.hasOpt("supplement")&&(this._supplement=new Function("o",this.getOpt("supplement")))}run(e){var t=!1;if(this._publisher.schema.size>0&&null!=this._data){t=!0;var r={};null!=this._filter&&(r.filter=this._filter),null!=this._supplement&&(r.supplement=this._supplement);var s=this.clone();s.delegate=r;var n=this.publisher._schema.createDataFromCsv(this._data,s);this.send(n)}return t}}class Y extends z{constructor(e,t){super(e,t),this._code=null}configure(e){super.configure(e),this.hasOpt("code")&&(this._code=new Function("esp","publisher",this.getOpt("code")))}init(){super.init(),null==this._code&&c.exception("you must specify the code value for the UrlEventSource")}run(e){return this._code(this._eventsources,this._publisher),!0}}class J{constructor(e,t){0==Array.isArray(t)&&c.exception("data must be an array"),this._eventsource=e,this._data=t,this._opcode=e.getOpt("opcode","upsert"),this._delay=e.getInt("delay",0),this._index=e.getInt("start",0),this._chunksize=e.getInt("chunk_size",1),c.addTo(this._eventsource._senders,this)}run(){if(null!=this._eventsource._publisher){var e=this._eventsource.getOpt("maxevents",0);if(0==e&&(e=this._data.length),0==this._delay)this._data.forEach((e=>{e.opcode=this._opcode,this._eventsource._publisher.add(e)})),this._eventsource._publisher.publish(),c.removeFrom(this._eventsource._senders,this);else if(this._index<e){var t=this;if(0==this._eventsource._eventsources.paused){for(var r=0;r<this._chunksize&&this._index<e;r++)this._data[this._index].opcode=this._opcode,this._eventsource._publisher.add(this._data[this._index]),this._index++;this._eventsource._publisher.publish(),setTimeout((function(){t.run()}),this._delay)}else setTimeout((function(){t.run()}),1e3)}else c.removeFrom(this._eventsource._senders,this)}else c.removeFrom(this._eventsource._senders,this)}}const $=new k;class Q extends n{constructor(e,t){super(t),this._connection=e,this._version,Object.defineProperty(this,"connection",{get(){return this._connection}}),Object.defineProperty(this,"connect",{get(){return this._connection.connect}}),Object.defineProperty(this,"version",{get(){return this._version},set(e){this._version=parseFloat(e)}}),Object.defineProperty(this,"protocol",{get(){return this._connection.protocol}}),Object.defineProperty(this,"httpProtocol",{get(){return this._connection.httpProtocol}}),Object.defineProperty(this,"host",{get(){return this._connection.host}}),Object.defineProperty(this,"port",{get(){return this._connection.port}}),Object.defineProperty(this,"isSecure",{get(){return this._connection.isSecure}}),Object.defineProperty(this,"url",{get(){return this._connection.url}}),Object.defineProperty(this,"httpurl",{get(){return this._connection.httpurl}}),Object.defineProperty(this,"k8s",{get(){return this.getOpt("k8s")}}),this._closed=!1,Object.defineProperty(this,"closed",{get(){return this._closed},set(e){this._closed=e}}),this.init()}init(){this._datasources={},this._publishers={},this._stats=new re(this),this._log=new se(this),this._modelDelegates={},this._publisherDelegates={},this._guidDelegates={},this._loadDelegates={},this._deleteDelegates={},this._responseDelegates={},this._projectUpdateDelegates=[],this._gets={}}versionGreaterThan(e){return this._version>e}versionLessThan(e){return this._version<e}stop(){this._connection.stop()}closed(){}close(){this.closed=!0;var e={connection:{}};e.connection.action="close",this.sendObject(e)}send(e){this._connection.send(e)}sendObject(e){this._connection.sendObject(e)}sendBinary(e){this._connection.sendBinary(e)}message(e){if(0!=e.length){for(var t=null,r=null,s=0;s<e.length;s++){if("{"==e[s]||"["==e[s]){r=JSON.parse(e);break}if("<"==e[s]){t=N.createXml(e);break}}null!=r?this.processJson(r):null!=t&&this.processXml(t,e)}}data(e){this.processJson(e)}processJson(e){if(this.getOpt("debug",!1)&&console.log(c.stringify(e)),e.hasOwnProperty("events")){if((h=e.events).hasOwnProperty("@id")){var t=h["@id"];null!=(r=this._datasources[t])&&r.events(h)}}else if(e.hasOwnProperty("info")){var r;if((h=e.info).hasOwnProperty("@id"))t=h["@id"],null!=(r=this._datasources[t])&&h.hasOwnProperty("page")&&(r._page=parseInt(h.page),r._pages=parseInt(h.pages),r.deliverInfoChange())}else if(e.hasOwnProperty("schema"))t=(h=e.schema)["@id"],this._datasources.hasOwnProperty(t)?this._datasources[t].setSchemaFromJson(h):this._publishers.hasOwnProperty(t)&&this._publishers[t].setSchemaFromJson(h);else if(e.hasOwnProperty("load-project")||e.hasOwnProperty("load-router")){if(t=(h=e.hasOwnProperty("load-project")?e["load-project"]:e["load-router"])["@id"],this._loadDelegates.hasOwnProperty(t)){var s=this._loadDelegates[t];if(0==h["@code"]){if(c.supports(s.delegate,"loaded")){var n=e.hasOwnProperty("load-project")?s.request.project.name:s.request.router.name;s.delegate.loaded(this,n)}}else{var i="";if(h.hasOwnProperty("text")&&(i+=h.text),h.hasOwnProperty("details")){var o=h.details;for(var a of o)i+="\n",i+=a.detail}c.supports(s.delegate,"error")?s.delegate.error(this,s.request.name,i):console.log(i)}delete this._loadDelegates[t]}}else if(e.hasOwnProperty("delete-project"))t=(h=e["delete-project"])["@id"],this._deleteDelegates.hasOwnProperty(t)&&(s=this._deleteDelegates[t],0==h["@code"]?c.supports(s.delegate,"deleted")&&s.delegate.deleted(this,s.request.project.name):this.handleError(s.request.project.name,s.delegate),delete this._deleteDelegates[t]);else if(e.hasOwnProperty("stats")){var h=e.stats;this._stats.processJson(h)}else if(e.hasOwnProperty("response")){t=(h=e.response)["@id"];var l=this._gets[t];if(null!=l&&(delete this._gets[t],h.hasOwnProperty("data"))){var u=l.delegate,p=l.options;if(c.supports(u,"response")){var d=h.data;p.getOpt("decode",!0)&&(d=c.b64Decode(d)),u.response(d)}}}else if(e.hasOwnProperty("url-publisher")||e.hasOwnProperty("data-publisher"))t=(h=e.hasOwnProperty("url-publisher")?e["url-publisher"]:e["data-publisher"])["@id"],this._publisherDelegates.hasOwnProperty(t)&&((h=this._publisherDelegates[t]).delegate.publishComplete(h.request.url),delete this._publisherDelegates[t]);else if(e.hasOwnProperty("loggers")){if(t=(h=e.loggers)["@id"],this._responseDelegates.hasOwnProperty(t)){var f=h.contexts;this._responseDelegates[t].deliver(f),delete this._responseDelegates[t]}}else(e.hasOwnProperty("project-loaded")||e.hasOwnProperty("project-removed"))&&(e.hasOwnProperty("project-loaded")?(n=(h=e["project-loaded"]).name,this._projectUpdateDelegates.forEach((e=>{e.projectLoaded(n)}))):(n=(h=e["project-removed"]).name,this._projectUpdateDelegates.forEach((e=>{e.projectRemoved(n)}))))}processXml(e,t){var r=e.documentElement,s=r.nodeName;if(this.getOpt("debug",!1)&&console.log(N.format(e.documentElement)),"events"==s||"info"==s){var n=r.getAttribute("id");if(this._datasources.hasOwnProperty(n)){var i=this._datasources[n];"events"==s?i.eventsXml(r):"info"==s&&i.info(r)}}else if("schema"==s)r.hasAttribute("id")?(n=r.getAttribute("id"),this._datasources.hasOwnProperty(n)&&this._datasources[n].setSchemaFromXml(r)):r.hasAttribute("publisher")&&(n=r.getAttribute("publisher"),this._publishers.hasOwnProperty(n)&&this._publishers[n].setSchemaFromXml(r));else if("stats"==s)this._stats.processXml(e);else if("log"==s)this._log.process(e);else if("model"==s)n=r.getAttribute("id"),this._modelDelegates.hasOwnProperty(n)&&(this._modelDelegates[n].deliver(e),delete this._modelDelegates[n]);else if("url-publisher"==s){if(n=r.getAttribute("id"),this._publisherDelegates.hasOwnProperty(n)){var o=this._publisherDelegates[n];o.delegate.publishComplete(o.request.url),delete this._publisherDelegates[n]}}else if("guids"==s)n=r.getAttribute("id"),this._guidDelegates.hasOwnProperty(n)&&(this._guidDelegates[n].deliver(r),delete this._guidDelegates[n]);else if("publisher"==s){if(n=r.getAttribute("id"),this._publishers.hasOwnProperty(n)){var a=this._publishers[n];"true"==r.getAttribute("complete")&&(a._complete=!0)}}else if("load-project"==s||"load-router"==s){if(n=r.getAttribute("id"),this._loadDelegates.hasOwnProperty(n)){var h=this._loadDelegates[n];if(0==parseInt(r.getAttribute("code")))c.supports(h.delegate,"loaded")&&h.delegate.loaded(this,h.request.name);else if(c.supports(h.delegate,"error")){var l=N.getString("text",r);h.delegate.error(this,h.request.name,l)}delete this._loadDelegates[n]}}else if("xml"==s){if(n=r.getAttribute("id"),this._responseDelegates.hasOwnProperty(n)){var u=e,p=t;0==parseInt(r.getAttribute("code"))&&(u=N.getNode(".//project",e),p=N.format(u)),this._responseDelegates[n].deliver(p,u),delete this._responseDelegates[n]}}else"connection"==s&&console.log(N.format(r))}addProjectUpdateDelegate(e){if(0!=c.supports(e,"projectLoaded")&&0!=c.supports(e,"projectRemoved")||c.exception("The project update delegate must implement the projectLoaded and projectRemoved methods"),c.addTo(this._projectUpdateDelegates,e)&&1==this._projectUpdateDelegates.length){var t={"project-status":{}};t["project-status"].on=!0,this.sendObject(t)}}removeProjectUpdateDelegate(e){if(c.removeFrom(this._projectUpdateDelegates,e)&&0==this._projectUpdateDelegates.length){var t={"project-status":{}};t["project-status"].on=!1,this.sendObject(t)}}getDatasource(e){var t=new n(e),r="stream";return t.hasOpt("mode")&&(r=t.getOpt("mode")),"collection"==r?this.getEventCollection(t.getOpts()):this.getEventStream(t.getOpts())}getEventCollection(e){e.mode="collection";var t=new ee(this,e);return this._datasources[t._id]=t,t.open(),t}getEventStream(e){var t=new te(this,e);return this._datasources[t._id]=t,t.open(),t}getPublisher(e){if(e.hasOwnProperty("id")){var t=e.id;if(this._publishers.hasOwnProperty(t))return this._publishers[t]}var r=new ne(this,e);return this._publishers[r._id]=r,r.open(),r}closePublisher(e){this._publishers.hasOwnProperty(e)&&this._publishers[e].close()}clearWindow(e){var t={"clear-window":{}};t["clear-window"].window=e,this.sendObject(t)}publishDataFrom(e,t,r,s){var n=this;R.create("load",t,{response:function(t,i,o){n.publishData(e,i,r,s)},error:function(e,t){console.log("error: "+t)}}).get()}publishData(e,t,r,s){var i=new n(s),o=i.getOpt("blocksize",1),a=i.getOpt("times",1),h=i.getOpt("pause",0),l=i.getOpt("id",c.guid()),u={},p={"data-publisher":{}};if((u=p["data-publisher"]).id=l,u.window=e,u.data=c.b64Encode(t),u.blocksize=o,u.times=a,u.pause=h,u.informat=i.getOpt("informat","csv"),i.hasOpt("dateformat")&&(u.dateformat=i.getOpt("dateformat")),null!=r){if(0==c.supports(r,"publishComplete"))throw"The publisher delegate must implement the publishComplete method";this._publisherDelegates[l]={request:u,delegate:r}}this.sendObject(p)}publishUrl(e,t,r,s){var i=new n(s),o=i.getOpt("blocksize",1),a=i.getOpt("times",1),h={},l=c.guid(),u={"url-publisher":{}};if((h=u["url-publisher"]).id=l,h.window=e,h.url=t,h.blocksize=o,h.times=a,i.hasOpt("informat")&&(h.informat=i.getOpt("informat")),i.hasOpt("dateformat")&&(h.dateformat=i.getOpt("dateformat")),null!=r){if(0==c.supports(r,"publishComplete"))throw"The url publisher delegate must implement the publishComplete method";this._publisherDelegates[l]={request:h,delegate:r}}this.sendObject(u)}getStats(e){return null!=e&&this._stats.setOpts(e),this._stats}getLog(){return this._log}get(e,t,r){var s={get:{}},i=s.get,o=c.guid();i.id=o,i.url=e,i.format="ubjson";var a={};a.delegate=t,a.options=new n(r),this._gets[o]=a,this.sendObject(s)}loadModel(e,t){if(0==c.supports(e,"modelLoaded"))throw"The delegate must implement the modelLoaded method";var r=c.guid(),s=new n(t),i={model:{}},o=i.model;o.id=r,o.schema=s.getOpt("schema",!1),o.index=s.getOpt("index",!0),o.xml=s.getOpt("xml",!1),s.hasOpt("name")&&(o.name=s.getOpt("name")),this._modelDelegates[r]=new ie(this,e,i)}loadUrl(e,t,r){R.create("load",t,{response:function(t,s,n){c.supports(r,"loaded")&&r.loaded(e,s,n)},error:function(t,s){c.supports(r,"error")&&r.error(e,text)}}).get()}loadProjectFrom(e,t,r,s){var n=this;R.create("load",t,{response:function(t,i,o){n.loadProject(e,i,r,s)},error:function(e,t){console.log("error: "+t)}}).get()}loadRouterFrom(e,t,r,s){var n=this;R.create("load",t,{response:function(t,i,o){n.loadRouter(e,i,r,s)},error:function(e,t){console.log("error: "+t)}}).get()}loadProject(e,t,r,s){if(null!=this.k8s)this.k8s.load(t,r);else{var n=c.guid(),i={project:{}},o=i.project;if(o.name=e,o.id=n,o.action="load",null!=s)for(var a in s)o[a]=s[a];o.data=c.b64Encode(t),this._loadDelegates[n]={connection:this,request:i,delegate:r},this.sendObject(i)}}loadRouter(e,t,r,s){var n=c.guid(),i={router:{}},o=i.router;if(o.name=e,o.id=n,o.action="load",null!=s)for(var a in s)o[a]=s[a];o.data=c.b64Encode(t),this._loadDelegates[n]={connection:this,request:i,delegate:r},this.sendObject(i)}deleteProject(e,t){if(null!=this.k8s)this.k8s.del(t);else{var r=c.guid(),s=(this.url,{project:{}}),n=s.project;n.name=e,n.id=r,n.action="delete",null!=t&&(this._deleteDelegates[r]={connection:this,request:s,delegate:t}),this.sendObject(s)}}getProjectXml(e,t,r){var s=c.guid();this._responseDelegates[s]=new oe(this,t);var n={xml:{}},i=n.xml;if(i.id=s,null!=e&&(i.name=e),null!=r)for(var o in r)i[o]=r[o];this.sendObject(n)}getXml(e,t){this.getProjectXml(null,t)}getLoggers(e){if(0==c.supports(e,"response"))throw"The delegate must implement the response method";var t=c.guid();this._responseDelegates[t]=new oe(this,e);var r={loggers:{}};r.loggers.id=t,this.sendObject(r)}setLogger(e,t,r){var s=c.guid();null!=r&&(this._responseDelegates[s]=new oe(this,r));var n={loggers:{}},i=n.loggers;i.id=s,i.context=e,i.level=t,this.sendObject(n)}createModel(e){return new j(e)}loadGuids(e,t){if(0==c.supports(e,"guidsLoaded"))throw"The stats delegate must implement the guidsLoaded method";var r=c.guid();this._guidDelegates[r]=new ae(this,e);var s={guids:{}},n=s.guids;n.id=r,null!=t&&(n.num=t),this.sendObject(s)}guid(){return c.guid()}getStatus(){this.sendObject({request:"status"})}createEventSources(e){return function(e,t){return new G(e,t)}(this,e)}handleError(e,t){var r="";if(e.hasOwnProperty("text")&&(r+=e.text),e.hasOwnProperty("details")){var s=e.details;for(var n of s)r+="\n",r+=n.detail}c.supports(t,"error")?t.error(r):console.log(r)}toString(){return""+this._connection.getUrl()}}class Z extends n{constructor(e,t){super(t),this._api=e,this._id=this.getOpt("id",c.guid()),this._path=this.getOpt("window"),this._schema=new D,this._schema.addDelegate(this),Object.defineProperty(this,"id",{get(){return this._id}}),Object.defineProperty(this,"api",{get(){return this._api}}),Object.defineProperty(this,"schema",{get(){return this._schema}}),Object.defineProperty(this,"name",{get(){var e=this.getOpt("name","");return 0==e.length&&(e=this.getOpt("window")),e},set(e){this.setOpt("name",e)}}),Object.defineProperty(this,"size",{get(){var e=0;return null!=this._data&&(e=Array.isArray(this._data)?this._data.length:Object.keys(this._data).length),e}}),this._data=null,this._list=null,this._delegates=[],this._schemaDelegates=[],this._paused=!1}schemaLoaded(){this._delegates.forEach((e=>{c.supports(e,"schemaReady")&&e.schemaReady(this._api,this)}))}isArray(){return null!=this._data&&Array.isArray(this._data)}setIntervalProperty(){var e=null;this.hasOpt("interval")?e=this.getOpt("interval"):this._api.hasOpt("interval")&&(e=this._api.getOpt("interval")),null==e&&(e=0),this.setOpt("interval",e)}setFilter(e){this.setOpt("filter",e),this.set(!0),this.deliverFilterChange()}clearFilter(){this.clearOpt("filter"),this.set(!0),this.deliverFilterChange()}getFilter(){return this.getOpt("filter")}play(){this._paused=!1}pause(){this._paused=!0}togglePlay(){var e=!1;return this._paused?(this.play(),e=!0):this.pause(),e}setSchemaFromXml(e){this._schema.fromXml(e)}setSchemaFromJson(e){this._schema.fromJson(e,this)}getKey(e){var t,r="";return this._schema._keyFields.forEach((s=>{t=s.getOpt("name"),0!=e.hasOwnProperty(t)&&(r.length>0&&(r+="-"),r+=e[t])})),r}isSelected(e){return null!=e&&e.hasOwnProperty("@selected")&&1==e["@selected"]}toggleSelectedKeys(e,t){var r;t&&this.deselectAll(),e.forEach((e=>{null!=(r=this.getDataByKey(e))&&this.toggleSelected(r)})),this.deliverSelectionChange(null,!1)}toggleSelected(e){return e.hasOwnProperty("@selected")?e["@selected"]=!e["@selected"]:e["@selected"]=!1,e["@selected"]}deselectAll(){Array.isArray(this._data)?this._data.forEach((e=>{e["@selected"]=!1})):Object.values(this._data).forEach((e=>{e["@selected"]=!1}))}setSelectedIndices(e,t){t&&this.deselectAll();var r=this.getList();e.forEach((e=>{e<r.length&&(r[e]["@selected"]=!0)})),this.deliverSelectionChange(null,!1)}toggleSelectedIndices(e,t){t&&this.deselectAll();var r=this.getList();e.forEach((e=>{e<r.length&&this.toggleSelected(r[e])})),this.deliverSelectionChange(null,!1)}selectByKeys(e){this.deselectAll(),e.forEach((e=>{console.log("key: "+e)}))}getSelectedItems(){var e=[];return this.getList().forEach((t=>{this.isSelected(t)&&e.push(t)})),e}getSelectedIndices(){var e=[],t=0;return this.getList().forEach((r=>{this.isSelected(r)&&e.push(t),t++})),e}getSelectedKeys(){var e=[];return this.getList().forEach((t=>{this.isSelected(t)&&e.push(t["@key"])})),e}getSelectedItem(){var e=this.getSelectedItems();return e.length>0?e[0]:null}getSelectedIndex(){var e=this.getSelectedIndices();return e.length>0?e[0]:null}getSelectedKey(){var e=this.getSelectedKeys();return e.length>0?e[0]:null}getKeyValues(){var e=[];if(Array.isArray(this._data))for(var t of this._data)e.push(t["@key"]);else for(var r in this._data)e.push(r);return e}getList(){var e=null;if(null!=this._data)if(Array.isArray(this._data))e=this._data;else if(null!=this._list)e=this._list;else for(var t in e=[],this._data)e.push(this._data[t]);return e}getValues(e){var t=this._schema.getField(e);if(null==t)return null;var r,s=[],n=t.getOpt("isNumber",!1);if(Array.isArray(this._data)||null!=this._list)(null!=this._list?this._list:this._data).forEach((t=>{t.hasOwnProperty(e)?n?s.push(parseFloat(t[e])):s.push(t[e]):n?s.push(0):s.push("")}));else for(var i in this._data)(r=this._data[i]).hasOwnProperty(e)?n?s.push(parseFloat(r[e])):s.push(r[e]):n?s.push(0):s.push("");return s}getLimits(e){var t=null,r=this.getValues(e);return r.length>0&&(t={min:Math.min.apply(Math,r),max:Math.max.apply(Math,r),values:r}),t}getValuesBy(e,t,r,s="."){if(0==this.schema.size)return null;var n,i={},o=[];for(var a of e){if(null==(n=this._schema.getField(a)))throw"field "+a+" not found";null!=r&&r.hasOwnProperty(n.getOpt("name"))||(o.push(n),i[n.getOpt("name")]=[])}var h=!1,l=!1;1==o.length&&((n=o[0]).getOpt("isDate",!1)?h=!0:n.getOpt("isTime",!1)&&(l=!0));var c=[];for(var a of t){if(null==(n=this._schema.getField(a)))throw"field "+a+" not found";c.push(n)}var u=this.getList();if(null==u)throw"invalid data";var p,d,f,g,m={};for(var _ of u){if(null!=r){var v=!0;for(var y in r)if(r[y]!=_[y]){v=!1;break}if(0==v)continue}if(g="",o.forEach((e=>{f=e.getOpt("name"),_.hasOwnProperty(f)&&(p=_[f],g.length>0&&(g+=s),g+=p,0==i[f].includes(p)&&i[f].push(p))})),m.hasOwnProperty(g))d=m[g];else{for(n of(d={},c))f=n.getOpt("name"),d[f]=0;m[g]={key:g,data:d,selected:this.isSelected(_)}}for(n of c)n.getOpt("isNumber",!1)&&(f=n.getOpt("name"),d[f]+=parseFloat(_[f]))}var b={};for(n of c)f=n.getOpt("name"),b[f]=[];var w=[],O=[];return Object.values(m).forEach((e=>{if(g=e.key,d=e.data,h){var t=new Date,r=1e3*new Number(g);t.setTime(r),w.push(t)}else l?(t=new Date,r=new Number(g)/1e3,t.setTime(r),w.push(t)):w.push(g);for(n of(O.push(e.selected),c))f=n.getOpt("name"),n.getOpt("isNumber",!1)?b[f].push(parseFloat(d[f])):b[f].push(d[f])})),{keys:w,keyvalues:i,values:b,selected:O}}getKeyFieldNames(){return null!=this._schema?this._schema.getKeyFieldNames():null}events(e){}info(e){}set(e){}addDelegate(e){0==c.supports(e,"dataChanged")&&c.exception("The datasource delegate must implement the dataChanged method"),c.addTo(this._delegates,e)}removeDelegate(e){c.removeFrom(this._delegates,e)}addSchemaDelegate(e){if(0==c.supports(e,"schemaSet"))throw c.isNode?new Error("The datasource schema delegate must implement the schemaSet method"):"The datasource schema delegate must implement the schemaSet method";c.addTo(this._schemaDelegates,e)}removeSchemaDelegate(e){c.removeFrom(this._schemaDelegates,e)}clear(){null!=this._data&&(Array.isArray(this._data),this._data=[]),this.deliverDataChange(null,!0)}deliverDataChange(e,t){this._delegates.forEach((r=>{r.dataChanged(this,e,t)}))}deliverInfoChange(){this._delegates.forEach((e=>{c.supports(e,"infoChanged")&&e.infoChanged(this)}))}deliverSchemaSet(){this.getOpt("debug")&&console.log("schema set for "+this+"\n"+this._schema.toString()),this._schemaDelegates.forEach((e=>{c.supports(e,"schemaSet")&&e.schemaSet(this,this._schema)}))}deliverInfo(e){this._delegates.forEach((t=>{c.supports(t,"info")&&t.info(this,e)}))}deliverFilterChange(){this._delegates.forEach((e=>{c.supports(e,"filterChanged")&&e.filterChanged(this)}))}deliverSelectionChange(){this._delegates.forEach((e=>{c.supports(e,"selectionChanged")&&e.selectionChanged(this)}))}getDataByKey(e){var t=null;if(null!=this._data)if(Array.isArray(this._data)){for(var r of this._data)if(e==r["@key"]){t=r;break}}else t=this._data[e];return t}createDataFromCsv(e){var t=null;return null!=this._schema&&(t=this._schema.createDataFromCsv(e)),t}}class ee extends Z{constructor(e,t){super(e,t),this.setOpt("format","ubjson"),this._data={},this._list=[],this._page=0,this._pages=0,this._sort=null,this._sortdir=0}open(){var e={"event-collection":{}},t=e["event-collection"];t.id=this._id,t.action="set",t.window=this._path,t.schema=!0,t.load=!0,t.info=5,t.format="xml",this.setIntervalProperty();var r=this.getOpts();for(var s in r)t[s]=r[s];0==this.hasOpt("filter")&&(t.filter=""),this._api.sendObject(e)}set(e){var t={"event-collection":{}},r=t["event-collection"];r.id=this._id,r.action="set",this.setIntervalProperty();var s=this.getOpts();for(var n in s)r[n]=s[n];0==this.hasOpt("filter")&&(r.filter=""),r.load=1==e,this._api.sendObject(t)}close(){var e={"event-collection":{}},t=e["event-collection"];t.id=this._id,t.action="close",this._api.sendObject(e)}play(){var e={"event-collection":{}},t=e["event-collection"];t.id=this._id,t.action="play",this._api.sendObject(e),super.play(this)}pause(){var e={"event-collection":{}},t=e["event-collection"];t.id=this._id,t.action="pause",this._api.sendObject(e),super.play(this)}sort(e,t){var r=parseFloat(e[this._sort]),s=parseFloat(t[this._sort]);return 0==this._sortdir?s-r:r-s}load(){this.loadPage(null)}first(){this.loadPage("first")}last(){this.loadPage("last")}prev(){this.loadPage("prev")}next(){this.loadPage("next")}loadPage(e){var t={"event-collection":{}},r=t["event-collection"];r.id=this._id,r.action="load",null!=e&&(r.page=e),this._api.sendObject(t)}setSchemaFromXml(e){super.setSchemaFromXml(e),this.deliverSchemaSet()}setSchemaFromJson(e){super.setSchemaFromJson(e),this.deliverSchemaSet()}events(e){if(this.getOpt("debug")&&(console.log("events for "+this._path),console.log(c.stringify(e))),0!=e.hasOwnProperty("entries")){var t,r=[],s=e.entries;null!=s&&s.forEach((e=>{for(var s in t={},e)t[s]=e[s];0==t.hasOwnProperty("@opcode")&&(t["@opcode"]="insert"),t["@key"]=this.getKey(t),r.push(t)}));var n=e.hasOwnProperty("info")?e.info:null;this.process(r,null!=n),null!=n&&this.info(n)}}eventsXml(e){this.getOpt("debug")&&(console.log("events for "+this._path),console.log(N.format(e)));var t,r,s,n,i=[];N.getNodes("//entries/event",e),N.getNodes("//entries/event",e).forEach((e=>{null!=(s=e.getAttribute("opcode"))&&0!=s.length||(s="insert"),o={},o["@opcode"]=s,null!=(n=e.getAttribute("timestamp"))&&n.length>0&&(o["@timestamp"]=n),N.getNodes("./*",e).forEach((function(e){t=e.getAttribute("type"),r=e.textContent,null!=t&&t.length>0?o[e.nodeName]="_data://"+t+":"+r:o[e.nodeName]=r})),o["@key"]=this.getKey(o),i.push(o)}));var a=e.hasAttribute("page");this.process(i,a),a&&this.info(e)}info(e){e.hasOwnProperty("page")&&(this._page=e.page,this._pages=e.pages,this.deliverInfoChange())}process(e,t){var r,s,n=null;t&&(n=this.getSelectedKeys(),this._data={},this._list=[]),e.forEach((e=>{null!=(r=e["@key"])&&("delete"==e["@opcode"]?this._data.hasOwnProperty(r)&&(c.removeFrom(this._list,this._data[r]),delete this._data[r]):t?((s={})["@key"]=r,this._data[r]=s,this._list.push(s),s["@selected"]=n.includes(r),this._schema._columns.forEach((t=>{e.hasOwnProperty(t)&&(s[t]=e[t])}))):(this._data.hasOwnProperty(r)?(s=this._data[r],c.setItem(this._list,s)):((s={})["@key"]=r,s["@selected"]=!1,this._data[r]=s,this._list.push(s)),this._schema._columns.forEach((t=>{e.hasOwnProperty(t)&&(s[t]=e[t])}))))})),this.deliverDataChange(e,t)}}class te extends Z{constructor(e,t){super(e,t),this.setOpt("format","ubjson"),this._data=[],this._counter=1}open(){var e={"event-stream":{}},t=e["event-stream"];t.id=this._id,t.action="set",t.window=this._path,t.schema=!0,t.load=!0,t.format="xml",this.setIntervalProperty();var r=this.getOpts();for(var s in r)t[s]=r[s];0==this.hasOpt("filter")&&(t.filter=""),this._api.sendObject(e)}set(e){var t={"event-stream":{}},r=t["event-stream"];r.id=this._id,r.action="set",this.setIntervalProperty();var s=this.getOpts();for(var n in s)r[n]=s[n];0==this.hasOpt("filter")&&(r.filter=""),r.load=1==e,this._api.sendObject(t)}close(){var e={"event-stream":{}},t=e["event-stream"];t.id=this._id,t.action="close",this._api.sendObject(e)}play(){var e={"event-stream":{}},t=e["event-stream"];t.id=this._id,t.action="play",this._api.sendObject(e),super.play(this)}pause(){var e={"event-stream":{}},t=e["event-stream"];t.id=this._id,t.action="pause",this._api.sendObject(e),super.play(this)}setSchemaFromXml(e){super.setSchemaFromXml(e,this),this.deliverSchemaSet()}setSchemaFromJson(e){super.setSchemaFromJson(e),this.deliverSchemaSet()}completeSchema(e){for(var t=0;t<e._fields.length;t++)e._fields[t].setOpt("isKey",!1);var r;r=new n({name:"@opcode",espType:"utf8str",type:"string",isKey:!1,isNumber:!1,isDate:!1,isTime:!1}),e._fields.unshift(r),e._columns.unshift(r.getOpt("name")),e._fieldMap[r.getOpt("name")]=r,r=new n({name:"@timestamp",espType:"timestamp",type:"date",isKey:!1,isNumber:!0,isDate:!1,isTime:!0}),e._fields.unshift(r),e._columns.unshift(r.getOpt("name")),e._fieldMap[r.getOpt("name")]=r,r=new n({name:"@counter",espType:"int32",type:"int",isKey:!0,isNumber:!0,isDate:!1,isTime:!1}),e._fields.unshift(r),e._columns.unshift(r.getOpt("name")),e._fieldMap[r.getOpt("name")]=r,e._keyFields=[r]}events(e){if(this.getOpt("debug")&&(console.log("events for "+this._path),console.log(c.stringify(e))),0!=e.hasOwnProperty("entries")){var t=e.entries,r=[];if(null!=t){var s,n=this.getOpt("ignore_deletes",!1);for(var i of t){for(var o in s={},i)s[o]=i[o];if(0==s.hasOwnProperty("@opcode"))s["@opcode"]="insert";else if(n&&"delete"==s["@opcode"])continue;s["@key"]=this.getKey(s),r.push(s)}}this.process(r)}}eventsXml(e){this.getOpt("debug")&&(console.log("events for "+this._path),console.log(N.format(e)));for(var t,r,n,i,o,a,h=N.getNodes("//entries/event",e),l=new Array,c=this.getOpt("ignore_deletes",!1),u=0;u<h.length;u++)if(null!=(n=(o=h[u]).getAttribute("opcode"))&&0!=n.length||(n="insert"),"delete"!=n||!c){(a={})["@opcode"]=n,s=o.getAttribute("timestamp"),null!=s&&s.length>0&&(a["@timestamp"]=s),r=N.getNodes("./*",o);for(var p=0;p<r.length;p++)i=r[p].getAttribute("type"),t=r[p].textContent,null!=i&&i.length,a[r[p].nodeName]=t;l.push(a)}this.process(l)}process(e){var t;for(var r of e){for(var s of(t={},this._schema._columns))r.hasOwnProperty(s)&&(t[s]=r[s]);t["@counter"]=this._counter,t["@key"]=this.getKey(t),t["@selected"]=!1,r["@counter"]=t["@counter"],r["@key"]=t["@key"],this._counter+=1,this._data.push(t)}var n=this.getOpt("maxevents",50),i=this._data.length-n;if(i>0)for(var o=0;o<i;o++)this._data.shift();this.deliverDataChange(e,!1)}info(e){}}class re extends n{constructor(e,t){super(t),this._api=e;var r=$.getString("Project"),s=$.getString("Contquery"),n=$.getString("Window"),i=$.getString("CPU"),o=$.getString("Interval"),a=$.getString("Count"),h=new Array;h.push({name:"project",label:r,isKey:!0}),h.push({name:"contquery",label:s,isKey:!0}),h.push({name:"window",label:n,isKey:!0}),h.push({name:"cpu",label:i,type:"int"}),h.push({name:"interval",label:o,type:"int"}),h.push({name:"count",label:a,type:"int"}),Object.defineProperty(this,"api",{get(){return this._api}}),Object.defineProperty(this,"windows",{get(){return this._windows}}),Object.defineProperty(this,"memory",{get(){return this._memory}}),Object.defineProperty(this,"config",{get(){return this._config}}),this._windows=[],this._memory={},this._config={},this._delegates=[]}process(e){}processJson(e){if(this._windows=[],e.hasOwnProperty("projects"))for(var t=e.projects,r=0;r<t.length;r++){var s=t[r];if(0!=s.hasOwnProperty("contqueries"))for(var n=s["@name"],i=s.contqueries,o=0;o<i.length;o++){var a=i[o];if(0!=a.hasOwnProperty("windows"))for(var h=a["@name"],l=a.windows,c=0;c<l.length;c++){var u=l[c],p=new Object;p.project=n,p.contquery=h,p.window=u["@name"],p.cpu=new Number(u["@cpu"]),p.interval=new Number(u["@interval"]),p.count=u.hasOwnProperty("@count")?new Number(u["@count"]):0,p["@key"]=n+"."+h+"."+u["@name"],this._windows.push(p)}}}if(this._windows.sort(this.sort),this._memory={},e.hasOwnProperty("server-memory")){var d=e["server-memory"];this._memory.system=d.system,this._memory.virtual=d.virtual,this._memory.resident=d.resident}if(this._config={},e.hasOwnProperty("properties")){var f,g,m=e.properties;for(r=0;r<m.length;r++)f=m[r]["@name"],g=m[r]["*value"],this._config[f]=!(null!=g&&g.length>0)||g}for(r=0;r<this._delegates.length;r++)this._delegates[r].handleStats(this)}processXml(e){this._windows=[];for(var t,r,s,n,i,o,a=N.getNodes(".//project",e),h=0;h<a.length;h++){s=a[h].getAttribute("name"),t=N.getNodes("./contquery",a[h]);for(var l=0;l<t.length;l++){n=t[l].getAttribute("name"),r=N.getNodes("./window",t[l]);for(var c=0;c<r.length;c++)i=r[c],(o=new Object).project=s,o.contquery=n,o.window=i.getAttribute("name"),o.cpu=new Number(i.getAttribute("cpu")),o.interval=new Number(i.getAttribute("interval")),o.count=new Number(i.getAttribute("count")),this._windows.push(o)}}this._windows.sort(this.sort),this._memory={};var u=N.getNode(".//server-memory",e);null!=u&&(this._memory.system=parseInt(N.getString("system",u)),this._memory.virtual=parseInt(N.getString("virtual",u)),this._memory.resident=parseInt(N.getString("resident",u))),this._config={};var p,d,f=N.getNodes(".//properties/property",e);if(f.length>0)for(var g of f)p=g.getAttribute("name"),d=N.nodeText(g),this._config[p]=!(d.length>0)||d;for(h=0;h<this._delegates.length;h++)this._delegates[h].handleStats(this)}sort(e,t){return t-e}optionSet(e,t){null!=this._delegates&&this._delegates.length>0&&this.set()}set(){var e={stats:{}},t=e.stats;t.action="set",t.interval=this.getOpt("interval",1),t.minCpu=this.getOpt("mincpu",5),t.counts=this.getOpt("counts",!1),t.config=this.getOpt("config",!1),t.memory=this.getOpt("memory",!0),t.format="xml",t.format="ubjson",this._api.sendObject(e)}stop(){var e={stats:{}};e.stats.action="stop",this._api.sendObject(e)}addDelegate(e){if(0==c.supports(e,"handleStats"))throw"The stats delegate must implement the handleStats method";c.addTo(this._delegates,e)&&1==this._delegates.length&&this.set()}removeDelegate(e){c.removeFrom(this._delegates,e)&&0==this._delegates.length&&this.stop()}getWindows(){return this._windows}getMemoryData(){return this._memory}getConfig(){return this._config}}class se{constructor(e){this._api=e,this._delegates=[],this._filter=null,Object.defineProperty(this,"filter",{get(){return this._filter},set(e){this._filter=e;var t={logs:{}};t.logs.filter=this._filter,this._api.sendObject(t)}})}process(e){for(var t=N.nodeText(e.documentElement),r=0;r<this._delegates.length;r++)this._delegates[r].handleLog(this,this.createObject(t))}createObject(e){if(null==e||0==e.length)return null;var t=null;if("{"==e[0])try{t=JSON.parse(e)}catch(e){console.log("log parse error")}else{var r,s;if((t={})._timestamp=e.substr(0,19),-1!=(s=e.indexOf("["))&&-1!=(r=e.indexOf("]",s))){var n=(i=e.substring(s+1,r-1)).split(":");3==n.length&&(t.logLevel=n[0],t.messageFile=n[1],t.messageLine=n[2])}if(-1!=r&&(-1!=(s=e.indexOf("[",r+1))&&(r=e.indexOf("]",s+1)),-1!=r)){var i=e.substr(r+1);i=e.replace(this._newlines,"<br/>"),i=e.replace(this._spaces,"&nbsp;"),t.messageContent=i}}return t}start(){var e={logs:{}};e.logs.capture=!0,this._api.sendObject(e)}stop(){var e={logs:{}},t=e.logs;t.capture=!0,t.capture=!1,this._api.sendObject(e)}addDelegate(e){if(0==c.supports(e,"handleLog"))throw"The stats delegate must implement the handleLog method";return c.addTo(this._delegates,e)&&1==this._delegates.length&&this.start(),!0}removeDelegate(e){c.removeFrom(this._delegates,e)&&0==this._delegates.length&&this.stop()}}class ne extends n{constructor(e,t){super(t),this._api=e,this._path=this.getOpt("window"),this._id=this.getOpt("id",c.guid()),this._data=new Array,this._schema=new D,this._csv=null,Object.defineProperty(this,"schema",{get(){return this._schema}}),this._schemaDelegates=[]}open(){var e={};this.addOpts(e);var t={publisher:{}};(e=t.publisher).id=this._id,e.action="set",e.window=this._path,e.schema=!0,this.hasOpt("dateformat")&&(e.dateformat=this.getOpt("dateformat")),0==this._api._publishers.hasOwnProperty(this._id)&&(this._api._publishers[this._id]=this),this._api.sendObject(t)}close(){var e={publisher:{}},t=e.publisher;t.id=this._id,t.action="delete",this._api._publishers.hasOwnProperty(this._id)&&delete this._api._publishers[this._id],this._api.sendObject(e)}addSchemaDelegate(e){if(0==c.supports(e,"schemaSet"))throw c.isNode?new Error("The datasource schema delegate must implement the schemaSet method"):"The datasource schema delegate must implement the schemaSet method";c.addTo(this._schemaDelegates,e)}removeSchemaDelegate(e){c.removeFrom(this._schemaDelegates,e)}setSchemaFromXml(e){this._schema.fromXml(e),this.deliverSchemaSet(),null!=this._csv&&this.csv()}setSchemaFromJson(e){this._schema.fromJson(e,this),this.deliverSchemaSet(),null!=this._csv&&this.csv()}deliverSchemaSet(){this.getOpt("debug")&&console.log("schema set for "+this+"\n"+this._schema.toString()),this._schemaDelegates.forEach((e=>{e.schemaSet(this,this._schema)}))}begin(){this._o=new Object}set(e,t){null!=this._o&&(this._o[e]=t)}end(){null!=this._o&&(this._data.push(this._o),this._o=new Object)}add(e){if(Array.isArray(e))for(var t of e)this._data.push(e);else this._data.push(e)}publish(){if(this._data.length>0){var e={publisher:{}},t=e.publisher;t.id=this._id,t.action="publish",t.data=this._data,this.getOpt("binary",!0)?this._api.sendBinary(e):this._api.sendObject(e),this._data=new Array}}send(e){if(this._csv.index<this._csv.items.length){this.add(this._csv.items[this._csv.index]),this.publish(),this._csv.index++;var t=this._csv.options.getOpt("pause",0);t>0&&(e=this,setTimeout((function(){e.send()}),t))}}csv(){if(0!=this._schema.size){this._csv.items=this._schema.createDataFromCsv(this._csv.data,this._csv.options.getOpts());var e=this._csv.options.getOpt("pause",0),t=this._csv.options.getOpt("opcode","insert");if(e>0){var r=this;setTimeout((function(){r.send()}),e)}else{for(var s of this._csv.items)s.opcode=s.hasOwnProperty("@opcode")?s["@opcode"]:t,this.add(s),this.publish();this._csv.options.getOpt("close",!1)&&this.close()}}}publishCsvFrom(e,t){var r=this;R.create("load",e,{response:function(e,s,n){r.publishCsv(s,t)},error:function(e,t){console.log("error: "+t)}}).get()}publishCsv(e,t){this._csv={data:e,options:new n(t),index:0},0!=this._schema.size&&this.csv()}isBinary(){return this.getOpt("binary",!0)}}class ie{constructor(e,t,r){this._api=e,this._delegate=t,this._request=null,this._api.sendObject(r)}deliver(e){var t=new j(e);c.supports(this._delegate,"modelLoaded")&&this._delegate.modelLoaded(t,this._api)}}class oe{constructor(e,t){this._api=e,this._delegate=t}deliver(e,t){c.supports(this._delegate,"response")&&this._delegate.response(this._api,e,t)}}class ae{constructor(e,t){this._api=e,this._delegate=t}deliver(e){if(c.supports(this._delegate,"guidsLoaded")){for(var t=[],r=N.getNodes("./guid",e),s=0;s<r.length;s++)t.push(N.nodeText(r[s]));this._delegate.guidsLoaded(t,this._api)}}}var he={};class le extends w{constructor(e,t,r,s,n,i,o){super(t,r,s,n,o,e.config),this._connect=e,this._delegates=[],Object.defineProperty(this,"connect",{get(){return this._connect}}),null!=i&&(Array.isArray(i)?i.forEach((e=>{c.addTo(this._delegates,e)})):c.addTo(this._delegates,i)),this._impl=null}handshakeComplete(){var e=this.getHeader("version");if(this._impl=null==e?new F(this,this.getOpts()):new Q(this,this.getOpts()),null!=this._impl)if(this._impl.version=e,null==this._impl.k8s&&this.hasOpt("model")){var t=this.getOpt("model"),r=new n(t),s=r.getOpt("name"),i=r.getOpt("data"),o=r.getOpt("url");null==s&&c.exception("the model must contain a name value"),null==i&&null==o&&c.exception("the model must contain either a data or url field");const e=this;null!=o?R.create("load",o,{response:function(r,s,n){0==t.hasOwnProperty("_xml")&&(n.documentElement.removeAttribute("name"),t.data=N.xmlString(n)),e.load(t,{loaded:function(t,r){e._delegates.forEach((t=>{c.supports(t,"ready")&&t.ready(e._impl)}))},error:function(t,r,s){e._delegates.forEach((e=>{c.supports(e,"error")&&e.error(s)}))}})},error:function(t,r){e._delegates.forEach((t=>{c.supports(t,"error")&&t.error(e._impl,r)}))}}).get():(0==t.hasOwnProperty("_xml")&&(t._xml=N.createXml(t.data),t._xml.documentElement.removeAttribute("name"),t.data=N.xmlString(t._xml)),this.load(t,{loaded:function(t,r){e._delegates.forEach((t=>{c.supports(t,"ready")&&t.ready(e._impl)}))},error:function(t,r,s){e._delegates.forEach((e=>{c.supports(e,"error")&&e.error(s)}))}}))}else this._delegates.forEach((e=>{c.supports(e,"ready")&&e.ready(this._impl)}))}load(e,t){if(this.getOpt("force",!1))this._impl.loadProject(e.name,e.data,t,this.getOpts());else{const r=this;this._impl.getProjectXml(e.name,{response:function(s,n,i){var o=null;if(1==i.nodeType?o=i:9==i.nodeType&&(o=i.documentElement),null==o)r._impl.loadProject(e.name,e.data,t,r.getOpts());else{o.removeAttribute("name",name);const s=N.xmlString(o);e.data!=s?r._impl.loadProject(e.name,e.data,t,r.getOpts()):t.loaded(this,e.name)}}})}}closed(e){if(null!=this._impl){for(var t of this._delegates)c.supports(t,"closed")&&t.closed(this._impl);const e=this._impl.closed;if(null!=this._impl&&(this._impl=null),0==e){var r=this.getOpt("reconnect",1);r>0&&this.reconnect(r)}}}error(){if(null==this._impl||!this._impl.closed){if(0==c.isNode&&0==w.established(this.getUrl())&&this.isSecure&&this.hasOpt("cert-confirm-url")){var e=this._ajax.getOpt("cert-confirm-url");0==he.hasOwnProperty(e)&&(he[e]=!0,window.open(e,"espconnect","width=800,height=800"))}for(var t of(c.supports(this._delegate,"error")&&this._delegate.error(this),this._delegates))c.supports(t,"error")&&t.error(this);var r=this.getOpt("reconnect",1);r>0&&this.reconnect(r)}}message(e){0!=this.isHandshakeComplete()?null!=this._impl&&this._impl.message(e):super.message(e)}data(e){null!=this._impl&&this._impl.data(e)}addDelegate(e){c.addTo(this._delegates,e),null!=this._impl&&c.supports(e,"ready")&&e.ready(this._impl)}removeDelegate(e){c.removeFrom(this._delegates,e)}getUrl(){var e="";return e+=this.protocol,e+="://",e+=this.host,e+=":",e+=this.port,null!=this._path&&this._path.length>0&&(e+=this._path),0==e.endsWith("/")&&(e+="/"),e+="eventStreamProcessing/v2/connect",this.hasOpt("access_token")&&(e+="?",e+="access_token="+this.getOpt("access_token")),e}static create(e,t,r,s){var n=c.createUrl(decodeURI(t));return new le(e,n.host,n.port,n.path,n.secure,r,s)}}class ce{constructor(){this._servers={},this._connections={},this._destinations={},this._routes={},this._models={},this._errors={}}configure(e){var t=N.createXml(e);N.getNodes("//esp-engines/esp-engine",t).forEach((e=>{var t=e.getAttribute("name"),r="http://"+e.getAttribute("host")+":"+e.getAttribute("port");this.addServer(t,r)})),N.getNodes("//esp-destinations/*",t).forEach((e=>{if("publish-destination"==e.tagName){var t=e.getAttribute("name"),r=N.getNode("publish-target",e);if(null==r)throw"no target for publish destination";var s,n=new pe(this);if(n.opcode=e.getAttribute("opcode"),null==(s=N.getNode("engine-func",r)))throw"you must supply the engine-func element";if(n.getEngine=new Function("data",N.nodeText(s)),null==(s=N.getNode("project-func",r)))throw"you must supply the project-func element";if(n.getProject=new Function("data",N.nodeText(s)),null==(s=N.getNode("contquery-func",r)))throw"you must supply the contquery-func element";if(n.getContquery=new Function("data",N.nodeText(s)),null==(s=N.getNode("window-func",r)))throw"you must supply the window-func element";n.getWindow=new Function("data",N.nodeText(s)),this._destinations[t]=n}})),this._routes={},N.getNodes("//esp-routes/esp-route",t).forEach((e=>{var t,r=e.getAttribute("name"),s=new de(r,this);s.to=e.getAttribute("to"),null!=(t=N.getNode("engine-expr",e))&&(s.engine=N.nodeText(t)),null!=(t=N.getNode("project-expr",e))&&(s.project=N.nodeText(t)),null!=(t=N.getNode("contquery-expr",e))&&(s.contquery=N.nodeText(t)),null!=(t=N.getNode("window-expr",e))&&(s.win=N.nodeText(t)),this._routes[r]=s}))}addServer(e,t){this._servers[e]=t}addDestination(e){var t=new ue(this);return this._destinations[e]=t,t}addPublishDestination(e){var t=new pe(this);return this._destinations[e]=t,t}addRoute(e){var t=new de(e,this);return this._routes[e]=t,t}ready(e){this._connections[e.getOpt("name")]=e,e.loadModel(this)}error(e){var t=e.getOpt("name");0==this._errors.hasOwnProperty(t)&&(console.log("server error "+e),this._errors[t]=e),delete this._models[t]}getEngine(e){return this._connections.hasOwnProperty(e)?this._connections[e]:null}getModel(e){return this._models.hasOwnProperty(e)?this._models[e]:null}modelLoaded(e,t){var r=t.getOpt("name");this._models[r]=e,this._errors.hasOwnProperty(r)&&(console.log("server back up "+t),delete this._errors[r]),Object.keys(this._models).length+Object.keys(this._errors).length==Object.keys(this._connections).length&&(Object.values(this._destinations).forEach((e=>{e.init()})),Object.values(this._routes).forEach((e=>{e.init()})))}start(){Object.values(this._connections).forEach((e=>{e.close()})),this._connections={},Object.keys(this._servers).forEach((e=>{var t=this._servers[e];le.create(t,this,{name:e}).start()}))}stop(){Object.values(this._connections).forEach((e=>{e.close()}))}}class ue{constructor(e){this._router=e}init(){if(0==c.supports(this,"process"))throw"destination must implement the process(data) method"}}class pe extends ue{constructor(e){super(e),this._publishers={},this._opcode=null,Object.defineProperty(this,"opcode",{set(e){this._opcode=e},get(){return this._opcode}})}init(){super.init(),["getEngine","getProject","getContquery","getWindow"].forEach((e=>{if(0==c.supports(this,e))throw"destination must implement the "+e+" method"})),this._publishers={}}process(e){var t=this.getEngine(e);if(null!=t){var r=this._router.getEngine(t);if(null!=r){var s=this.getProject(e),n=this.getContquery(e),i=this.getWindow(e),o=t+"/"+s+"/"+n+"/"+i,a=null;if(this._publishers.hasOwnProperty(o))a=this._publishers[o];else{var h=s+"/"+n+"/"+i;a=r.getPublisher({window:h,id:h,binary:!0}),this._publishers[o]=a}a.add(e),a.publish()}else console.log("cannot find engine: "+t)}}}class de{constructor(e,t){this._name=e,this._router=t,this._engine=null,this._project=null,this._contquery=null,this._window=null,this._to=null,this._destinations=[],Object.defineProperty(this,"name",{get:function(){return this._name}}),Object.defineProperty(this,"engine",{set:function(e){this._engine=null!=e?new RegExp(e):null},get:function(){return this._engine}}),Object.defineProperty(this,"project",{set:function(e){this._project=null!=e?new RegExp(e):null},get:function(){return this._project}}),Object.defineProperty(this,"contquery",{set:function(e){this._contquery=null!=e?new RegExp(e):null},get:function(){return this._contquery}}),Object.defineProperty(this,"win",{set:function(e){this._window=null!=e?new RegExp(e):null},get:function(){return this._window}}),Object.defineProperty(this,"to",{set:function(e){this._to=null!=e?e.split(","):null},get:function(){return this._to}})}init(){if(null==this._to)throw"route "+this.name+" does not have any destinations associated with it";null!=this._engine&&Object.keys(this._router._connections).forEach((e=>{if(this._engine.test(e)){var t=this._router._connections[e],r=[];this._router.getModel(t.getOpt("name")).projects.forEach((e=>{(null==this._project||this._project.test(e.name))&&r.push(e)}));var s=[];r.forEach((e=>{e.contqueries.forEach((e=>{(null==this._contquery||this._contquery.test(e.name))&&s.push(e)}))}));var n=[];s.forEach((e=>{e.windows.forEach((e=>{(null==this._window||this._window.test(e.name))&&n.push(e)}))})),n.forEach((e=>{t.getEventStream({window:e.key,maxevents:0,schema:!1}).addDelegate(this)}))}})),this._destinations=[],this._to.forEach((e=>{this._router._destinations.hasOwnProperty(e)&&this._destinations.push(this._router._destinations[e])}))}dataChanged(e,t,r){t.forEach((e=>{this._destinations.forEach((t=>{t.process(e)}))}))}}class fe{constructor(e){var t;this._url=c.createUrl(decodeURI(e)),this._proxy=!1,-1!=this._url.protocol.indexOf("-")&&("proxy:"!=(t=this._url.protocol.split("-"))[1]&&c.exception("invalid protocol: "+this._url.protocol),this._url.protocol=t[0]+":",this._proxy=!0),this._ns=null,this._project=null,this._pod=null,(t=null!=this._url.path?this._url.path.substr(1).split("/"):[]).length>0&&t[0].length>0&&(this._ns=t[0],t.length>1&&t[1].length>0&&(this._project=t[1])),Object.defineProperty(this,"k8sProtocol",{get(){var e="k8s";return null!=this._proxy&&(e+="-proxy"),e+":"}}),Object.defineProperty(this,"httpProtocol",{get(){return this._proxy?"http:":"k8s:"==this._url.protocol||"https:"==this._url.protocol?"https:":"http:"}}),Object.defineProperty(this,"wsProtocol",{get(){return this._proxy?"ws:":"k8s:"==this._url.protocol||"https:"==this._url.protocol?"wss:":"ws:"}}),Object.defineProperty(this,"baseUrl",{get(){return this.httpProtocol+"//"+this.host+":"+this.port+"/"}}),Object.defineProperty(this,"baseWsUrl",{get(){return this.wsProtocol+"//"+this.host+":"+this.port+"/"}}),Object.defineProperty(this,"protocol",{get(){return this._url.protocol}}),Object.defineProperty(this,"host",{get(){return this._url.host}}),Object.defineProperty(this,"port",{get(){return this._url.port}}),Object.defineProperty(this,"path",{get(){return this._url.path}}),Object.defineProperty(this,"url",{get(){return this.baseUrl+"apis/iot.sas.com/v1alpha1"}}),Object.defineProperty(this,"httpUrl",{get(){var e="";return"k8s:"==this._url.protocol||"https:"==this._url.protocol?e+="https":e+="http",null!=this._proxy&&(e+="-proxy"),e+="://",e+=this.host,(e+=":")+this.port}}),Object.defineProperty(this,"k8sUrl",{get(){return this.k8sProtocol+"//"+this.host+":"+this.port}}),Object.defineProperty(this,"namespaceUrl",{get(){return null==this.namespace?null:this.k8sUrl+"/"+this.namespace}}),Object.defineProperty(this,"projectUrl",{get(){return null==this.namespace||null==this.project?null:this.k8sUrl+"/"+this.namespace+"/"+this.project}}),Object.defineProperty(this,"namespace",{get(){return this._ns}}),Object.defineProperty(this,"project",{get(){return this._project}}),Object.defineProperty(this,"pod",{get(){return this._pod}})}getMyProjects(e){return this.getProjects(e,this.namespace,this.project)}getProjects(e,t,r){0==c.supports(e,"handleProjects")&&c.exception("the delegate must implement the handleProjects function");var s=this.url;null!=t&&(s+="/namespaces/"+t),s+="/espservers",null!=r&&(s+="/"+r);var n=this,i=R.create("load",s,{response:function(t,r){if(404!=t.getStatus()){var s=JSON.parse(r);if(404==s.code){var i="";null!=n._ns&&(i+=n._ns+"/"),i+=n._project,c.supports(e,"notFound")?e.notFound(i):c.exception("project not found: "+i)}else{var o=s.kind,a=null;"ESPServer"==o?a=[s]:"ESPServerList"==o&&(a=s.items),e.handleProjects(a)}}else c.supports(e,"notFound")?e.notFound(t,"not found"):c.exception("error: not found")},error:function(t,r){c.supports(e,"error")?e.error(t,r):c.exception("error: "+r)}});i.setRequestHeader("accept","application/json"),i.get()}getProject(e,t,r){0==c.supports(e,"handleProject")&&c.exception("the delegate must implement the handleProjects function"),null!=t&&null!=r||c.exception("you must specify project namespace and name"),this.getProjects({handleProjects:function(t){e.handleProject(t[0])},notFound:function(){c.supports(e,"notFound")?e.notFound():c.exception("error: not found")}},t,r)}getPods(e){0==c.supports(e,"handlePods")&&c.exception("the delegate must implement the handlePods function");var t=this.baseUrl;t+="api/v1",null!=this._ns&&(t+="/namespaces/"+this._ns);var r=this,s=R.create("pods",t+="/pods",{response:function(t,s){var n=JSON.parse(s),i=[];if(null!=r.project){var o=r.project+"-";for(var a of n.items)if(a.metadata.name.startsWith(o)){i.push(a);break}}else i=n.items;e.handlePods(i)},error:function(t,r){c.supports(e,"error")?e.error(t,r):c.exception("error: "+r)}});s.setRequestHeader("accept","application/json"),s.get()}getPod(e){0==c.supports(e,"handlePod")&&c.exception("the delegate must implement the handlePod function"),null!=this.namespace&&null!=this.project||c.exception("the instance requires both namespace and project name to get the pod"),this.getPods({handlePods:function(t){0==t.length?c.supports(e,"notFound")&&e.notFound():e.handlePod(t[0])}})}getLog(e){0==c.supports(e,"handleLog")&&c.exception("the delegate must implement the handleLog function"),null!=this.namespace&&null!=this.project||c.exception("the instance requires both namespace and project name to get the pod");var t=this;this.getPod({handlePod:function(r){var s=t.baseUrl;s+="api/v1",s+="/namespaces/"+t.namespace,s+="/pods/"+r.metadata.name,R.create("log",s+="/log",{response:function(t,r){var s,n=[];r.split("\n").forEach((e=>{if(e.length>0){try{s=JSON.parse(e)}catch(t){(s={}).message=e}n.push(s)}})),e.handleLog(n)},error:function(t,r){c.supports(e,"error")?e.error(t,r):c.exception("error: "+r)}}).get()}})}ls(e,t){0==c.supports(t,"handleFiles")&&c.exception("the delegate must implement the handleFiles function");var r={out:function(e,r){var s=(new TextDecoder).decode(r).split("\n"),i=[];for(var o of s)if(0!=o.length){var a=o[0];if("-"==a||"d"==a){var h=(o=o.substr(1)).splitNoSpaces(),l=new n;l.setOpt("name",h[8]),l.setOpt("perms",h[0]),l.setOpt("owner",h[2]),l.setOpt("group",h[3]),l.setOpt("size",h[4]),l.setOpt("modified",h[5]+" "+h[6]+" "+h[7]),l.setOpt("directory","d"==a),i.push(l)}}t.handleFiles(i)}};this.run(["ls","-l",e],r)}cat(e,t){0==c.supports(t,"output")&&c.exception("the delegate must implement the output function");var r={out:function(e,r){var s=(new TextDecoder).decode(r);t.output(s)}};this.run(["cat",e],r)}get(e,t){0==c.supports(t,"handleFile")&&c.exception("the delegate must implement the handleFile function");var r=[],s={out:function(e,t){r.push(t.slice(1))},closed:function(){var e=0;r.forEach((t=>{e+=t.byteLength}));var s=new DataView(new ArrayBuffer(e)),n=0;r.forEach((e=>{for(var t=new DataView(e),r=0;r<e.byteLength;r++)s.setUint8(n,t.getUint8(r)),n++}));var i=new me;i.parse(s.buffer),t.handleFile(i)},err:function(e,t){var r=(new TextDecoder).decode(t);r.indexOf("Removing leading")<0&&c.exception(r)}};this.run(["tar","cf","-",e],s)}put(e,t,r,s){c.isNode&&e instanceof Buffer&&(e=c.bufferToArrayBuffer(e));var n={ready:function(t){var s=new me;s.create(e,r),new ArrayBuffer(s.buffer.byteLength+1);var n=new DataView(new ArrayBuffer(513));n.setUint8(0,0);for(var i=1,o=0;o<s.dv.byteLength;o++)n.setUint8(i,s.dv.getUint8(o)),513==++i&&(t.send(n.buffer),n.setUint8(0,0),i=1);var a=new DataView(new ArrayBuffer(2));a.setUint8(0,0),a.setUint8(0,4),t.send(a.buffer),t.close()},closed:function(e){c.supports(s,"done")&&s.done()},out:function(e,t){console.log((new TextDecoder).decode(t))}};this.run(["tar","-xmf","-","-C",t],n)}puturl(e,t,r,s){var i=new n(r),o=this,a={response:function(e,r){o.put(r,t,i.getOpts(),s)},error:function(e,t){c.exception("error: "+t)}};if(0==i.hasOpt("name")){const t=e.lastIndexOf("/");-1!=t&&i.setOpt("name",e.substr(t))}R.create("load",e,a).get()}rm(e,t){var r={message:function(e,t){(new TextDecoder).decode(t.data)},closed:function(e){c.supports(t,"done")&&t.done()},error:function(e,t){c.exception(t)}};this.run(["rm",e],r)}mkdir(e,t){var r={message:function(e){(new TextDecoder).decode(e.data)},closed:function(e){c.supports(t,"done")&&t.done()},error:function(e){c.exception(e)}};this.run(["mkdir","-p",e],r)}run(e,t){null!=this.namespace&&null!=this.project||c.exception("the instance requires both namespace and project name to execute a command");const r=Array.isArray(e)?e:e.split(" ");if(null==this._pod){var s=this;this.getPod({handlePod:function(e){s._pod=e,s.exec(r,s._pod,t)}})}else this.exec(r,this._pod,t)}exec(e,t,r){var s=this.baseWsUrl;for(s+="api/v1/namespaces/",s+=this.namespace,s+="/pods/",s+=t.metadata.name,s+="/exec",i=0;i<e.length;i++)s+=0==i?"?":"&",s+="command="+e[i];s+="&container="+t.spec.containers[0].name,s+="&stdin=true",s+="&stdout=true",s+="&stderr=true";var n={open:function(){c.supports(r,"ready")&&r.ready(this)},error:function(e){c.supports(r,"error")?r.error(this,e):c.exception((new TextDecoder).decode(e.data))},close:function(){c.supports(r,"closed")&&r.closed(this)},message:function(e){var t;t="Buffer"==e.constructor.name?c.bufferToArrayBuffer(e):e.data;var s=new DataView(t),n=s.getUint8(0);1!=s.byteLength&&(1==n?c.supports(r,"out")?r.out(this,e.data):console.log((new TextDecoder).decode(e.data)):2==n&&(c.supports(r,"err")?r.err(this,e.data):c.exception((new TextDecoder).decode(e.data))))}};c.createWebSocket(s,n)}}class ge extends fe{constructor(e){super(e),null==this._project&&c.exception("URL must be in form protocol://server/<namespace>/<project>"),Object.defineProperty(this,"espUrl",{get(){var e="";return null!=this._config&&("k8s:"==this._url.protocol||"https:"==this._url.protocol||"k8s-proxy:"==this._url.protocol||"https-proxy:"==this._url.protocol?e+="https://":e+="http://",e+=this._config.access.externalURL,e+="/SASEventStreamProcessingServer",e+="/"+this._project),e}}),Object.defineProperty(this,"modelXml",{get(){var e="";return null!=this._config&&(e=this._config.spec.espProperties["server.xml"]),e}}),this._config=null,this.loadConfig()}connect(e,t,r,s){var i=new n(r),o=i.getOpt("model"),a=this,h={loaded:function(){if(null==o)a.getPod({handlePod:function(n){a._pod=n,e.connect(a.espUrl,t,r,s)}});else{var n={modelHandler:function(n){a.load(n,i.getOpts(),{loaded:function(){e.connect(a.espUrl,t,r,s)}})}};a.getModel(o,n)}},notFound:function(n){if(null==o)if(i.getOpt("create",!0)){var h=a.getDefaultModel(n);a.load(h,i.getOpts(),{loaded:function(){e.connect(a.espUrl,t,r,s)}})}else c.supports(t,"error")&&t.error("project not found: "+n);else{var l={modelHandler:function(n){a.load(n,i.getOpts(),{loaded:function(){e.connect(a.espUrl,t,r,s)}})}};a.getModel(o,l)}},error:function(e,t){c.exception("error: "+i)}};this.loadConfig(h)}loadConfig(e){this._config=null;var t=this.url;null!=this._ns&&(t+="/namespaces/"+this._ns),t+="/espservers",t+="/"+this._project;var r=this,s=R.create("load",t,{response:function(t,s){var n=JSON.parse(s);404==n.code?c.supports(e,"notFound")&&e.notFound(r.namespace+"/"+r.project):(r._config=n,c.supports(e,"loaded")&&e.loaded())},error:function(e,t){c.exception("error: "+t)}});s.setRequestHeader("accept","application/json"),s.get()}load(e,t,r){var s=new n(t),i=N.createXml(e);i.documentElement.setAttribute("name",this._project);var o="b64"+c.b64Encode(N.xmlString(i));if(o!=this.modelXml||0!=s.getOpt("force",!1)){var a=this;if(null!=this._config){var h={deleted:function(){a._config=null,setTimeout((function(){a.load(e,s.getOpts(),r)}),1e3)},error:function(e){c.exception(e)}};this.del(h)}else{var l=this.url;null!=this._ns&&(l+="/namespaces/"+this._ns),l+="/espservers",h={response:function(e,t){const s=e.getStatus();200!=s&&201!=s&&c.exception(t),a.loadConfig(),a.isReady({ready:function(){c.supports(r,"loaded")&&r.loaded()}})},error:function(e,t){c.supports(r,"error")?r.error(e,t):c.exception("error: "+t)}};var u=this.getYaml(o),p=R.create("create",l,h);p.setRequestHeader("content-type","application/yaml"),p.setRequestHeader("accept","application/json"),p.setData(u),p.post()}}else c.supports(r,"loaded")&&r.loaded()}restart(e){const t=this,r={handleProject:function(r){const s=r.spec.espProperties["server.xml"],n=c.b64Decode(s.substr(3)).toString(),i={deleted:function(){t.load(n,{force:!0},{loaded:function(){c.supports(e,"loaded")&&e.loaded()}})}};t.del(i)},notFound:function(){c.exception("project not found")}};this.getProject(r,this.namespace,this.project)}del(e){var t=this.url;null!=this._ns&&(t+="/namespaces/"+this._ns),t+="/espservers/",t+=this._project;var r=R.create("create",t,{response:function(t,r){c.supports(e,"deleted")&&e.deleted()},error:function(t,r){c.supports(e,"error")?e.error(r):c.exception("error: "+r)}});r.setRequestHeader("accept","application/json"),r.del()}getModel(e,t){0==c.supports(t,"modelHandler")&&c.exception("the delegate must implement the modelHandler function");var r=new n(e),s=r.getOpt("data"),i=r.getOpt("url");null==s&&null==i&&c.exception("the model must contain either a data or url field"),null!=s?t.modelHandler(s):R.create("load",i,{response:function(e,r,s){t.modelHandler(r)},error:function(e,t){}}).get()}getYaml(e){var t="";return t+="apiVersion: iot.sas.com/v1alpha1\n",t+="kind: ESPServer\n",t+="metadata:\n",t+="  name: "+this._project+"\n",null!=this._ns&&(t+="  namespace: "+this._ns+"\n"),t+="spec:\n",t+='    loadBalancePolicy: "default" \n',t+="    espProperties:\n",t+='      server.xml: "'+e+'"\n',t+='      meta.meteringhost: "sas-event-stream-processing-metering-app.roleve"\n',t+='      meta.meteringport: "80"\n',t+="    projectTemplate:\n",t+="      autoscale:\n",t+="        minReplicas: 1\n",t+="        maxReplicas: 1\n",t+="        metrics:\n",t+="        - type: Resource\n",t+="          resource:\n",t+="            name: cpu\n",t+="            target:\n",t+="              type: Utilization\n",t+="              averageUtilization: 50\n",t+="      deployment:\n",t+="        spec:\n",t+="          selector:\n",t+="            matchLabels:\n",t+="          template:\n",t+="            spec:\n",t+="               volumes:\n",t+="               - name: data\n",t+="                 persistentVolumeClaim:\n",t+="                   claimName: esp-pv\n",t+="               containers:\n",t+="               - name: ((PROJECT_SERVICE_NAME))\n",t+="                 resources:\n",t+="                   requests:\n",t+='                     memory: "1Gi"\n',t+='                     cpu: "1"\n',t+="                   limits:\n",t+='                     memory: "2Gi"\n',t+='                     cpu: "2"\n',t+="                 volumeMounts:\n",t+="                 - mountPath: /mnt/data\n",t+="                   name: data\n",t+="    loadBalancerTemplate:\n",t+="      deployment:\n",t+="        spec:\n",t+="          template:\n",t+="            spec:\n",t+="              containers:\n",t+="              - name: ((PROJECT_SERVICE_NAME)) \n",t+="access:\n",t+='  state: "Pending" \n',t+="  internalHostName:  foo\n",(t+="  internalHttpPort:  0\n")+"  externalURL: foo\n"}getDefaultModel(e){return"<project pubsub='auto' threads='4'>\n    <contqueries>\n        <contquery name='cq'>\n            <windows>\n                <window-source name='s'>\n                    <schema>\n                        <fields>\n                            <field name='id' type='string' key='true'/>\n                            <field name='data' type='string'/>\n                        </fields>\n                    </schema>\n                </window-source>\n            </windows>\n        </contquery>\n    </contqueries>\n</project>\n"}isReady(e){0==c.supports(e,"ready")&&c.exception("the delegate must implement the ready function");var t="";null!=this._config&&(t=this._config.access.state);const r=this;"Succeeded"==t?r.getPod({handlePod:function(t){var s=!1;if("Running"==t.status.phase){for(var n=0;n<t.status.conditions.length&&"True"==t.status.conditions[n].status;n++);s=n==t.status.conditions.length}s?(r._pod=t,setTimeout((function(){e.ready(r)}),1e3)):setTimeout((function(){r.isReady(e)}),1e3)}}):(this.loadConfig(),setTimeout((function(){r.isReady(e)}),500))}readiness(e){var t=this.espUrl;const r=R.create("ready",t+="/internal/ready",{response(t,r){console.log("ready status: "+t.getStatus()),200==t.getStatus()?e.ready(this):setTimeout((function(){k8s.readiness(e)}),500)},error(e,t){c.exception(t)}});setTimeout((function(){r.head()}),1e3)}}class me extends n{constructor(){super(),this._index=0,this._dv=null,this._content=null,Object.defineProperty(this,"content",{get(){return this._content}}),Object.defineProperty(this,"dv",{get(){return this._dv}}),Object.defineProperty(this,"buffer",{get(){return this._dv.buffer}})}create(e,t){var r=new n(t);0==r.hasOpt("name")&&c.exception("must supply name for remote file");var s=null,i=0;"string"==typeof e||e instanceof String?(i=e.length,s=new DataView(c.createBuffer(e))):(i=e.byteLength,s=new DataView(e));var o=i+(512-i%512)+512+1024;this._dv=new DataView(new ArrayBuffer(o)),this.putString(r.getOpt("name"),0,100);const a="000"+r.getOpt("mode","644")+" ";var h;this.putString(a,100,8),this.putString(r.getOpt("userid","001001 "),108,8),this.putString(r.getOpt("groupid","001001 "),116,8),this.putString("0",156,1),this.putString("ustar",257,6),this.putString("00",263,2),this.putString(r.getOpt("owner","sas"),265,32),this.putString(r.getOpt("group","sas"),297,32),h=(h=i.toString(8)).pad(11,"0"),h+=" ",this.putString(h,124,12),h=(h=" ").pad(8," "),this.putString(h,148,8),h+=" ",h=(h="0").pad(6,"0"),h+=" ",this.putString(h,329,8),this.putString(h,337,8),h=(h=this.checksum()).pad(6,"0"),this.putString(h,148,6),this._dv.setUint8(154,0);for(var l=0;l<i;l++)this._dv.setUint8(512+l,s.getUint8(l))}getString(e,t,r){e="";for(var s,n=0;n<bytes;n++)(s=this._dv.getUint8(t))>0&&(e+=String.fromCharCode(s)),t++;return e}putString(e,t,r){for(var s=0;s<r;s++)e.length>s&&this._dv.setUint8(t+s,e.charCodeAt(s))}parse(e){this._index=0,this._dv=new DataView(e),this.setOpt("name",this.readString(100)),this.setOpt("mode",this.readString(8)),this.setOpt("userId",this.readString(8)),this.setOpt("groupId",this.readString(8));var t=parseInt(this.readString(12),8);this.setOpt("size",t),this.setOpt("modified",this.readString(12)),this.setOpt("checksum",this.readString(8)),this.setOpt("type",this.readString(1)),this.setOpt("link",this.readString(100)),this.setOpt("ustar",this.readString(6)),this.setOpt("ustarVersion",this.readString(2)),this.setOpt("ownerName",this.readString(32)),this.setOpt("ownerGroup",this.readString(32)),this.setOpt("deviceMajor",this.readString(8)),this.setOpt("deviceMinor",this.readString(8)),this.setOpt("prefix",this.readString(155)),this._index=512,t=parseInt(this.getOpt("size"),8),this._content=this.read(this.getOpt("size"))}readString(e){for(var t,r="",s=0;s<e;s++)(t=this._dv.getUint8(this._index))>0&&(r+=String.fromCharCode(t)),this._index++;return r}read(e){for(var t=new ArrayBuffer(e),r=new DataView(t),s=0;s<e;s++)r.setUint8(s,this._dv.getUint8(this._index)),this._index++;return t}checksum(){for(var e=0,t=0;t<this._dv.byteLength;t++)e+=this._dv.getUint8(t);return e.toString(8)}}var _e=function(e){var t=c.createUrl(decodeURI(e));return null!=t.path&&3==t.path.split("/").length?new ge(e):new fe(e)};class ve extends n{constructor(e){super(e),this._index=0,this._tabs=this.getOpt("tabs",4),this._incommand=!1,this._command=null,this._prev=null,this._text=null,this._listing=null,this._cl="<",this._cr=">",this._colors={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37}}format(e,t,r,s){return this._text=null!=s?s:"",this._index=0,this._prev=null,this._incommand=!1,this._command=null,Array.isArray(e)?e.forEach((e=>{this.process(e,t,r),this._text+="\n\n",this._text+=null!=s?s:"",this._index=0,this._prev=null,this._incommand=!1,this._command=null})):this.process(e,t,r),this._text}process(e,t,r){for(var s,n="",i=0;i<e.length;i++)if((s=e[i])==this._cl)this.word(n),n="",this._incommand=!0,this._command="";else if(s==this._cr)this.word(n),n="",this._incommand&&(this._incommand=!1,this.command(r));else if(this._incommand)this._command+=s;else if(null!=this._listing)this._listing+=s;else if(" "==s||"\t"==s||"\n"==s||"."==s){if(" "==s&&0==this._index&&0==n.length)continue;if(this.word(n),n=""," "==s)null!=t&&this._index>=t?(this._text+="\n",this._index=0,null!=r&&(this._text+=r)):this._text+=s;else if("\t"==s)for(var o=0;o<this._tabs;o++)this._text+=" ";else"\n"==s?(this._text+="\n",this._index=0,null!=r&&(this._text+=r)):"."==s&&(this._text+=s)}else this._prev=s,n+=s;n.length>0&&this.word(n)}command(e){if("note"==this._command){this._text+="[7mNOTE[0m",this._index+="NOTE".length}else if("b"==this._command)this._text+="[1m";else if("/b"==this._command)this._text+="[0m";else if("br/"==this._command)this._text+="\n",null!=e&&(this._text+=e),this._index=0;else if(0==this._command.indexOf("fg:")){var t=this._command.split(":")[1];this._colors.hasOwnProperty(t)&&(this._text+="["+this._colors[t]+"m")}else if(0==this._command.indexOf("bg:"))t=this._command.split(":")[1],this._colors.hasOwnProperty(t)&&(this._text+="["+(this._colors[t]+10)+"m");else if("/fg"==this._command)this._text+="[0m";else if("/bg"==this._command)this._text+="[47m";else if("listing"==this._command)this._listing="";else if("/listing"==this._command){const t=this.getListing(this._listing);var r=[];t.values.forEach((e=>{r.push(new n(e))})),t.values=r,t.indent=e,t.headers=!0,this._text+="\n",this._text+=this.listing(t),this._text+="\n"+e,this._listing=null}else"dot"==this._command&&(this._text+=".")}word(e){this._text+=e,this._index+=e.length}tab(e){var t="";null==e&&(e=1);for(var r=this.getOpt("tabs","    "),s=0;s<e;s++)t+=r;return t}listing(e){var t,r=new n(e),s=r.getOpt("fields"),i=r.getOpt("values"),o=r.getOpt("indent",""),a="",h={};s.forEach((e=>{h[e]=0})),r.getOpt("headers",!1)&&s.forEach((e=>{e.length>h[e]&&(h[e]=new Number(e.length))})),i.forEach((e=>{s.forEach((r=>{(t=e.getOpt(r,"")).length>h[r]&&(h[r]=new Number(t.length))}))}));const l=r.getOpt("spacing",2);return r.getOpt("headers",!1)&&(s.forEach((e=>{a+=o,a+=e,a+=this.spaces(h[e]-e.length+l)})),a+="\n",s.forEach((e=>{a+=o,t=(t="-").pad(h[e],"-"),a+=t,a+=this.spaces(h[e]-t.length+l)})),a+="\n"),i.forEach((e=>{s.forEach((r=>{t=e.getOpt(r,""),a+=o,a+=t,a+=this.spaces(h[r]-t.length+l)})),a+="\n"})),a}spaces(e){for(var t="",r=0;r<e;r++)t+=" ";return t}getListing(e){var t=null;if(this.getOpt("listings",!1)){const r=this.getOpt("listings");r.hasOwnProperty(e)&&(t=r[e])}return t}}var ye={_args:null,_config:null,isNode:function(){return c.isNode},connect:function(e,t,r,s){if(c.createUrl(decodeURI(e)).protocol.startsWith("k8s")){var i=_e(e);null==r&&(r={}),r.k8s=i,i.connect(this,t,r,s)}else{var o=new n(r),a=null,h=null;o.hasOpt("token")&&(a=o.getOptAndClear("token")),o.hasOpt("credentials")&&(h=o.getOptAndClear("credentials"));var l=le.create(this,e,t,o.getOpts());null!=a?l.setBearer(a):null!=h&&l.setBasic(h),(null==s||s)&&l.start()}},closed:function(e){for(var t of this._visuals)t.closed(e)},createWebSocket:function(e,t){return c.createWebSocket(e,t)},getAjax:function(){return R},getTools:function(){return c},getFormatter:function(){return new ve},getXPath:function(){return N},getResources:function(){return resources},createRouter:function(){return new ce},createOptions:function(e){return new n(e)},createOptionsFromArgs:function(){return new n(this.getArgs())},getArgs:function(){return null==this._args&&(this._args=c.createCommandLineOpts()),this._args},getArg:function(e,t){return args.getOpt(e,t)},hasArg:function(e){return this.getArgs().hasOpt(e)},guid:function(){return c.guid()},createTimer:function(){return c.createTimer()},createK8S:function(e){return _e(e)},formatDate:function(e,t){return c.formatDate(e,t)},encode:function(e){return f(e)},decode:function(e){return g(e)},createBuffer:function(e){return c.createBuffer(e)},stringFromBytes:function(e){return c.stringFromBytes(e)},bytesFromString:function(e){return c.bytesFromString(e)},b64Encode:function(e){return c.b64Encode(e)},b64Decode:function(e){return c.b64Decode(e)},stringify:function(e){return c.stringify(e)},usage:function(e){var t=new ve(e),r=new n(e),s=r.getOpt("name",""),i=r.getOpt("summary","");console.log(""),console.log("[1m[34m"+s+"(1)\t\t\tESP Connect Node.js Commands\t\t\t"+s+"(1)[30m[0m"),console.log(""),console.log("[1m%s[0m","NAME"),console.log(t.tab()+"node "+s+".mjs -- "+i),console.log(""),console.log("[1m%s[0m","SYNOPSIS");var o=r.getOpt("options"),a=0,h="";if(null!=o&&o.forEach((e=>{h+=" ";var t=new n(e),r=t.getOpt("name",""),s=t.getOpt("arg",""),i=r;s.length>0&&(i+=" "+s),i.length>a&&(a=i.length),t.getOpt("required",!1)?h+="--"+r:h+="[--"+r+"]"})),console.log("%s[1m%s[0m",t.tab(),s+h),console.log(""),console.log("[1m%s[0m","DESCRIPTION"),r.hasOpt("description")){var l=t.format(r.getOpt("description",""),80,t.tab(),t.tab());console.log(l)}if(null!=o){console.log(""),console.log("[1m%s[0m","OPTIONS"),a=10;var c=0;o.forEach((e=>{var r=new n(e),i=r.getOpt("name",""),o=r.getOpt("arg","");h=i,o.length>0&&(h+=" "+o),t.tab();for(var l=0;l<a;l++);u>0&&console.log("");var c=t.format(r.getOpt("description"),50+a,t.tab(2),t.tab(2));if(console.log("%s--%s [4m%s[0m",t.tab(),i,o),console.log(c),r.hasOpt("examples")){t.spaces(2*(a-h.length+2)),console.log(""),console.log("%s[1m%s[0m",t.tab(3),"Examples");var u=0;r.getOpt("examples").forEach((e=>{var r=new n(e),i=r.getOpt("title","Example "+u);i=t.format(i,null,t.tab(0),t.tab(0)),console.log("%s[1m%s[0m",t.tab(4),i),console.log(t.tab(5)+"$ node "+s+" "+r.getOpt("command",""));var o=t.format(r.getOpt("output",""),null,t.tab(5),t.tab(5));console.log(o)}))}u++,console.log("")}))}if(r.hasOpt("examples")&&(console.log(""),console.log("[1m%s[0m","EXAMPLES"),c=0,r.getOpt("examples").forEach((e=>{var r=new n(e),i=r.getOpt("title","Example "+c);console.log("%s[1m%s[0m",t.tab(),i),console.log(t.tab(2)+"$ node "+s+" "+r.getOpt("command",""));var o=t.format(r.getOpt("output",""),null,t.tab(2),t.tab(2));console.log(o)}))),r.hasOpt("see_also")){console.log(""),console.log("[1m%s[0m","SEE ALSO");var u=0;r.getOpt("see_also").forEach((e=>{var t=new n(e).getOpt("name","");t.length>u&&(u=t.length)})),r.getOpt("see_also").forEach((e=>{for(var r=new n(e),s=r.getOpt("name",""),i=r.getOpt("link",""),o="",a=0;a<u-s.length;a++)o+=" ";o+="   ",console.log("%s[1m%s[0m%s%s",t.tab(),s,o,i)}))}console.log(""),console.log("[1m[34m%s[0m","SAS ESP Connect\t\t\t\t"+(new Date).toDateString()+"\t\t\t\tSAS ESP Connect[30m[0m"),console.log("")}};Object.defineProperty(ye,"config",{get(){return this._config},set(e){this._config=e}})},4293:e=>{"use strict";e.exports=require("buffer")},6417:e=>{"use strict";e.exports=require("crypto")},8614:e=>{"use strict";e.exports=require("events")},5747:e=>{"use strict";e.exports=require("fs")},8605:e=>{"use strict";e.exports=require("http")},7211:e=>{"use strict";e.exports=require("https")},1631:e=>{"use strict";e.exports=require("net")},2087:e=>{"use strict";e.exports=require("os")},5622:e=>{"use strict";e.exports=require("path")},2413:e=>{"use strict";e.exports=require("stream")},4016:e=>{"use strict";e.exports=require("tls")},3867:e=>{"use strict";e.exports=require("tty")},8835:e=>{"use strict";e.exports=require("url")},1669:e=>{"use strict";e.exports=require("util")},8761:e=>{"use strict";e.exports=require("zlib")}},t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={exports:{}};return e[s](n,n.exports,r),n.exports}return r.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);r.r(s);var n={};if(2&t&&"object"==typeof e&&e)for(const t in e)n[t]=()=>e[t];return n.default=()=>e,r.d(s,n),s},r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(8881)})()}));
<!DOCTYPE html>

<html>
<head>

<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">

<title>ESP Connect  Examples</title>

<script type="text/javascript">
var _esp = null;
</script>

<link rel="stylesheet" href="./esp-connect/style/connect.css" />
<script type="module">
import {esp} from "./esp-connect/js/ui/api.js";
_esp = esp;
</script>

<script type="text/javascript">

var _namespace = null;
var _server = null;
var _k8s = null;

function
init()
{
    _esp.setProxies();

    _storage = _esp.getStorage("connect-examples");

    _esp.getAjax().create("./config.json").get().then(
        function(result) {
            var o = JSON.parse(result.text);
            if (o.hasOwnProperty("k8s"))
            {
                if (o.k8s)
                {
                    selectNamespace();
                }
                else
                {
                    _esp.showConnectDialog({connect:connect});
                }
            }
        },
        function(result) {
            _esp.showConnectDialog({connect:connect});
        }
    );

    var parms = _esp.getParms();

    _esp.handleLayout();
}

function
selectNamespace()
{
    var k8surl = "k8s-proxy://localhost:8001";
    var k8s = _esp.createK8S(k8surl);
    var current = _storage.getOpt("namespace");
    var option;
    var name;

    var o = {
        ok:function(dialog)
        {
            _namespace = dialog.getValue("namespace");
            _storage.setOpt("namespace",_namespace);
            document.getElementById("bannerTitle").innerHTML = "ESP Connect Examples (Namespace: " + _namespace + ")";
            return(true);
        },
        cancel:function(dialog)
        {
            return(true);
        }
    };

    var options = [];
    var option;

    k8s.getNamespaces().then(
        function(result) {
            result.forEach((item) => {
                name = item.metadata.name;
                option = {};
                option.name = name;
                option.value = name;
                options.push(option);
            });

            var form = [];
            form.push({name:"namespace",type:"select",label:"Namespace:",value:current,options:options});
            _esp.getDialogs().showDialog({title:"Select K8S Namespace",delegate:o,label_width:"40px",form:form});
        }
    );
}

function
connect(server)
{
    _server = server;
    _esp.getDialogs().clearModals();
    document.getElementById("bannerTitle").innerHTML = "ESP Connect Examples (" + _server + ")";
    _esp.size();
}

function
go(example)
{
    var s = "";

    if (_namespace != null)
    {
        s += "namespace=" + _namespace;
    }
    else if (_server != null)
    {
        s += "server=" + _server;
    }

    var url = example + "/index.html";

    if (s.length > 0)
    {
        url += "?" + s;
    }

    s = new URL(url,document.URL).toString();

    window.open(s,"_blank");
}

</script>

<style type="text/css">
a
{
    text-decoration:none;
    color:black;
}

ul.examples
{
    font-size:1.2rem;
}

ul.examples a
{
    font-style:italic;
    text-decoration:underline;
}

</style>

</head>

<body onload="init()">

    <div id="banner">
        <table style="width:100%" cellspacing="0" cellpadding="0">
            <tr>
                <td id="bannerTitle">ESP Connect Examples</td>
            </tr>
        </table>
    </div>

    <div id="content">
        <ul class="examples">
            <li><a href="javascript:go('basic')">Basic</a> - Simple model that publishes mouse clicks into ESP.</li>
            <li><a href="javascript:go('trades')">Stock Trade Data</a> - Streaming trade data and broker violations.</li>
            <li><a href="javascript:go('paris')">A Trip through Paris</a> - A car trip through Paris showcasing ESP geofence windows with points of interest.</li>
            <li><a href="javascript:go('weather')">Weather</a> - Live weather data fed into an ESP model.</li>
            <li><a href="javascript:go('sailing')">Sailing</a> - Several sailboats sailing around the Firth of Forth and using geofencing to monitor activity in areas of interest.</li>
            <li><a href="javascript:go('turbine')">Wind Turbines</a> - Wind turbine data driving a custom display while processing turbine alerts.</li>
        </ul>
    </div>

    <div id="footer">&nbsp;</div>

</body>

</html>
